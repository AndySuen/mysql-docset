<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><a class="dashingAutolink" name="autolink-105"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/6.4.5.8%C2%A0Writing%20Audit%20Log%20Filter%20Definitions"></a><title>6.4.5.8&nbsp;Writing Audit Log Filter Definitions</title><link rel="stylesheet" type="text/css" href="mvl-otn.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/><link rel="home" href="performance-schema" title="MySQL 8.0 Reference Manual"/><link rel="up" href="audit-log.html" title="6.4.5&nbsp;MySQL Enterprise Audit"/><link rel="prev" href="audit-log-filtering.html" title="6.4.5.7&nbsp;Audit Log Filtering"/><link rel="next" href="audit-log-disabling.html" title="6.4.5.9&nbsp;Disabling Audit Logging"/><script>window.ohcglobal || document.write('<script src="../../../en/dcommon/js/global.js">\x3C/script>')</script></head><body><div class="skip-link"><a href="audit-log-filter-definitions.html#audit-log-filter-definitions">Skip to Main Content</a></div><div class="DocTitle"><p>MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0</p></div><div class="navigation"><ul><li class="navLinkPrevious"><a accesskey="p" title="Go To Previous Page&nbsp;[access key: p]" href="audit-log-filtering.html">Previous <span class="navHint"> Audit Log Filtering </span></a></li><li class="navLinkHome"><a accesskey="h" title="Go To Home Page&nbsp;[access key: h]" href="performance-schema">Home <span class="navHint"> MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0 </span></a></li><li class="navLinkUp"><a accesskey="u" title="Go Up A Level In The Navigation&nbsp;[access key: u]" href="audit-log.html">Up <span class="navHint"> MySQL Enterprise Audit </span></a></li><li class="navLinkNext"><a accesskey="n" title="Go To Next Page&nbsp;[access key: n]" href="audit-log-disabling.html">Next <span class="navHint"> Disabling Audit Logging </span></a></li></ul></div><div class="section"><div class="titlepage"><div><div><a class="dashingAutolink" name="autolink-104"></a><a class="dashAnchor" name="//apple_ref/cpp/Section/6.4.5.8%C2%A0Writing%20Audit%20Log%20Filter%20Definitions"></a><h4 class="title"><a id="audit-log-filter-definitions"></a>6.4.5.8&nbsp;Writing Audit Log Filter Definitions</h4></div></div></div><p>
        Filter definitions are <a class="link" href="json.html" title="11.5&nbsp;The JSON Data Type"><code class="literal">JSON</code></a>
        values. For information about using
        <a class="link" href="json.html" title="11.5&nbsp;The JSON Data Type"><code class="literal">JSON</code></a> data in MySQL, see
        <a class="xref" href="json.html" title="11.5&nbsp;The JSON Data Type">Section&nbsp;11.5, &ldquo;The JSON Data Type&rdquo;</a>.
      </p><p>
        Filter definitions have this form, where
        <em class="replaceable"><code>actions</code></em> indicates how filtering takes
        place:
      </p><pre class="programlisting">{ &#34;filter&#34;: <em class="replaceable"><code>actions</code></em> }
</pre><p>
        The following discussion describes permitted constructs in
        filter definitions.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-enabling-logging" title="Logging All Events">Logging All Events</a></p></li><li class="listitem"><p><a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-class-logging" title="Logging Specific Event Classes">Logging Specific Event Classes</a></p></li><li class="listitem"><p><a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-subclass-logging" title="Logging Specific Event Subclasses">Logging Specific Event Subclasses</a></p></li><li class="listitem"><p><a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-inclusive-exclusive" title="Inclusive and Exclusive Logging">Inclusive and Exclusive Logging</a></p></li><li class="listitem"><p><a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-event-fields" title="Testing Event Field Values">Testing Event Field Values</a></p></li><li class="listitem"><p><a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-blocking-events" title="Blocking Execution of Specific Events">Blocking Execution of Specific Events</a></p></li><li class="listitem"><p><a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-logical-operators" title="Logical Operators">Logical Operators</a></p></li><li class="listitem"><p><a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-predefined-variables" title="Referencing Predefined Variables">Referencing Predefined Variables</a></p></li><li class="listitem"><p><a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-predefined-functions" title="Referencing Predefined Functions">Referencing Predefined Functions</a></p></li><li class="listitem"><p><a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-field-replacement" title="Replacement of Event Field Values">Replacement of Event Field Values</a></p></li><li class="listitem"><p><a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-filter-replacement" title="Replacing a User Filter">Replacing a User Filter</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="audit-log-filtering-enabling-logging"></a>Logging All Events</h5></div></div></div><p>
          To explicitly enable or disable logging of all events, use a
          <code class="literal">log</code> item in the filter:
        </p><pre class="programlisting">{
  &#34;filter&#34;: { &#34;log&#34;: true }
}
</pre><p>
          The <code class="literal">log</code> value can be either
          <code class="literal">true</code> or <code class="literal">false</code>.
        </p><p>
          The preceding filter enables logging of all events. It is
          equivalent to:
        </p><pre class="programlisting">{
  &#34;filter&#34;: { }
}
</pre><p>
          Logging behavior depends on the <code class="literal">log</code> value
          and whether <code class="literal">class</code> or
          <code class="literal">event</code> items are specified:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              With <code class="literal">log</code> specified, its given value is
              used.
            </p></li><li class="listitem"><p>
              Without <code class="literal">log</code> specified, logging is
              <code class="literal">true</code> if no <code class="literal">class</code> or
              <code class="literal">event</code> item is specified, and
              <code class="literal">false</code> otherwise (in which case,
              <code class="literal">class</code> or <code class="literal">event</code> can
              include their own <code class="literal">log</code> item).
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="audit-log-filtering-class-logging"></a>Logging Specific Event Classes</h5></div></div></div><p>
          To log events of a specific class, use a
          <code class="literal">class</code> item in the filter, with its
          <code class="literal">name</code> field denoting the name of the class
          to log:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: { &#34;name&#34;: &#34;connection&#34; }
  }
}
</pre><p>
          The <code class="literal">name</code> value can be
          <code class="literal">connection</code>, <code class="literal">general</code>, or
          <code class="literal">table_access</code> to log connection, general, or
          table-access events, respectively.
        </p><p>
          The preceding filter enables logging of events in the
          <code class="literal">connection</code> class. It is equivalent to the
          following filter with <code class="literal">log</code> items made
          explicit:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;log&#34;: false,
    &#34;class&#34;: { &#34;log&#34;: true,
               &#34;name&#34;: &#34;connection&#34; }
  }
}
</pre><p>
          To enable logging of multiple classes, define the
          <code class="literal">class</code> value as a
          <a class="link" href="json.html" title="11.5&nbsp;The JSON Data Type"><code class="literal">JSON</code></a> array element that names
          the classes:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: [
      { &#34;name&#34;: &#34;connection&#34; },
      { &#34;name&#34;: &#34;general&#34; },
      { &#34;name&#34;: &#34;table_access&#34; }
    ]
  }
}
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p>
            When multiple instances of a given item appear at the same
            level within a filter definition, the item values can be
            combined into a single instance of that item within an array
            value. The preceding definition can be written like this:
          </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: [
      { &#34;name&#34;: [ &#34;connection&#34;, &#34;general&#34;, &#34;table_access&#34; ] }
    ]
  }
}
</pre></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="audit-log-filtering-subclass-logging"></a>Logging Specific Event Subclasses</h5></div></div></div><p>
          To select specific event subclasses, use an
          <code class="literal">event</code> item containing a
          <code class="literal">name</code> item that names the subclasses. The
          default action for events selected by an
          <code class="literal">event</code> item is to log them. For example,
          this filter enables logging for the named event subclasses:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: [
      {
        &#34;name&#34;: &#34;connection&#34;,
        &#34;event&#34;: [
          { &#34;name&#34;: &#34;connect&#34; },
          { &#34;name&#34;: &#34;disconnect&#34; }
        ]
      },
      { &#34;name&#34;: &#34;general&#34; },
      {
        &#34;name&#34;: &#34;table_access&#34;,
        &#34;event&#34;: [
          { &#34;name&#34;: &#34;insert&#34; },
          { &#34;name&#34;: &#34;delete&#34; },
          { &#34;name&#34;: &#34;update&#34; }
        ]
      }
    ]
  }
}
</pre><p>
          The <code class="literal">event</code> item can also contain explicit
          <code class="literal">log</code> items to indicate whether to log
          qualifying events. This <code class="literal">event</code> item selects
          multiple events and explicitly indicates logging behavior for
          them:
        </p><pre class="programlisting">&#34;event&#34;: [
  { &#34;name&#34;: &#34;read&#34;, &#34;log&#34;: false },
  { &#34;name&#34;: &#34;insert&#34;, &#34;log&#34;: true },
  { &#34;name&#34;: &#34;delete&#34;, &#34;log&#34;: true },
  { &#34;name&#34;: &#34;update&#34;, &#34;log&#34;: true }
]
</pre><p>
          The <code class="literal">event</code> item can also indicate whether to
          block qualifying events, if it contains an
          <code class="literal">abort</code> item. For details, see
          <a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-blocking-events" title="Blocking Execution of Specific Events">Blocking Execution of Specific Events</a>.
        </p><p>
          <a class="xref" href="audit-log-filter-definitions.html#audit-log-event-subclass-combinations" title="Table&nbsp;6.35&nbsp;Event Class and Subclass Combinations">Table&nbsp;6.35, &ldquo;Event Class and Subclass Combinations&rdquo;</a>
          describes the permitted subclass values for each event class.
        </p><div class="table"><a id="audit-log-event-subclass-combinations"></a><p class="title"><strong>Table&nbsp;6.35&nbsp;Event Class and Subclass Combinations</strong></p><div class="table-contents"><table summary="Permitted combiniations of event class and subclass values."><colgroup><col style="width: 20%"/><col style="width: 20%"/><col style="width: 60%"/></colgroup><thead><tr>
              <th scope="col">Event Class</th>
              <th scope="col">Event Subclass</th>
              <th scope="col">Description</th>
            </tr></thead><tbody><tr>
              <th scope="row"><code class="literal">connection</code></th>
              <td><code class="literal">connect</code></td>
              <td>Connection initiation (successful or unsuccessful)</td>
            </tr><tr>
              <th scope="row"><code class="literal">connection</code></th>
              <td><code class="literal">change_user</code></td>
              <td>User re-authentication with different user/password during session</td>
            </tr><tr>
              <th scope="row"><code class="literal">connection</code></th>
              <td><code class="literal">disconnect</code></td>
              <td>Connection termination</td>
            </tr><tr>
              <th scope="row"><code class="literal">general</code></th>
              <td><code class="literal">status</code></td>
              <td>General operation information</td>
            </tr><tr>
              <th scope="row"><code class="literal">message</code></th>
              <td><code class="literal">internal</code></td>
              <td>Internally generated message</td>
            </tr><tr>
              <th scope="row"><code class="literal">message</code></th>
              <td><code class="literal">user</code></td>
              <td>Message generated by
                <a class="link" href="audit-api-message-emit.html#function_audit-api-message-emit-udf"><code class="literal">audit_api_message_emit_udf()</code></a></td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">read</code></td>
              <td>Table read statements, such as <a class="link" href="select.html" title="13.2.13&nbsp;SELECT Statement"><code class="literal">SELECT</code></a> or
                <a class="link" href="insert-select.html" title="13.2.7.1&nbsp;INSERT ... SELECT Statement"><code class="literal">INSERT
                INTO ... SELECT</code></a></td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">delete</code></td>
              <td>Table delete statements, such as <a class="link" href="delete.html" title="13.2.2&nbsp;DELETE Statement"><code class="literal">DELETE</code></a>
                or <a class="link" href="truncate-table.html" title="13.1.37&nbsp;TRUNCATE TABLE Statement"><code class="literal">TRUNCATE TABLE</code></a></td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">insert</code></td>
              <td>Table insert statements, such as <a class="link" href="insert.html" title="13.2.7&nbsp;INSERT Statement"><code class="literal">INSERT</code></a>
                or <a class="link" href="replace.html" title="13.2.12&nbsp;REPLACE Statement"><code class="literal">REPLACE</code></a></td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">update</code></td>
              <td>Table update statements, such as <a class="link" href="update.html" title="13.2.17&nbsp;UPDATE Statement"><code class="literal">UPDATE</code></a></td>
            </tr></tbody></table></div></div><br class="table-break"/><p>
          <a class="xref" href="audit-log-filter-definitions.html#audit-log-event-subclass-log-abort" title="Table&nbsp;6.36&nbsp;Log and Abort Characteristics Per Event Class and Subclass Combination">Table&nbsp;6.36, &ldquo;Log and Abort Characteristics Per Event Class and Subclass Combination&rdquo;</a> describes
          for each event subclass whether it can be logged or aborted.
        </p><div class="table"><a id="audit-log-event-subclass-log-abort"></a><p class="title"><strong>Table&nbsp;6.36&nbsp;Log and Abort Characteristics Per Event Class and Subclass Combination</strong></p><div class="table-contents"><table summary="Log and abort characteristics for event class and subclass combinations."><colgroup><col style="width: 20%"/><col style="width: 20%"/><col style="width: 30%"/><col style="width: 30%"/></colgroup><thead><tr>
              <th scope="col">Event Class</th>
              <th scope="col">Event Subclass</th>
              <th scope="col">Can be Logged</th>
              <th scope="col">Can be Aborted</th>
            </tr></thead><tbody><tr>
              <th scope="row"><code class="literal">connection</code></th>
              <td><code class="literal">connect</code></td>
              <td>Yes</td>
              <td>No</td>
            </tr><tr>
              <th scope="row"><code class="literal">connection</code></th>
              <td><code class="literal">change_user</code></td>
              <td>Yes</td>
              <td>No</td>
            </tr><tr>
              <th scope="row"><code class="literal">connection</code></th>
              <td><code class="literal">disconnect</code></td>
              <td>Yes</td>
              <td>No</td>
            </tr><tr>
              <th scope="row"><code class="literal">general</code></th>
              <td><code class="literal">status</code></td>
              <td>Yes</td>
              <td>No</td>
            </tr><tr>
              <th scope="row"><code class="literal">message</code></th>
              <td><code class="literal">internal</code></td>
              <td>Yes</td>
              <td>Yes</td>
            </tr><tr>
              <th scope="row"><code class="literal">message</code></th>
              <td><code class="literal">user</code></td>
              <td>Yes</td>
              <td>Yes</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">read</code></td>
              <td>Yes</td>
              <td>Yes</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">delete</code></td>
              <td>Yes</td>
              <td>Yes</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">insert</code></td>
              <td>Yes</td>
              <td>Yes</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">update</code></td>
              <td>Yes</td>
              <td>Yes</td>
            </tr></tbody></table></div></div><br class="table-break"/></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="audit-log-filtering-inclusive-exclusive"></a>Inclusive and Exclusive Logging</h5></div></div></div><p>
          A filter can be defined in inclusive or exclusive mode:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Inclusive mode logs only explicitly specified items.
            </p></li><li class="listitem"><p>
              Exclusive mode logs everything but explicitly specified
              items.
            </p></li></ul></div><p>
          To perform inclusive logging, disable logging globally and
          enable logging for specific classes. This filter logs
          <code class="literal">connect</code> and <code class="literal">disconnect</code>
          events in the <code class="literal">connection</code> class, and events
          in the <code class="literal">general</code> class:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;log&#34;: false,
    &#34;class&#34;: [
      {
        &#34;name&#34;: &#34;connection&#34;,
        &#34;event&#34;: [
          { &#34;name&#34;: &#34;connect&#34;, &#34;log&#34;: true },
          { &#34;name&#34;: &#34;disconnect&#34;, &#34;log&#34;: true }
        ]
      },
      { &#34;name&#34;: &#34;general&#34;, &#34;log&#34;: true }
    ]
  }
}
</pre><p>
          To perform exclusive logging, enable logging globally and
          disable logging for specific classes. This filter logs
          everything except events in the <code class="literal">general</code>
          class:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;log&#34;: true,
    &#34;class&#34;:
      { &#34;name&#34;: &#34;general&#34;, &#34;log&#34;: false }
  }
}
</pre><p>
          This filter logs <code class="literal">change_user</code> events in the
          <code class="literal">connection</code> class,
          <code class="literal">message</code> events, and
          <code class="literal">table_access</code> events, by virtue of
          <span class="emphasis"><em>not</em></span> logging everything else:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;log&#34;: true,
    &#34;class&#34;: [
      {
        &#34;name&#34;: &#34;connection&#34;,
        &#34;event&#34;: [
          { &#34;name&#34;: &#34;connect&#34;, &#34;log&#34;: false },
          { &#34;name&#34;: &#34;disconnect&#34;, &#34;log&#34;: false }
        ]
      },
      { &#34;name&#34;: &#34;general&#34;, &#34;log&#34;: false }
    ]
  }
}
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="audit-log-filtering-event-fields"></a>Testing Event Field Values</h5></div></div></div><p>
          To enable logging based on specific event field values,
          specify a <code class="literal">field</code> item within the
          <code class="literal">log</code> item that indicates the field name and
          its expected value:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: {
    &#34;name&#34;: &#34;general&#34;,
      &#34;event&#34;: {
        &#34;name&#34;: &#34;status&#34;,
        &#34;log&#34;: {
          &#34;field&#34;: { &#34;name&#34;: &#34;general_command.str&#34;, &#34;value&#34;: &#34;Query&#34; }
        }
      }
    }
  }
}
</pre><p>
          Each event contains event class-specific fields that can be
          accessed from within a filter to perform custom filtering.
        </p><p>
          An event in the <code class="literal">connection</code> class indicates
          when a connection-related activity occurs during a session,
          such as a user connecting to or disconnecting from the server.
          <a class="xref" href="audit-log-filter-definitions.html#audit-log-connection-event-fields" title="Table&nbsp;6.37&nbsp;Connection Event Fields">Table&nbsp;6.37, &ldquo;Connection Event Fields&rdquo;</a> indicates
          the permitted fields for <code class="literal">connection</code> events.
        </p><div class="table"><a id="audit-log-connection-event-fields"></a><p class="title"><strong>Table&nbsp;6.37&nbsp;Connection Event Fields</strong></p><div class="table-contents"><table summary="Permitted fields for connection events."><colgroup><col style="width: 35%"/><col style="width: 20%"/><col style="width: 45%"/></colgroup><thead><tr>
              <th scope="col">Field Name</th>
              <th scope="col">Field Type</th>
              <th scope="col">Description</th>
            </tr></thead><tbody><tr>
              <th scope="row"><code class="literal">status</code></th>
              <td>integer</td>
              <td><p class="valid-value">
                  Event status:
                </p><p class="valid-value">
                  0: OK
                </p><p class="valid-value">
                  Otherwise: Failed
                </p></td>
            </tr><tr>
              <th scope="row"><code class="literal">connection_id</code></th>
              <td>unsigned integer</td>
              <td>Connection ID</td>
            </tr><tr>
              <th scope="row"><code class="literal">user.str</code></th>
              <td>string</td>
              <td>User name specified during authentication</td>
            </tr><tr>
              <th scope="row"><code class="literal">user.length</code></th>
              <td>unsigned integer</td>
              <td>User name length</td>
            </tr><tr>
              <th scope="row"><code class="literal">priv_user.str</code></th>
              <td>string</td>
              <td>Authenticated user name (account user name)</td>
            </tr><tr>
              <th scope="row"><code class="literal">priv_user.length</code></th>
              <td>unsigned integer</td>
              <td>Authenticated user name length</td>
            </tr><tr>
              <th scope="row"><code class="literal">external_user.str</code></th>
              <td>string</td>
              <td>External user name (provided by third-party authentication plugin)</td>
            </tr><tr>
              <th scope="row"><code class="literal">external_user.length</code></th>
              <td>unsigned integer</td>
              <td>External user name length</td>
            </tr><tr>
              <th scope="row"><code class="literal">proxy_user.str</code></th>
              <td>string</td>
              <td>Proxy user name</td>
            </tr><tr>
              <th scope="row"><code class="literal">proxy_user.length</code></th>
              <td>unsigned integer</td>
              <td>Proxy user name length</td>
            </tr><tr>
              <th scope="row"><code class="literal">host.str</code></th>
              <td>string</td>
              <td>Connected user host</td>
            </tr><tr>
              <th scope="row"><code class="literal">host.length</code></th>
              <td>unsigned integer</td>
              <td>Connected user host length</td>
            </tr><tr>
              <th scope="row"><code class="literal">ip.str</code></th>
              <td>string</td>
              <td>Connected user IP address</td>
            </tr><tr>
              <th scope="row"><code class="literal">ip.length</code></th>
              <td>unsigned integer</td>
              <td>Connected user IP address length</td>
            </tr><tr>
              <th scope="row"><code class="literal">database.str</code></th>
              <td>string</td>
              <td>Database name specified at connect time</td>
            </tr><tr>
              <th scope="row"><code class="literal">database.length</code></th>
              <td>unsigned integer</td>
              <td>Database name length</td>
            </tr><tr>
              <th scope="row"><code class="literal">connection_type</code></th>
              <td>integer</td>
              <td><p class="valid-value">
                  Connection type:
                </p><p class="valid-value">
                  0 or <code class="literal">&#34;::undefined&#34;</code>: Undefined
                </p><p class="valid-value">
                  1 or <code class="literal">&#34;::tcp/ip&#34;</code>: TCP/IP
                </p><p class="valid-value">
                  2 or <code class="literal">&#34;::socket&#34;</code>: Socket
                </p><p class="valid-value">
                  3 or <code class="literal">&#34;::named_pipe&#34;</code>: Named pipe
                </p><p class="valid-value">
                  4 or <code class="literal">&#34;::ssl&#34;</code>: TCP/IP with
                  encryption
                </p><p class="valid-value">
                  5 or <code class="literal">&#34;::shared_memory&#34;</code>: Shared
                  memory
                </p></td>
            </tr></tbody></table></div></div><br class="table-break"/><p>
          The <code class="literal">&#34;::<em class="replaceable"><code>xxx</code></em>&#34;</code>
          values are symbolic pseudo-constants that may be given instead
          of the literal numeric values. They must be quoted as strings
          and are case-sensitive.
        </p><p>
          An event in the <code class="literal">general</code> class indicates the
          status code of an operation and its details.
          <a class="xref" href="audit-log-filter-definitions.html#audit-log-general-event-fields" title="Table&nbsp;6.38&nbsp;General Event Fields">Table&nbsp;6.38, &ldquo;General Event Fields&rdquo;</a> indicates the
          permitted fields for <code class="literal">general</code> events.
        </p><div class="table"><a id="audit-log-general-event-fields"></a><p class="title"><strong>Table&nbsp;6.38&nbsp;General Event Fields</strong></p><div class="table-contents"><table summary="Permitted field types for general events."><colgroup><col style="width: 35%"/><col style="width: 20%"/><col style="width: 45%"/></colgroup><thead><tr>
              <th scope="col">Field Name</th>
              <th scope="col">Field Type</th>
              <th scope="col">Description</th>
            </tr></thead><tbody><tr>
              <th scope="row"><code class="literal">general_error_code</code></th>
              <td>integer</td>
              <td><p class="valid-value">
                  Event status:
                </p><p class="valid-value">
                  0: OK
                </p><p class="valid-value">
                  Otherwise: Failed
                </p></td>
            </tr><tr>
              <th scope="row"><code class="literal">general_thread_id</code></th>
              <td>unsigned integer</td>
              <td>Connection/thread ID</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_user.str</code></th>
              <td>string</td>
              <td>User name specified during authentication</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_user.length</code></th>
              <td>unsigned integer</td>
              <td>User name length</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_command.str</code></th>
              <td>string</td>
              <td>Command name</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_command.length</code></th>
              <td>unsigned integer</td>
              <td>Command name length</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_query.str</code></th>
              <td>string</td>
              <td>SQL statement text</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_query.length</code></th>
              <td>unsigned integer</td>
              <td>SQL statement text length</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_host.str</code></th>
              <td>string</td>
              <td>Host name</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_host.length</code></th>
              <td>unsigned integer</td>
              <td>Host name length</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_sql_command.str</code></th>
              <td>string</td>
              <td>SQL command type name</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_sql_command.length</code></th>
              <td>unsigned integer</td>
              <td>SQL command type name length</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_external_user.str</code></th>
              <td>string</td>
              <td>External user name (provided by third-party authentication plugin)</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_external_user.length</code></th>
              <td>unsigned integer</td>
              <td>External user name length</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_ip.str</code></th>
              <td>string</td>
              <td>Connected user IP address</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_ip.length</code></th>
              <td>unsigned integer</td>
              <td>Connection user IP address length</td>
            </tr></tbody></table></div></div><br class="table-break"/><p>
          <code class="literal">general_command.str</code> indicates a command
          name: <code class="literal">Query</code>, <code class="literal">Execute</code>,
          <code class="literal">Quit</code>, or <code class="literal">Change user</code>.
        </p><p>
          A <code class="literal">general</code> event with the
          <code class="literal">general_command.str</code> field set to
          <code class="literal">Query</code> or <code class="literal">Execute</code>
          contains <code class="literal">general_sql_command.str</code> set to a
          value that specifies the type of SQL command:
          <code class="literal">alter_db</code>,
          <code class="literal">alter_db_upgrade</code>,
          <code class="literal">admin_commands</code>, and so forth. The available
          <code class="literal">general_sql_command.str</code> values can be seen
          as the last components of the Performance Schema instruments
          displayed by this statement:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT NAME FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE &#39;statement/sql/%&#39; ORDER BY NAME;</code></strong>
+---------------------------------------+
| NAME                                  |
+---------------------------------------+
| statement/sql/alter_db                |
| statement/sql/alter_db_upgrade        |
| statement/sql/alter_event             |
| statement/sql/alter_function          |
| statement/sql/alter_instance          |
| statement/sql/alter_procedure         |
| statement/sql/alter_server            |
...
</pre><p>
          An event in the <code class="literal">table_access</code> class provides
          information about a specific type of access to a table.
          <a class="xref" href="audit-log-filter-definitions.html#audit-log-table-access-event-fields" title="Table&nbsp;6.39&nbsp;Table-Access Event Fields">Table&nbsp;6.39, &ldquo;Table-Access Event Fields&rdquo;</a>
          indicates the permitted fields for
          <code class="literal">table_access</code> events.
        </p><div class="table"><a id="audit-log-table-access-event-fields"></a><p class="title"><strong>Table&nbsp;6.39&nbsp;Table-Access Event Fields</strong></p><div class="table-contents"><table summary="Permitted fields for table-access events."><colgroup><col style="width: 35%"/><col style="width: 20%"/><col style="width: 45%"/></colgroup><thead><tr>
              <th scope="col">Field Name</th>
              <th scope="col">Field Type</th>
              <th scope="col">Description</th>
            </tr></thead><tbody><tr>
              <th scope="row"><code class="literal">connection_id</code></th>
              <td>unsigned integer</td>
              <td>Event connection ID</td>
            </tr><tr>
              <th scope="row"><code class="literal">sql_command_id</code></th>
              <td>integer</td>
              <td>SQL command ID</td>
            </tr><tr>
              <th scope="row"><code class="literal">query.str</code></th>
              <td>string</td>
              <td>SQL statement text</td>
            </tr><tr>
              <th scope="row"><code class="literal">query.length</code></th>
              <td>unsigned integer</td>
              <td>SQL statement text length</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_database.str</code></th>
              <td>string</td>
              <td>Database name associated with event</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_database.length</code></th>
              <td>unsigned integer</td>
              <td>Database name length</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_name.str</code></th>
              <td>string</td>
              <td>Table name associated with event</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_name.length</code></th>
              <td>unsigned integer</td>
              <td>Table name length</td>
            </tr></tbody></table></div></div><br class="table-break"/><p>
          The following list shows which statements produce which
          table-access events:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">read</code> event:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">SELECT</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">INSERT ... SELECT</code> (for tables
                  referenced in <code class="literal">SELECT</code> clause)
                </p></li><li class="listitem"><p>
                  <code class="literal">REPLACE ... SELECT</code> (for tables
                  referenced in <code class="literal">SELECT</code> clause)
                </p></li><li class="listitem"><p>
                  <code class="literal">UPDATE ... WHERE</code> (for tables
                  referenced in <code class="literal">WHERE</code> clause)
                </p></li><li class="listitem"><p>
                  <code class="literal">HANDLER ... READ</code>
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">delete</code> event:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">DELETE</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">TRUNCATE TABLE</code>
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">insert</code> event:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">INSERT</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">INSERT ... SELECT</code> (for table
                  referenced in <code class="literal">INSERT</code> clause)
                </p></li><li class="listitem"><p>
                  <code class="literal">REPLACE</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">REPLACE ... SELECT</code> (for table
                  referenced in <code class="literal">REPLACE</code> clause
                </p></li><li class="listitem"><p>
                  <code class="literal">LOAD DATA</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">LOAD XML</code>
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">update</code> event:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">UPDATE</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">UPDATE ... WHERE</code> (for tables
                  referenced in <code class="literal">UPDATE</code> clause)
                </p></li></ul></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="audit-log-filtering-blocking-events"></a>Blocking Execution of Specific Events</h5></div></div></div><p>
          <code class="literal">event</code> items can include an
          <code class="literal">abort</code> item that indicates whether to
          prevent qualifying events from executing.
          <code class="literal">abort</code> enables rules to be written that
          block execution of specific SQL statements.
        </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Important</div><p>
            It is theoretically possible for a user with sufficient
            permissions to mistakenly create an <code class="literal">abort</code>
            item in the audit log filter that prevents themselves and
            other administrators from accessing the system. From MySQL
            8.0.28, the
            <a class="link" href="privileges-provided.html#priv_audit-abort-exempt"><code class="literal">AUDIT_ABORT_EXEMPT</code></a>
            privilege is available to permit a user account&rsquo;s queries
            to always be executed even if an <code class="literal">abort</code>
            item would block them. Accounts with this privilege can
            therefore be used to regain access to a system following an
            audit misconfiguration. The query is still logged in the
            audit log, but instead of being rejected, it is permitted
            due to the privilege.
          </p><p>
            Accounts created in MySQL 8.0.28 or later with the
            <a class="link" href="privileges-provided.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege have
            the <a class="link" href="privileges-provided.html#priv_audit-abort-exempt"><code class="literal">AUDIT_ABORT_EXEMPT</code></a>
            privilege assigned automatically when they are created. The
            <a class="link" href="privileges-provided.html#priv_audit-abort-exempt"><code class="literal">AUDIT_ABORT_EXEMPT</code></a> privilege
            is also assigned to existing accounts with the
            <a class="link" href="privileges-provided.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a>
            privilege when you carry out an upgrade procedure with MySQL
            8.0.28 or later, if no existing accounts have that privilege
            assigned.
          </p></div><p>
          The <code class="literal">abort</code> item must appear within an
          <code class="literal">event</code> item. For example:
        </p><pre class="programlisting">&#34;event&#34;: {
  &#34;name&#34;: <em class="replaceable"><code>qualifying event subclass names</code></em>
  &#34;abort&#34;: <em class="replaceable"><code>condition</code></em>
}
</pre><p>
          For event subclasses selected by the <code class="literal">name</code>
          item, the <code class="literal">abort</code> action is true or false,
          depending on <em class="replaceable"><code>condition</code></em> evaluation.
          If the condition evaluates to true, the event is blocked.
          Otherwise, the event continues executing.
        </p><p>
          The <em class="replaceable"><code>condition</code></em> specification can be
          as simple as <code class="literal">true</code> or
          <code class="literal">false</code>, or it can be more complex such that
          evaluation depends on event characteristics.
        </p><p>
          This filter blocks <a class="link" href="insert.html" title="13.2.7&nbsp;INSERT Statement"><code class="literal">INSERT</code></a>,
          <a class="link" href="update.html" title="13.2.17&nbsp;UPDATE Statement"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="delete.html" title="13.2.2&nbsp;DELETE Statement"><code class="literal">DELETE</code></a> statements:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: {
      &#34;name&#34;: &#34;table_access&#34;,
      &#34;event&#34;: {
        &#34;name&#34;: [ &#34;insert&#34;, &#34;update&#34;, &#34;delete&#34; ],
        &#34;abort&#34;: true
      }
    }
  }
}
</pre><p>
          This more complex filter blocks the same statements, but only
          for a specific table
          (<code class="literal">finances.bank_account</code>):
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: {
      &#34;name&#34;: &#34;table_access&#34;,
      &#34;event&#34;: {
        &#34;name&#34;: [ &#34;insert&#34;, &#34;update&#34;, &#34;delete&#34; ],
        &#34;abort&#34;: {
          &#34;and&#34;: [
            { &#34;field&#34;: { &#34;name&#34;: &#34;table_database.str&#34;, &#34;value&#34;: &#34;finances&#34; } },
            { &#34;field&#34;: { &#34;name&#34;: &#34;table_name.str&#34;, &#34;value&#34;: &#34;bank_account&#34; } }
          ]
        }
      }
    }
  }
}
</pre><p>
          Statements matched and blocked by the filter return an error
          to the client:
        </p><pre class="programlisting">ERROR 1045 (28000): Statement was aborted by an audit log filter
</pre><p>
          Not all events can be blocked (see
          <a class="xref" href="audit-log-filter-definitions.html#audit-log-event-subclass-log-abort" title="Table&nbsp;6.36&nbsp;Log and Abort Characteristics Per Event Class and Subclass Combination">Table&nbsp;6.36, &ldquo;Log and Abort Characteristics Per Event Class and Subclass Combination&rdquo;</a>). For an
          event that cannot be blocked, the audit log writes a warning
          to the error log rather than blocking it.
        </p><p>
          For attempts to define a filter in which the
          <code class="literal">abort</code> item appears elsewhere than in an
          <code class="literal">event</code> item, an error occurs.
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="audit-log-filtering-logical-operators"></a>Logical Operators</h5></div></div></div><p>
          Logical operators (<code class="literal">and</code>,
          <code class="literal">or</code>, <code class="literal">not</code>) permit
          construction of complex conditions, enabling more advanced
          filtering configurations to be written. The following
          <code class="literal">log</code> item logs only
          <code class="literal">general</code> events with
          <code class="literal">general_command</code> fields having a specific
          value and length:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: {
      &#34;name&#34;: &#34;general&#34;,
      &#34;event&#34;: {
        &#34;name&#34;: &#34;status&#34;,
        &#34;log&#34;: {
          &#34;or&#34;: [
            {
              &#34;and&#34;: [
                { &#34;field&#34;: { &#34;name&#34;: &#34;general_command.str&#34;,    &#34;value&#34;: &#34;Query&#34; } },
                { &#34;field&#34;: { &#34;name&#34;: &#34;general_command.length&#34;, &#34;value&#34;: 5 } }
              ]
            },
            {
              &#34;and&#34;: [
                { &#34;field&#34;: { &#34;name&#34;: &#34;general_command.str&#34;,    &#34;value&#34;: &#34;Execute&#34; } },
                { &#34;field&#34;: { &#34;name&#34;: &#34;general_command.length&#34;, &#34;value&#34;: 7 } }
              ]
            }
          ]
        }
      }
    }
  }
}
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="audit-log-filtering-predefined-variables"></a>Referencing Predefined Variables</h5></div></div></div><p>
          To refer to a predefined variable in a <code class="literal">log</code>
          condition, use a <code class="literal">variable</code> item, which takes
          <code class="literal">name</code> and <code class="literal">value</code> items and
          tests equality of the named variable against a given value:
        </p><pre class="programlisting">&#34;variable&#34;: {
  &#34;name&#34;: &#34;<em class="replaceable"><code>variable_name</code></em>&#34;,
  &#34;value&#34;: <em class="replaceable"><code>comparison_value</code></em>
}
</pre><p>
          This is true if <em class="replaceable"><code>variable_name</code></em> has
          the value <em class="replaceable"><code>comparison_value</code></em>, false
          otherwise.
        </p><p>
          Example:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: {
      &#34;name&#34;: &#34;general&#34;,
      &#34;event&#34;: {
        &#34;name&#34;: &#34;status&#34;,
        &#34;log&#34;: {
          &#34;variable&#34;: {
            &#34;name&#34;: &#34;audit_log_connection_policy_value&#34;,
            &#34;value&#34;: &#34;::none&#34;
          }
        }
      }
    }
  }
}
</pre><p>
          Each predefined variable corresponds to a system variable. By
          writing a filter that tests a predefined variable, you can
          modify filter operation by setting the corresponding system
          variable, without having to redefine the filter. For example,
          by writing a filter that tests the value of the
          <code class="literal">audit_log_connection_policy_value</code>
          predefined variable, you can modify filter operation by
          changing the value of the
          <a class="link" href="audit-log-reference.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
          system variable.
        </p><a id="idm45828963583232" class="indexterm"></a><p>
          The
          <code class="literal">audit_log_<em class="replaceable"><code>xxx</code></em>_policy</code>
          system variables are used for the deprecated legacy mode audit
          log (see <a class="xref" href="audit-log-legacy-filtering.html" title="6.4.5.10&nbsp;Legacy Mode Audit Log Filtering">Section&nbsp;6.4.5.10, &ldquo;Legacy Mode Audit Log Filtering&rdquo;</a>). With
          rule-based audit log filtering, those variables remain visible
          (for example, using <a class="link" href="show-variables.html" title="13.7.7.41&nbsp;SHOW VARIABLES Statement"><code class="literal">SHOW
          VARIABLES</code></a>), but changes to them have no effect
          unless you write filters containing constructs that refer to
          them.
        </p><p>
          The following list describes the permitted predefined
          variables for <code class="literal">variable</code> items:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">audit_log_connection_policy_value</code>
            </p><p>
              This variable corresponds to the value of the
              <a class="link" href="audit-log-reference.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
              system variable. The value is an unsigned integer.
              <a class="xref" href="audit-log-filter-definitions.html#audit-log-connection-policy-value-values" title="Table&nbsp;6.40&nbsp;audit_log_connection_policy_value Values">Table&nbsp;6.40, &ldquo;audit_log_connection_policy_value Values&rdquo;</a>
              shows the permitted values and the corresponding
              <a class="link" href="audit-log-reference.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
              values.
            </p><div class="table"><a id="audit-log-connection-policy-value-values"></a><p class="title"><strong>Table&nbsp;6.40&nbsp;audit_log_connection_policy_value Values</strong></p><div class="table-contents"><table summary="Permitted audit_log_connection_policy_value values and the corresponding audit_log_connection_policy values."><colgroup><col style="width: 20%"/><col style="width: 80%"/></colgroup><thead><tr>
                  <th>Value</th>
                  <th>Corresponding audit_log_connection_policy Value</th>
                </tr></thead><tbody><tr>
                  <td><code class="literal">0</code> or <code class="literal">&#34;::none&#34;</code></td>
                  <td><code class="literal">NONE</code></td>
                </tr><tr>
                  <td><code class="literal">1</code> or <code class="literal">&#34;::errors&#34;</code></td>
                  <td><code class="literal">ERRORS</code></td>
                </tr><tr>
                  <td><code class="literal">2</code> or <code class="literal">&#34;::all&#34;</code></td>
                  <td><code class="literal">ALL</code></td>
                </tr></tbody></table></div></div><br class="table-break"/><p>
              The <code class="literal">&#34;::<em class="replaceable"><code>xxx</code></em>&#34;</code>
              values are symbolic pseudo-constants that may be given
              instead of the literal numeric values. They must be quoted
              as strings and are case-sensitive.
            </p></li><li class="listitem"><p>
              <code class="literal">audit_log_policy_value</code>
            </p><p>
              This variable corresponds to the value of the
              <a class="link" href="audit-log-reference.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> system
              variable. The value is an unsigned integer.
              <a class="xref" href="audit-log-filter-definitions.html#audit-log-policy-value-values" title="Table&nbsp;6.41&nbsp;audit_log_policy_value Values">Table&nbsp;6.41, &ldquo;audit_log_policy_value Values&rdquo;</a> shows the
              permitted values and the corresponding
              <a class="link" href="audit-log-reference.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> values.
            </p><div class="table"><a id="audit-log-policy-value-values"></a><p class="title"><strong>Table&nbsp;6.41&nbsp;audit_log_policy_value Values</strong></p><div class="table-contents"><table summary="Permitted audit_log_policy_value values and the corresponding audit_log_policy values."><colgroup><col style="width: 20%"/><col style="width: 80%"/></colgroup><thead><tr>
                  <th>Value</th>
                  <th>Corresponding audit_log_policy Value</th>
                </tr></thead><tbody><tr>
                  <td><code class="literal">0</code> or <code class="literal">&#34;::none&#34;</code></td>
                  <td><code class="literal">NONE</code></td>
                </tr><tr>
                  <td><code class="literal">1</code> or <code class="literal">&#34;::logins&#34;</code></td>
                  <td><code class="literal">LOGINS</code></td>
                </tr><tr>
                  <td><code class="literal">2</code> or <code class="literal">&#34;::all&#34;</code></td>
                  <td><code class="literal">ALL</code></td>
                </tr><tr>
                  <td><code class="literal">3</code> or <code class="literal">&#34;::queries&#34;</code></td>
                  <td><code class="literal">QUERIES</code></td>
                </tr></tbody></table></div></div><br class="table-break"/><p>
              The <code class="literal">&#34;::<em class="replaceable"><code>xxx</code></em>&#34;</code>
              values are symbolic pseudo-constants that may be given
              instead of the literal numeric values. They must be quoted
              as strings and are case-sensitive.
            </p></li><li class="listitem"><p>
              <code class="literal">audit_log_statement_policy_value</code>
            </p><p>
              This variable corresponds to the value of the
              <a class="link" href="audit-log-reference.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>
              system variable. The value is an unsigned integer.
              <a class="xref" href="audit-log-filter-definitions.html#audit-log-statement-policy-value-values" title="Table&nbsp;6.42&nbsp;audit_log_statement_policy_value Values">Table&nbsp;6.42, &ldquo;audit_log_statement_policy_value Values&rdquo;</a>
              shows the permitted values and the corresponding
              <a class="link" href="audit-log-reference.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>
              values.
            </p><div class="table"><a id="audit-log-statement-policy-value-values"></a><p class="title"><strong>Table&nbsp;6.42&nbsp;audit_log_statement_policy_value Values</strong></p><div class="table-contents"><table summary="Permitted audit_log_statement_policy_value values and the corresponding audit_log_statement_policy values."><colgroup><col style="width: 20%"/><col style="width: 80%"/></colgroup><thead><tr>
                  <th>Value</th>
                  <th>Corresponding audit_log_statement_policy Value</th>
                </tr></thead><tbody><tr>
                  <td><code class="literal">0</code> or <code class="literal">&#34;::none&#34;</code></td>
                  <td><code class="literal">NONE</code></td>
                </tr><tr>
                  <td><code class="literal">1</code> or <code class="literal">&#34;::errors&#34;</code></td>
                  <td><code class="literal">ERRORS</code></td>
                </tr><tr>
                  <td><code class="literal">2</code> or <code class="literal">&#34;::all&#34;</code></td>
                  <td><code class="literal">ALL</code></td>
                </tr></tbody></table></div></div><br class="table-break"/><p>
              The <code class="literal">&#34;::<em class="replaceable"><code>xxx</code></em>&#34;</code>
              values are symbolic pseudo-constants that may be given
              instead of the literal numeric values. They must be quoted
              as strings and are case-sensitive.
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="audit-log-filtering-predefined-functions"></a>Referencing Predefined Functions</h5></div></div></div><p>
          To refer to a predefined function in a <code class="literal">log</code>
          condition, use a <code class="literal">function</code> item, which takes
          <code class="literal">name</code> and <code class="literal">args</code> items to
          specify the function name and its arguments, respectively:
        </p><pre class="programlisting">&#34;function&#34;: {
  &#34;name&#34;: &#34;<em class="replaceable"><code>function_name</code></em>&#34;,
  &#34;args&#34;: <em class="replaceable"><code>arguments</code></em>
}
</pre><p>
          The <code class="literal">name</code> item should specify the function
          name only, without parentheses or the argument list.
        </p><p>
          The <code class="literal">args</code> item must satisfy these
          conditions:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the function takes no arguments, no
              <code class="literal">args</code> item should be given.
            </p></li><li class="listitem"><p>
              If the function does take arguments, an
              <code class="literal">args</code> item is needed, and the arguments
              must be given in the order listed in the function
              description. Arguments can refer to predefined variables,
              event fields, or string or numeric constants.
            </p></li></ul></div><p>
          If the number of arguments is incorrect or the arguments are
          not of the correct data types required by the function an
          error occurs.
        </p><p>
          Example:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: {
      &#34;name&#34;: &#34;general&#34;,
      &#34;event&#34;: {
        &#34;name&#34;: &#34;status&#34;,
        &#34;log&#34;: {
          &#34;function&#34;: {
            &#34;name&#34;: &#34;find_in_include_list&#34;,
            &#34;args&#34;: [ { &#34;string&#34;: [ { &#34;field&#34;: &#34;user.str&#34; },
                                    { &#34;string&#34;: &#34;@&#34;},
                                    { &#34;field&#34;: &#34;host.str&#34; } ] } ]
          }
        }
      }
    }
  }
}
</pre><p>
          The preceding filter determines whether to log
          <code class="literal">general</code> class <code class="literal">status</code>
          events depending on whether the current user is found in the
          <a class="link" href="audit-log-reference.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
          system variable. That user is constructed using fields in the
          event.
        </p><p>
          The following list describes the permitted predefined
          functions for <code class="literal">function</code> items:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">audit_log_exclude_accounts_is_null()</code>
            </p><p>
              Checks whether the
              <a class="link" href="audit-log-reference.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
              system variable is <code class="literal">NULL</code>. This function
              can be helpful when defining filters that correspond to
              the legacy audit log implementation.
            </p><p>
              Arguments:
            </p><p>
              None.
            </p></li><li class="listitem"><p>
              <code class="literal">audit_log_include_accounts_is_null()</code>
            </p><p>
              Checks whether the
              <a class="link" href="audit-log-reference.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
              system variable is <code class="literal">NULL</code>. This function
              can be helpful when defining filters that correspond to
              the legacy audit log implementation.
            </p><p>
              Arguments:
            </p><p>
              None.
            </p></li><li class="listitem"><p>
              <code class="literal">debug_sleep(millisec)</code>
            </p><p>
              Sleeps for the given number of milliseconds. This function
              is used during performance measurement.
            </p><p>
              <code class="literal">debug_sleep()</code> is available for debug
              builds only.
            </p><p>
              Arguments:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>millisec</code></em>: An unsigned
                  integer that specifies the number of milliseconds to
                  sleep.
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">find_in_exclude_list(account)</code>
            </p><p>
              Checks whether an account string exists in the audit log
              exclude list (the value of the
              <a class="link" href="audit-log-reference.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
              system variable).
            </p><p>
              Arguments:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>account</code></em>: A string that
                  specifies the user account name.
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">find_in_include_list(account)</code>
            </p><p>
              Checks whether an account string exists in the audit log
              include list (the value of the
              <a class="link" href="audit-log-reference.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
              system variable).
            </p><p>
              Arguments:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>account</code></em>: A string that
                  specifies the user account name.
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">query_digest([str])</code>
            </p><p>
              This function has differing behavior depending on whether
              an argument is given:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  With no argument, <code class="literal">query_digest</code>
                  returns the statement digest value corresponding to
                  the statement literal text in the current event.
                </p></li><li class="listitem"><p>
                  With an argument, <code class="literal">query_digest</code>
                  returns a Boolean indicating whether the argument is
                  equal to the current statement digest.
                </p></li></ul></div><p>
              Arguments:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>str</code></em>: This argument is
                  optional. If given, it specifies a statement digest to
                  be compared against the digest for the statement in
                  the current event.
                </p></li></ul></div><p>
              Examples:
            </p><p>
              This <code class="literal">function</code> item includes no
              argument, so <code class="literal">query_digest</code> returns the
              current statement digest as a string:
            </p><pre class="programlisting">&#34;function&#34;: {
  &#34;name&#34;: &#34;query_digest&#34;
}
</pre><p>
              This <code class="literal">function</code> item includes an
              argument, so <code class="literal">query_digest</code> returns a
              Boolean indicating whether the argument equals the current
              statement digest:
            </p><pre class="programlisting">&#34;function&#34;: {
  &#34;name&#34;: &#34;query_digest&#34;,
  &#34;args&#34;: &#34;SELECT ?&#34;
}
</pre><p>
              This function was added in MySQL 8.0.26.
            </p></li><li class="listitem"><p>
              <code class="literal">string_find(text, substr)</code>
            </p><p>
              Checks whether the <code class="literal">substr</code> value is
              contained in the <code class="literal">text</code> value. This
              search is case-sensitive.
            </p><p>
              Arguments:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>text</code></em>: The text string to
                  search.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>substr</code></em>: The substring to
                  search for in <em class="replaceable"><code>text</code></em>.
                </p></li></ul></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="audit-log-filtering-field-replacement"></a>Replacement of Event Field Values</h5></div></div></div><a id="idm45828963429968" class="indexterm"></a><a id="idm45828963428480" class="indexterm"></a><p>
          As of MySQL 8.0.26, audit filter definitions support
          replacement of certain audit event fields, so that logged
          events contain the replacement value rather than the original
          value. This capability enables logged audit records to include
          statement digests rather than literal statements, which can be
          useful for MySQL deployments for which statements may expose
          sensitive values.
        </p><p>
          Field replacement in audit events works like this:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Field replacements are specified in audit filter
              definitions, so audit log filtering must be enabled as
              described in <a class="xref" href="audit-log-filtering.html" title="6.4.5.7&nbsp;Audit Log Filtering">Section&nbsp;6.4.5.7, &ldquo;Audit Log Filtering&rdquo;</a>.
            </p></li><li class="listitem"><p>
              Not all fields can be replaced.
              <a class="xref" href="audit-log-filter-definitions.html#audit-log-replaceable-event-fields" title="Table&nbsp;6.43&nbsp;Event Fields Subject to Replacement">Table&nbsp;6.43, &ldquo;Event Fields Subject to Replacement&rdquo;</a> shows
              which fields are replaceable in which event classes.
            </p><div class="table"><a id="audit-log-replaceable-event-fields"></a><p class="title"><strong>Table&nbsp;6.43&nbsp;Event Fields Subject to Replacement</strong></p><div class="table-contents"><table summary="Event fields that are subject to replacement during event filtering."><colgroup><col style="width: 50%"/><col style="width: 50%"/></colgroup><thead><tr>
                  <th>Event Class</th>
                  <th>Field Name</th>
                </tr></thead><tbody><tr>
                  <td><code class="literal">general</code></td>
                  <td><code class="literal">general_query.str</code></td>
                </tr><tr>
                  <td><code class="literal">table_access</code></td>
                  <td><code class="literal">query.str</code></td>
                </tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>
              Replacement is conditional. Each replacement specification
              in a filter definition includes a condition, enabling a
              replaceable field to be changed, or left unchanged,
              depending on the condition result.
            </p></li><li class="listitem"><p>
              If replacement occurs, the replacement specification
              indicates the replacement value using a function that is
              permitted for that purpose.
            </p></li></ul></div><p>
          As <a class="xref" href="audit-log-filter-definitions.html#audit-log-replaceable-event-fields" title="Table&nbsp;6.43&nbsp;Event Fields Subject to Replacement">Table&nbsp;6.43, &ldquo;Event Fields Subject to Replacement&rdquo;</a> shows,
          currently the only replaceable fields are those that contain
          statement text (which occurs in events of the
          <code class="literal">general</code> and <code class="literal">table_access</code>
          classes). In addition, the only function permitted for
          specifying the replacement value is
          <code class="literal">query_digest</code>. This means that the only
          permitted replacement operation is to replace statement
          literal text by its corresponding digest.
        </p><p>
          Because field replacement occurs at an early auditing stage
          (during filtering), the choice of whether to write statement
          literal text or digest values applies regardless of log format
          written later (that is, whether the audit log plugin produces
          XML or JSON output).
        </p><p>
          Field replacement can take place at differing levels of event
          granularity:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              To perform field replacement for all events in a class,
              filter events at the class level.
            </p></li><li class="listitem"><p>
              To perform replacement on a more fine-grained basis,
              include additional event-selection items. For example, you
              can perform field replacement only for specific subclasses
              of a given event class, or only in events for which fields
              have certain characteristics.
            </p></li></ul></div><p>
          Within a filter definition, specify field replacement by
          including a <code class="literal">print</code> item, which has this
          syntax:
        </p><pre class="programlisting">&#34;print&#34;: {
  &#34;field&#34;: {
    &#34;name&#34;: &#34;<em class="replaceable"><code>field_name</code></em>&#34;,
    &#34;print&#34;: <em class="replaceable"><code>condition</code></em>,
    &#34;replace&#34;: <em class="replaceable"><code>replacement_value</code></em>
  }
}
</pre><p>
          Within the <code class="literal">print</code> item, its
          <code class="literal">field</code> item takes these three items to
          indicate how whether and how replacement occurs:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">name</code>: The field for which replacement
              (potentially) occurs.
              <em class="replaceable"><code>field_name</code></em> must be one of those
              shown in
              <a class="xref" href="audit-log-filter-definitions.html#audit-log-replaceable-event-fields" title="Table&nbsp;6.43&nbsp;Event Fields Subject to Replacement">Table&nbsp;6.43, &ldquo;Event Fields Subject to Replacement&rdquo;</a>.
            </p></li><li class="listitem"><p>
              <code class="literal">print</code>: The condition that determines
              whether to retain the original field value or replace it:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  If <em class="replaceable"><code>condition</code></em> evaluates to
                  <code class="literal">true</code>, the field remains unchanged.
                </p></li><li class="listitem"><p>
                  If <em class="replaceable"><code>condition</code></em> evaluates to
                  <code class="literal">false</code>, replacement occurs, using
                  the value of the <code class="literal">replace</code> item.
                </p></li></ul></div><p>
              To unconditionally replace a field, specify the condition
              like this:
            </p><pre class="programlisting">&#34;print&#34;: false
</pre></li><li class="listitem"><p>
              <code class="literal">replace</code>: The replacement value to use
              when the <code class="literal">print</code> condition evaluates to
              <code class="literal">false</code>. Specify
              <em class="replaceable"><code>replacement_value</code></em> using a
              <code class="literal">function</code> item.
            </p></li></ul></div><p>
          For example, this filter definition applies to all events in
          the <code class="literal">general</code> class, replacing the statement
          literal text with its digest:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: {
      &#34;name&#34;: &#34;general&#34;,
      &#34;print&#34;: {
        &#34;field&#34;: {
          &#34;name&#34;: &#34;general_query.str&#34;,
          &#34;print&#34;: false,
          &#34;replace&#34;: {
            &#34;function&#34;: {
              &#34;name&#34;: &#34;query_digest&#34;
            }
          }
        }
      }
    }
  }
}
</pre><p>
          The preceding filter uses this <code class="literal">print</code> item
          to unconditionally replace the statement literal text
          contained in <code class="literal">general_query.str</code> by its
          digest value:
        </p><pre class="programlisting">&#34;print&#34;: {
  &#34;field&#34;: {
    &#34;name&#34;: &#34;general_query.str&#34;,
    &#34;print&#34;: false,
    &#34;replace&#34;: {
      &#34;function&#34;: {
        &#34;name&#34;: &#34;query_digest&#34;
      }
    }
  }
}
</pre><p>
          <code class="literal">print</code> items can be written different ways
          to implement different replacement strategies. The
          <code class="literal">replace</code> item just shown specifies the
          replacement text using this <code class="literal">function</code>
          construct to return a string representing the current
          statement digest:
        </p><pre class="programlisting">&#34;function&#34;: {
  &#34;name&#34;: &#34;query_digest&#34;
}
</pre><p>
          The <code class="literal">query_digest</code> function can also be used
          in another way, as a comparator that returns a Boolean, which
          enables its use in the <code class="literal">print</code> condition. To
          do this, provide an argument that specifies a comparison
          statement digest:
        </p><pre class="programlisting">&#34;function&#34;: {
  &#34;name&#34;: &#34;query_digest&#34;,
  &#34;args&#34;: &#34;<em class="replaceable"><code>digest</code></em>&#34;
}
</pre><p>
          In this case, <code class="literal">query_digest</code> returns
          <code class="literal">true</code> or <code class="literal">false</code> depending
          on whether the current statement digest is the same as the
          comparison digest. Using <code class="literal">query_digest</code> this
          way enables filter definitions to detect statements that match
          particular digests. The condition in the following construct
          is true only for statements that have a digest equal to
          <code class="literal">SELECT ?</code>, thus effecting replacement only
          for statements that do not match the digest:
        </p><pre class="programlisting">&#34;print&#34;: {
  &#34;field&#34;: {
    &#34;name&#34;: &#34;general_query.str&#34;,
    &#34;print&#34;: {
      &#34;function&#34;: {
        &#34;name&#34;: &#34;query_digest&#34;,
        &#34;args&#34;: &#34;SELECT ?&#34;
      }
    },
    &#34;replace&#34;: {
      &#34;function&#34;: {
        &#34;name&#34;: &#34;query_digest&#34;
      }
    }
  }
}
</pre><p>
          To perform replacement only for statements that do match the
          digest, use <code class="literal">not</code> to invert the condition:
        </p><pre class="programlisting">&#34;print&#34;: {
  &#34;field&#34;: {
    &#34;name&#34;: &#34;general_query.str&#34;,
    &#34;print&#34;: {
      &#34;not&#34;: {
        &#34;function&#34;: {
          &#34;name&#34;: &#34;query_digest&#34;,
          &#34;args&#34;: &#34;SELECT ?&#34;
        }
      }
    },
    &#34;replace&#34;: {
      &#34;function&#34;: {
        &#34;name&#34;: &#34;query_digest&#34;
      }
    }
  }
}
</pre><p>
          Suppose that you want the audit log to contain only statement
          digests and not literal statements. To achieve this, you must
          perform replacement on all events that contain statement text;
          that is, events in the <code class="literal">general</code> and
          <code class="literal">table_access</code> classes. An earlier filter
          definition showed how to unconditionally replace statement
          text for <code class="literal">general</code> events. To do the same for
          <code class="literal">table_access</code> events, use a filter that is
          similar but changes the class from <code class="literal">general</code>
          to <code class="literal">table_access</code> and the field name from
          <code class="literal">general_query.str</code> to
          <code class="literal">query.str</code>:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: {
      &#34;name&#34;: &#34;table_access&#34;,
      &#34;print&#34;: {
        &#34;field&#34;: {
          &#34;name&#34;: &#34;query.str&#34;,
          &#34;print&#34;: false,
          &#34;replace&#34;: {
            &#34;function&#34;: {
              &#34;name&#34;: &#34;query_digest&#34;
            }
          }
        }
      }
    }
  }
}
</pre><p>
          Combining the <code class="literal">general</code> and
          <code class="literal">table_access</code> filters results in a single
          filter that performs replacement for all statement
          text-containing events:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: [
      {
        &#34;name&#34;: &#34;general&#34;,
        &#34;print&#34;: {
          &#34;field&#34;: {
            &#34;name&#34;: &#34;general_query.str&#34;,
            &#34;print&#34;: false,
            &#34;replace&#34;: {
              &#34;function&#34;: {
                &#34;name&#34;: &#34;query_digest&#34;
              }
            }
          }
        }
      },
      {
        &#34;name&#34;: &#34;table_access&#34;,
        &#34;print&#34;: {
          &#34;field&#34;: {
            &#34;name&#34;: &#34;query.str&#34;,
            &#34;print&#34;: false,
            &#34;replace&#34;: {
              &#34;function&#34;: {
                &#34;name&#34;: &#34;query_digest&#34;
              }
            }
          }
        }
      }
    ]
  }
}
</pre><p>
          To perform replacement on only some events within a class, add
          items to the filter that indicate more specifically when
          replacement occurs. The following filter applies to events in
          the <code class="literal">table_access</code> class, but performs
          replacement only for <code class="literal">insert</code> and
          <code class="literal">update</code> events (leaving
          <code class="literal">read</code> and <code class="literal">delete</code> events
          unchanged):
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: {
      &#34;name&#34;: &#34;table_access&#34;,
      &#34;event&#34;: {
        &#34;name&#34;: [
          &#34;insert&#34;,
          &#34;update&#34;
        ],
        &#34;print&#34;: {
          &#34;field&#34;: {
            &#34;name&#34;: &#34;query.str&#34;,
            &#34;print&#34;: false,
            &#34;replace&#34;: {
              &#34;function&#34;: {
                &#34;name&#34;: &#34;query_digest&#34;
              }
            }
          }
        }
      }
    }
  }
}
</pre><p>
          This filter performs replacement for
          <code class="literal">general</code> class events corresponding to the
          listed account-management statements (the effect being to hide
          credential and data values in the statements):
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;class&#34;: {
      &#34;name&#34;: &#34;general&#34;,
      &#34;event&#34;: {
        &#34;name&#34;: &#34;status&#34;,
        &#34;print&#34;: {
          &#34;field&#34;: {
            &#34;name&#34;: &#34;general_query.str&#34;,
            &#34;print&#34;: false,
            &#34;replace&#34;: {
              &#34;function&#34;: {
                &#34;name&#34;: &#34;query_digest&#34;
              }
            }
          }
        },
        &#34;log&#34;: {
          &#34;or&#34;: [
            {
              &#34;field&#34;: {
                &#34;name&#34;: &#34;general_sql_command.str&#34;,
                &#34;value&#34;: &#34;alter_user&#34;
              }
            },
            {
              &#34;field&#34;: {
                &#34;name&#34;: &#34;general_sql_command.str&#34;,
                &#34;value&#34;: &#34;alter_user_default_role&#34;
              }
            },
            {
              &#34;field&#34;: {
                &#34;name&#34;: &#34;general_sql_command.str&#34;,
                &#34;value&#34;: &#34;create_role&#34;
              }
            },
            {
              &#34;field&#34;: {
                &#34;name&#34;: &#34;general_sql_command.str&#34;,
                &#34;value&#34;: &#34;create_user&#34;
              }
            }
          ]
        }
      }
    }
  }
}
</pre><p>
          For information about the possible
          <code class="literal">general_sql_command.str</code> values, see
          <a class="xref" href="audit-log-filter-definitions.html#audit-log-filtering-event-fields" title="Testing Event Field Values">Testing Event Field Values</a>.
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="audit-log-filtering-filter-replacement"></a>Replacing a User Filter</h5></div></div></div><p>
          In some cases, the filter definition can be changed
          dynamically. To do this, define a <code class="literal">filter</code>
          configuration within an existing <code class="literal">filter</code>.
          For example:
        </p><pre class="programlisting">{
  &#34;filter&#34;: {
    &#34;id&#34;: &#34;main&#34;,
    &#34;class&#34;: {
      &#34;name&#34;: &#34;table_access&#34;,
      &#34;event&#34;: {
        &#34;name&#34;: [ &#34;update&#34;, &#34;delete&#34; ],
        &#34;log&#34;: false,
        &#34;filter&#34;: {
          &#34;class&#34;: {
            &#34;name&#34;: &#34;general&#34;,
            &#34;event&#34; : { &#34;name&#34;: &#34;status&#34;,
                        &#34;filter&#34;: { &#34;ref&#34;: &#34;main&#34; } }
          },
          &#34;activate&#34;: {
            &#34;or&#34;: [
              { &#34;field&#34;: { &#34;name&#34;: &#34;table_name.str&#34;, &#34;value&#34;: &#34;temp_1&#34; } },
              { &#34;field&#34;: { &#34;name&#34;: &#34;table_name.str&#34;, &#34;value&#34;: &#34;temp_2&#34; } }
            ]
          }
        }
      }
    }
  }
}
</pre><p>
          A new filter is activated when the <code class="literal">activate</code>
          item within a subfilter evaluates to <code class="literal">true</code>.
          Using <code class="literal">activate</code> in a top-level
          <code class="literal">filter</code> is not permitted.
        </p><p>
          A new filter can be replaced with the original one by using a
          <code class="literal">ref</code> item inside the subfilter to refer to
          the original filter <code class="literal">id</code>.
        </p><p>
          The filter shown operates like this:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The <code class="literal">main</code> filter waits for
              <code class="literal">table_access</code> events, either
              <code class="literal">update</code> or <code class="literal">delete</code>.
            </p></li><li class="listitem"><p>
              If the <code class="literal">update</code> or
              <code class="literal">delete</code> <code class="literal">table_access</code>
              event occurs on the <code class="literal">temp_1</code> or
              <code class="literal">temp_2</code> table, the filter is replaced
              with the internal one (without an <code class="literal">id</code>,
              since there is no need to refer to it explicitly).
            </p></li><li class="listitem"><p>
              If the end of the command is signalled
              (<code class="literal">general</code> / <code class="literal">status</code>
              event), an entry is written to the audit log file and the
              filter is replaced with the <code class="literal">main</code>
              filter.
            </p></li></ul></div><p>
          The filter is useful to log statements that update or delete
          anything from the <code class="literal">temp_1</code> or
          <code class="literal">temp_2</code> tables, such as this one:
        </p><pre class="programlisting">UPDATE temp_1, temp_3 SET temp_1.a=21, temp_3.a=23;
</pre><p>
          The statement generates multiple
          <code class="literal">table_access</code> events, but the audit log file
          contains only <code class="literal">general</code> /
          <code class="literal">status</code> entries.
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p>
            Any <code class="literal">id</code> values used in the definition are
            evaluated with respect only to that definition. They have
            nothing to do with the value of the
            <a class="link" href="audit-log-reference.html#sysvar_audit_log_filter_id"><code class="literal">audit_log_filter_id</code></a> system
            variable.
          </p></div></div></div><div class="navigation"><ul><li class="navLinkPrevious"><a title="Go To Previous Page" href="audit-log-filtering.html">Previous <span class="navHint"> Audit Log Filtering </span></a></li><li class="navLinkHome"><a title="Go To Home Page" href="performance-schema">Home <span class="navHint"> MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0 </span></a></li><li class="navLinkUp"><a title="Go Up A Level In The Navigation" href="audit-log.html">Up <span class="navHint"> MySQL Enterprise Audit </span></a></li><li class="navLinkNext"><a title="Go To Next Page" href="audit-log-disabling.html">Next <span class="navHint"> Disabling Audit Logging </span></a></li></ul></div><div class="dochomelink-footer"><a title="Go to MySQL Doc Library" href="https://docs.oracle.com/cd/E17952_01/index.html">
        MySQL Documentation Library
      </a></div><div class="copyright-footer"></div></body></html>