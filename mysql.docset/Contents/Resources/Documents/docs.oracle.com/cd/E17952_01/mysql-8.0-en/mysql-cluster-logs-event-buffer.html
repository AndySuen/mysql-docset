<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><a class="dashingAutolink" name="autolink-2171"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/23.6.2.3%C2%A0Event%20Buffer%20Reporting%20in%20the%20Cluster%20Log"></a><title>23.6.2.3&nbsp;Event Buffer Reporting in the Cluster Log</title><link rel="stylesheet" type="text/css" href="mvl-otn.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/><link rel="home" href="performance-schema" title="MySQL 8.0 Reference Manual"/><link rel="up" href="mysql-cluster-logs-ndb-messages.html" title="23.6.2&nbsp;NDB Cluster Log Messages"/><link rel="prev" href="mysql-cluster-log-startup-messages.html" title="23.6.2.2&nbsp;NDB Cluster Log Startup Messages"/><link rel="next" href="mysql-cluster-ndb-transporter-errors.html" title="23.6.2.4&nbsp;NDB Cluster: NDB Transporter Errors"/><script>window.ohcglobal || document.write('<script src="../../../en/dcommon/js/global.js">\x3C/script>')</script></head><body><div class="skip-link"><a href="mysql-cluster-logs-event-buffer.html#mysql-cluster-logs-event-buffer">Skip to Main Content</a></div><div class="DocTitle"><p>MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0</p></div><div class="navigation"><ul><li class="navLinkPrevious"><a accesskey="p" title="Go To Previous Page&nbsp;[access key: p]" href="mysql-cluster-log-startup-messages.html">Previous <span class="navHint"> NDB Cluster Log Startup Messages </span></a></li><li class="navLinkHome"><a accesskey="h" title="Go To Home Page&nbsp;[access key: h]" href="performance-schema">Home <span class="navHint"> MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0 </span></a></li><li class="navLinkUp"><a accesskey="u" title="Go Up A Level In The Navigation&nbsp;[access key: u]" href="mysql-cluster-logs-ndb-messages.html">Up <span class="navHint"> NDB Cluster Log Messages </span></a></li><li class="navLinkNext"><a accesskey="n" title="Go To Next Page&nbsp;[access key: n]" href="mysql-cluster-ndb-transporter-errors.html">Next <span class="navHint"> NDB Cluster: NDB Transporter Errors </span></a></li></ul></div><div class="section"><div class="titlepage"><div><div><a class="dashingAutolink" name="autolink-2170"></a><a class="dashAnchor" name="//apple_ref/cpp/Section/23.6.2.3%C2%A0Event%20Buffer%20Reporting%20in%20the%20Cluster%20Log"></a><h4 class="title"><a id="mysql-cluster-logs-event-buffer"></a>23.6.2.3&nbsp;Event Buffer Reporting in the Cluster Log</h4></div></div></div><p>
        <code class="literal">NDB</code> uses one or more memory buffers for
        events received from the data nodes. There is one such buffer
        for each <a class="ulink" href="https://docs.oracle.com/cd/E17952_01/ndbapi-en/ndb-ndb.html" target="_top"><code class="literal">Ndb</code></a> object subscribing
        to table events, which means that there are usually two buffers
        for each <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> performing binary logging
        (one buffer for schema events, and one for data events). Each
        buffer contains epochs made up of events. These events consist
        of operation types (insert, update, delete) and row data (before
        and after images plus metadata).
      </p><p>
        <code class="literal">NDB</code> generates messages in the cluster log to
        describe the state of these buffers. Although these reports
        appear in the cluster log, they refer to buffers on API nodes
        (unlike most other cluster log messages, which are generated by
        data nodes).
      </p><p>
        Event buffer logging reports in the cluster log use the format
        shown here:
      </p><pre class="programlisting">Node <em class="replaceable"><code>node_id</code></em>: Event buffer status (<em class="replaceable"><code>object_id</code></em>):
used=<em class="replaceable"><code>bytes_used</code></em> (<em class="replaceable"><code>percent_used</code></em>% of alloc)
alloc=<em class="replaceable"><code>bytes_allocated</code></em> (<em class="replaceable"><code>percent_alloc</code></em>% of max) max=<em class="replaceable"><code>bytes_available</code></em>
latest_consumed_epoch=<em class="replaceable"><code>latest_consumed_epoch</code></em>
latest_buffered_epoch=<em class="replaceable"><code>latest_buffered_epoch</code></em>
report_reason=<em class="replaceable"><code>report_reason</code></em>
</pre><p>
        The fields making up this report are listed here, with
        descriptions:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <em class="replaceable"><code>node_id</code></em>: ID of the node where the
            report originated.
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>object_id</code></em>: ID of the
            <a class="ulink" href="https://docs.oracle.com/cd/E17952_01/ndbapi-en/ndb-ndb.html" target="_top"><code class="literal">Ndb</code></a> object where the report
            originated.
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>bytes_used</code></em>: Number of bytes used
            by the buffer.
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>percent_used</code></em>: Percentage of
            allocated bytes used.
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>bytes_allocated</code></em>: Number of bytes
            allocated to this buffer.
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>percent_alloc</code></em>: Percentage of
            available bytes used; not printed if
            <a class="link" href="mysql-cluster-options-variables.html#sysvar_ndb_eventbuffer_max_alloc"><code class="literal">ndb_eventbuffer_max_alloc</code></a>
            is equal to 0 (unlimited).
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>bytes_available</code></em>: Number of bytes
            available; this is 0 if
            <code class="literal">ndb_eventbuffer_max_alloc</code> is 0
            (unlimited).
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>latest_consumed_epoch</code></em>: The epoch
            most recently consumed to completion. (In NDB API
            applications, this is done by calling
            <a class="ulink" href="https://docs.oracle.com/cd/E17952_01/ndbapi-en/ndb-ndb.html#ndb-ndb-nextevent" target="_top"><code class="literal">nextEvent()</code></a>.)
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>latest_buffered_epoch</code></em>: The epoch
            most recently buffered (completely) in the event buffer.
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>report_reason</code></em>: The reason for
            making the report. Possible reasons are shown later in this
            section.
          </p></li></ul></div><p>
        Possible reasons for reporting are described in the following
        list:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">ENOUGH_FREE_EVENTBUFFER</code>: The event buffer
            has sufficient space.
          </p><p>
            <code class="literal">LOW_FREE_EVENTBUFFER</code>: The event buffer is
            running low on free space.
          </p><p>
            The threshold free percentage level triggering these reports
            can be adjusted by setting the
            <a class="link" href="mysql-cluster-options-variables.html#sysvar_ndb_report_thresh_binlog_mem_usage"><code class="literal">ndb_report_thresh_binlog_mem_usage</code></a>
            server variable.
          </p></li><li class="listitem"><p>
            <code class="literal">BUFFERED_EPOCHS_OVER_THRESHOLD</code>: Whether
            the number of buffered epochs has exceeded the configured
            threshold. This number is the difference between the latest
            epoch that has been received in its entirety and the epoch
            that has most recently been consumed (in NDB API
            applications, this is done by calling
            <a class="ulink" href="https://docs.oracle.com/cd/E17952_01/ndbapi-en/ndb-ndb.html#ndb-ndb-nextevent" target="_top"><code class="literal">nextEvent()</code></a> or
            <a class="ulink" href="https://docs.oracle.com/cd/E17952_01/ndbapi-en/ndb-ndb.html#ndb-ndb-nextevent2" target="_top"><code class="literal">nextEvent2()</code></a>). The
            report is generated every second until the number of
            buffered epochs goes below the threshold, which can be
            adjusted by setting the
            <a class="link" href="mysql-cluster-options-variables.html#sysvar_ndb_report_thresh_binlog_epoch_slip"><code class="literal">ndb_report_thresh_binlog_epoch_slip</code></a>
            server variable. You can also adjust the threshold in NDB
            API applications by calling
            <a class="ulink" href="https://docs.oracle.com/cd/E17952_01/ndbapi-en/ndb-ndb.html#ndb-ndb-seteventbufferqueueemptyepoch" target="_top"><code class="literal">setEventBufferQueueEmptyEpoch()</code></a>.
          </p></li><li class="listitem"><p>
            <code class="literal">PARTIALLY_DISCARDING</code>: Event buffer memory
            is exhausted&mdash;that is, 100% of
            <a class="link" href="mysql-cluster-options-variables.html#sysvar_ndb_eventbuffer_max_alloc"><code class="literal">ndb_eventbuffer_max_alloc</code></a>
            has been used. Any partially buffered epoch is buffered to
            completion even is usage exceeds 100%, but any new epochs
            received are discarded. This means that a gap has occurred
            in the event stream.
          </p></li><li class="listitem"><p>
            <code class="literal">COMPLETELY_DISCARDING</code>: No epochs are
            buffered.
          </p></li><li class="listitem"><p>
            <code class="literal">PARTIALLY_BUFFERING</code>: The buffer free
            percentage following the gap has risen to the threshold,
            which can be set in the <a class="link" href="mysql.html" title="4.5.1&nbsp;mysql &mdash; The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client
            using the
            <a class="link" href="mysql-cluster-options-variables.html#sysvar_ndb_eventbuffer_free_percent"><code class="literal">ndb_eventbuffer_free_percent</code></a>
            server system variable or in NDB API applications by calling
            <a class="ulink" href="https://docs.oracle.com/cd/E17952_01/ndbapi-en/ndb-ndb.html#ndb-ndb-set-eventbuffer-free-percent" target="_top"><code class="literal">set_eventbuffer_free_percent()</code></a>.
            New epochs are buffered. Epochs that could not be completed
            due to the gap are discarded.
          </p></li><li class="listitem"><p>
            <code class="literal">COMPLETELY_BUFFERING</code>: All epochs received
            are being buffered, which means that there is sufficient
            event buffer memory. The gap in the event stream has been
            closed.
          </p></li></ul></div></div><div class="navigation"><ul><li class="navLinkPrevious"><a title="Go To Previous Page" href="mysql-cluster-log-startup-messages.html">Previous <span class="navHint"> NDB Cluster Log Startup Messages </span></a></li><li class="navLinkHome"><a title="Go To Home Page" href="performance-schema">Home <span class="navHint"> MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0 </span></a></li><li class="navLinkUp"><a title="Go Up A Level In The Navigation" href="mysql-cluster-logs-ndb-messages.html">Up <span class="navHint"> NDB Cluster Log Messages </span></a></li><li class="navLinkNext"><a title="Go To Next Page" href="mysql-cluster-ndb-transporter-errors.html">Next <span class="navHint"> NDB Cluster: NDB Transporter Errors </span></a></li></ul></div><div class="dochomelink-footer"><a title="Go to MySQL Doc Library" href="https://docs.oracle.com/cd/E17952_01/index.html">
        MySQL Documentation Library
      </a></div><div class="copyright-footer"></div></body></html>