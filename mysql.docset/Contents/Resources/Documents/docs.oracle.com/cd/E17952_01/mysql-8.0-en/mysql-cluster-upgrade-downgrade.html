<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><a class="dashingAutolink" name="autolink-2531"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/23.3.7%C2%A0Upgrading%20and%20Downgrading%20NDB%20Cluster"></a><title>23.3.7&nbsp;Upgrading and Downgrading NDB Cluster</title><link rel="stylesheet" type="text/css" href="mvl-otn.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/><link rel="home" href="performance-schema" title="MySQL 8.0 Reference Manual"/><link rel="up" href="mysql-cluster-installation.html" title="23.3&nbsp;NDB Cluster Installation"/><link rel="prev" href="mysql-cluster-install-shutdown-restart.html" title="23.3.6&nbsp;Safe Shutdown and Restart of NDB Cluster"/><link rel="next" href="mysql-cluster-installer.html" title="23.3.8&nbsp;The NDB Cluster Auto-Installer (NO LONGER SUPPORTED)"/><script>window.ohcglobal || document.write('<script src="../../../en/dcommon/js/global.js">\x3C/script>')</script></head><body><div class="skip-link"><a href="mysql-cluster-upgrade-downgrade.html#mysql-cluster-upgrade-downgrade">Skip to Main Content</a></div><div class="DocTitle"><p>MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0</p></div><div class="navigation"><ul><li class="navLinkPrevious"><a accesskey="p" title="Go To Previous Page&nbsp;[access key: p]" href="mysql-cluster-install-shutdown-restart.html">Previous <span class="navHint"> Safe Shutdown and Restart of NDB Cluster </span></a></li><li class="navLinkHome"><a accesskey="h" title="Go To Home Page&nbsp;[access key: h]" href="performance-schema">Home <span class="navHint"> MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0 </span></a></li><li class="navLinkUp"><a accesskey="u" title="Go Up A Level In The Navigation&nbsp;[access key: u]" href="mysql-cluster-installation.html">Up <span class="navHint"> NDB Cluster Installation </span></a></li><li class="navLinkNext"><a accesskey="n" title="Go To Next Page&nbsp;[access key: n]" href="mysql-cluster-installer.html">Next <span class="navHint"> The NDB Cluster Auto-Installer (NO LONGER SUPPORTED) </span></a></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mysql-cluster-upgrade-downgrade"></a>23.3.7&nbsp;Upgrading and Downgrading NDB Cluster</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="mysql-cluster-upgrade-downgrade.html#mysql-cluster-upgrade-versions" title="Versions Supported for Upgrade to NDB 8.0">Versions Supported for Upgrade to NDB 8.0</a></p></li><li class="listitem"><p><a class="xref" href="mysql-cluster-upgrade-downgrade.html#mysql-cluster-revert-upgrade" title="Reverting an NDB Cluster 8.0 Upgrade">Reverting an NDB Cluster 8.0 Upgrade</a></p></li><li class="listitem"><p><a class="xref" href="mysql-cluster-upgrade-downgrade.html#mysql-cluster-updowngrade-issues" title="Known Issues When Upgrading or Downgrading NDB Cluster">Known Issues When Upgrading or Downgrading NDB Cluster</a></p></li></ul></div><a id="idm45828842038912" class="indexterm"></a><a id="idm45828842037424" class="indexterm"></a><a id="idm45828842035936" class="indexterm"></a><a id="idm45828842034448" class="indexterm"></a><p>
      This section provides information about NDB Cluster software and
      compatibility between different NDB Cluster 8.0 releases with
      regard to performing upgrades and downgrades. You should already
      be familiar with installing and configuring NDB Cluster prior to
      attempting an upgrade or downgrade. See
      <a class="xref" href="mysql-cluster-configuration.html" title="23.4&nbsp;Configuration of NDB Cluster">Section&nbsp;23.4, &ldquo;Configuration of NDB Cluster&rdquo;</a>.
    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Important</div><p>
        Online upgrades and downgrades between minor releases of the
        <code class="literal">NDB</code> storage engine are supported within NDB
        8.0. In-place upgrades of the included MySQL Server (SQL node
        <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>) are also supported; with multiple SQL
        nodes, it is possible to keep an SQL application online while
        individual <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> processes are restarted.
        In-place downgrades of the included MySQL Server are
        <span class="emphasis"><em>not</em></span> supported (see
        <a class="xref" href="downgrading.html" title="2.11&nbsp;Downgrading MySQL">Section&nbsp;2.11, &ldquo;Downgrading MySQL&rdquo;</a>).
      </p><p>
        It may be possible in some cases to revert a recent upgrade from
        one NDB 8.0 minor release version to a later one, and to restore
        the needed states of any MySQL Server instances running as SQL
        nodes. Against the event that this becomes desirable or
        necessary, you are strongly advised to take a complete backup of
        each SQL node prior to upgrading NDB Cluster. For the same
        reason, you should also start the <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
        binaries from the new version with
        <a class="link" href="mysql-cluster-options-variables.html#sysvar_ndb_schema_dist_upgrade_allowed"><code class="option">--ndb-schema-dist-upgrade-allowed=0</code></a>,
        and not allow it to be set back to 1 until you are sure any
        likelihood of reverting to an older version is past. For more
        information, see <a class="xref" href="mysql-cluster-upgrade-downgrade.html#mysql-cluster-revert-upgrade" title="Reverting an NDB Cluster 8.0 Upgrade">Reverting an NDB Cluster 8.0 Upgrade</a>.
      </p></div><p>
      For information about upgrades to NDB 8.0 from versions previous
      to 8.0, see <a class="xref" href="mysql-cluster-upgrade-downgrade.html#mysql-cluster-upgrade-versions" title="Versions Supported for Upgrade to NDB 8.0">Versions Supported for Upgrade to NDB 8.0</a>.
    </p><p>
      For information about known issues and problems encountered when
      upgrading or downgrading NDB 8.0, see
      <a class="xref" href="mysql-cluster-upgrade-downgrade.html#mysql-cluster-updowngrade-issues" title="Known Issues When Upgrading or Downgrading NDB Cluster">Known Issues When Upgrading or Downgrading NDB Cluster</a>.
    </p><div class="simplesect"><div class="titlepage"><div><div><a class="dashingAutolink" name="autolink-2532"></a><a class="dashAnchor" name="//apple_ref/cpp/Section/Versions%20Supported%20for%20Upgrade%20to%20NDB%208.0"></a><h4 class="title"><a id="mysql-cluster-upgrade-versions"></a>Versions Supported for Upgrade to NDB 8.0</h4></div></div></div><p>
        The following versions of NDB Cluster are supported for upgrades
        to GA releases of NDB Cluster 8.0 (8.0.19 and later):
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            NDB Cluster 7.6: NDB 7.6.4 and later
          </p></li><li class="listitem"><p>
            NDB Cluster 7.5: NDB 7.5.4 and later
          </p></li><li class="listitem"><p>
            NDB Cluster 7.4: NDB 7.4.6 and later
          </p></li></ul></div><p>
        To upgrade from a release series previous to NDB 7.4, you must
        upgrade in stages, first to one of the versions just listed, and
        then from that version to the latest NDB 8.0 release. In such
        cases, upgrading to the latest NDB 7.6 release is recommended as
        the first step. For information about upgrades to NDB 7.6 from
        previous versions, see
        <a class="ulink" href="https://docs.oracle.com/cd/E17952_01/mysql-5.7-en/mysql-cluster-upgrade-downgrade-7-6.html" target="_top">Upgrading and Downgrading NDB 7.6</a>.
      </p></div><div class="simplesect"><div class="titlepage"><div><div><a class="dashingAutolink" name="autolink-2533"></a><a class="dashAnchor" name="//apple_ref/cpp/Section/Reverting%20an%20NDB%20Cluster%208.0%20Upgrade"></a><h4 class="title"><a id="mysql-cluster-revert-upgrade"></a>Reverting an NDB Cluster 8.0 Upgrade</h4></div></div></div><p>
        Following a recent software upgrade of an NDB Cluster to an NDB
        8.0 release, it is possible to revert the <code class="literal">NDB</code>
        software back to the earlier version, provided certain
        conditions are met before the upgrade, during the time the
        cluster is running the newer version, and after the NDB Cluster
        software is reverted to the earlier version. Specifics depend on
        local conditions; this section provides general information
        about what should be done at each of the points in the upgrade
        and rollback process just described.
      </p><p>
        In most cases, upgrading and downgrading the data nodes can be
        done without issue, as described elsewhere; see
        <a class="xref" href="mysql-cluster-rolling-restart.html" title="23.6.5&nbsp;Performing a Rolling Restart of an NDB Cluster">Section&nbsp;23.6.5, &ldquo;Performing a Rolling Restart of an NDB Cluster&rdquo;</a>. (Prior to
        performing an upgrade or downgrade, you should perform an
        <code class="literal">NDB</code> backup; see
        <a class="xref" href="mysql-cluster-backup.html" title="23.6.8&nbsp;Online Backup of NDB Cluster">Section&nbsp;23.6.8, &ldquo;Online Backup of NDB Cluster&rdquo;</a>, for information about
        how to do this.) Downgrading SQL nodes online is not supported,
        due to the following issues:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> from a version 8.0 release cannot
            start if it detects a file system from a later version of
            MySQL.
          </p></li><li class="listitem"><p>
            In many cases, <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> cannot open tables
            that were created or modified by a later version of MySQL.
          </p></li><li class="listitem"><p>
            In most if not all cases, <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> cannot
            read binary log files that were created or modified in a
            later version of MySQL.
          </p></li></ul></div><p>
        The procedure outlined next provides the basic steps necessary
        to upgrade a cluster from version <em class="replaceable"><code>X</code></em>
        to version <em class="replaceable"><code>Y</code></em> while allowing for a
        possible future rollback to <em class="replaceable"><code>X</code></em>. (The
        procedure for reverting the upgraded cluster to version
        <em class="replaceable"><code>X</code></em> follows later in this section.) For
        this purpose, version <em class="replaceable"><code>X</code></em> is any NDB
        8.0 GA release, or any previous NDB release supported for
        upgrade to NDB 8.0 (see
        <a class="xref" href="mysql-cluster-upgrade-downgrade.html#mysql-cluster-upgrade-versions" title="Versions Supported for Upgrade to NDB 8.0">Versions Supported for Upgrade to NDB 8.0</a>), and version
        <em class="replaceable"><code>Y</code></em> is an NDB 8.0 release which is
        later than <em class="replaceable"><code>X</code></em>.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="emphasis"><em>Prior to upgrade</em></span>: Take backups of NDB
            <em class="replaceable"><code>X</code></em> SQL node states. This can be
            accomplished as one or more of the following:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                A copy of the version <em class="replaceable"><code>X</code></em> SQL
                node file system in a quiescent state using one or more
                system tools such as
                <span class="command"><strong>cp</strong></span>,
                <span class="command"><strong>rsync</strong></span>,
                <span class="command"><strong>fwbackups</strong></span>, Amanda, and
                so forth.
              </p><p>
                A dump of any version <em class="replaceable"><code>X</code></em>
                tables not stored in <code class="literal">NDB</code>. You can
                generate this dump using <a class="link" href="mysqldump.html" title="4.5.4&nbsp;mysqldump &mdash; A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>.
              </p><p>
                A backup created using MySQL Enterprise Backup; see
                <a class="xref" href="mysql-enterprise-backup.html" title="30.2&nbsp;MySQL Enterprise Backup Overview">Section&nbsp;30.2, &ldquo;MySQL Enterprise Backup Overview&rdquo;</a>, for more
                information.
              </p></li></ul></div><p>
            Backing up the SQL nodes is recommended prior to any
            upgrade, whether or not you later intend to revert the
            cluster to the previous <code class="literal">NDB</code> version.
          </p></li><li class="listitem"><p>
            <span class="emphasis"><em>Upgrade to NDB
            <em class="replaceable"><code>Y</code></em></em></span>: All NDB
            <em class="replaceable"><code>Y</code></em> <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
            binaries must be started with
            <a class="link" href="mysql-cluster-options-variables.html#sysvar_ndb_schema_dist_upgrade_allowed"><code class="option">--ndb-schema-dist-upgrade-allowed=0</code></a>
            to prevent any automatic schema upgrade. (Once any
            possibility of a downgrade is past, you can safely change
            the corresponding system variable
            <code class="literal">ndb_schema_dist_upgrade_allowed</code> back to
            1, the default, in the <a class="link" href="mysql.html" title="4.5.1&nbsp;mysql &mdash; The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client.)
            When each NDB <em class="replaceable"><code>Y</code></em> SQL node starts,
            it connects to the cluster and synchronizes its
            <code class="literal">NDB</code> table schemas. After this, you can
            restore MySQL table and state data from backup.
          </p><p>
            To assure continuity of NDB replication, it is necessary to
            upgrade the cluster&#39;s SQL nodes in such a way that at
            least one <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is acting as the
            replication source at any given point in time during the
            upgrade. With two SQL nodes <em class="replaceable"><code>A</code></em> and
            <em class="replaceable"><code>B</code></em>, you can do so like this:
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                While using SQL node <em class="replaceable"><code>B</code></em> as the
                replication channel, upgrade SQL node
                <em class="replaceable"><code>A</code></em> from NDB version
                <em class="replaceable"><code>X</code></em> to version
                <em class="replaceable"><code>Y</code></em>. This results in a gap in
                the binary log on <em class="replaceable"><code>A</code></em> at epoch
                <em class="replaceable"><code>E1</code></em>.
              </p></li><li class="listitem"><p>
                After all replication appliers have consumed the binary
                log from SQL node <em class="replaceable"><code>B</code></em> past
                epoch <em class="replaceable"><code>E1</code></em>, switch the
                replication channel to use SQL node
                <em class="replaceable"><code>A</code></em>.
              </p></li><li class="listitem"><p>
                Upgrade SQL node <em class="replaceable"><code>B</code></em> to NDB
                version <em class="replaceable"><code>Y</code></em>. This results in a
                gap in the binary log on <em class="replaceable"><code>B</code></em> at
                epoch <em class="replaceable"><code>E2</code></em>.
              </p></li><li class="listitem"><p>
                After all replication appliers have consumed the binary
                log from SQL node <em class="replaceable"><code>A</code></em> past
                epoch <em class="replaceable"><code>E2</code></em>, you can once again
                switch the replication channel to use either SQL node as
                desired.
              </p></li></ol></div><p>
            Do not use <a class="link" href="alter-table.html" title="13.1.9&nbsp;ALTER TABLE Statement"><code class="literal">ALTER TABLE</code></a> on any
            existing <code class="literal">NDB</code> tables; do not create any
            new <code class="literal">NDB</code> tables which cannot be safely
            dropped prior to downgrading.
          </p></li></ul></div><p>
        The following procedure shows the basic steps needed to roll
        back (revert) an NDB Cluster from version
        <em class="replaceable"><code>X</code></em> to version
        <em class="replaceable"><code>Y</code></em> after an upgrade performed as just
        described. Here, version <em class="replaceable"><code>X</code></em> is any NDB
        8.0 GA release, or any previous NDB release supported for
        upgrade to NDB 8.0 (see
        <a class="xref" href="mysql-cluster-upgrade-downgrade.html#mysql-cluster-upgrade-versions" title="Versions Supported for Upgrade to NDB 8.0">Versions Supported for Upgrade to NDB 8.0</a>); version
        <em class="replaceable"><code>Y</code></em> is an NDB 8.0 release which is
        later than <em class="replaceable"><code>X</code></em>.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="emphasis"><em>Prior to rollback</em></span>: Gather any
            <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> state information from the NDB
            <em class="replaceable"><code>Y</code></em> SQL nodes that should be
            retained. In most cases, you can do this using
            <a class="link" href="mysqldump.html" title="4.5.4&nbsp;mysqldump &mdash; A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>.
          </p><p>
            After backing up the state data, drop all
            <code class="literal">NDB</code> tables which have been created or
            altered since the upgrade took place.
          </p><p>
            Backing up the SQL nodes is always recommended prior to any
            NDB Cluster software version change.
          </p><p>
            You must provide a file system compatible with MySQL
            <em class="replaceable"><code>X</code></em> for each
            <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> (SQL node). You can use either of
            the following two methods:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Create a new, compatible file system state by
                reinitializing the on-disk state of the version
                <em class="replaceable"><code>X</code></em> SQL node. You can do this
                by removing the SQL node file system, then running
                <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
                <a class="link" href="server-options.html#option_mysqld_initialize"><code class="option">--initialize</code></a>.
              </p></li><li class="listitem"><p>
                Restore a file system that is compatible from a backup
                taken prior to the upgrade (see
                <a class="xref" href="using-mysqldump.html" title="7.4&nbsp;Using mysqldump for Backups">Section&nbsp;7.4, &ldquo;Using mysqldump for Backups&rdquo;</a>).
              </p></li></ul></div></li><li class="listitem"><p>
            <span class="emphasis"><em>Following <code class="literal">NDB</code>
            downgrade</em></span>: After downgrading the data nodes to
            NDB <em class="replaceable"><code>X</code></em>, start the version
            <em class="replaceable"><code>X</code></em> SQL nodes (instances of
            <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>). Restore or repair any other
            local state information needed on each SQL node. The MySQLD
            state can be aligned as necessary with some combination (0
            or more) of the following actions:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Initialization commands such as
                <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> <code class="option">--initialize</code>.
              </p></li><li class="listitem"><p>
                Restore any desired or required state information
                captured from the version <em class="replaceable"><code>X</code></em>
                SQL node.
              </p></li><li class="listitem"><p>
                Restore any desired or required state information
                captured from the version <em class="replaceable"><code>Y</code></em>
                SQL node.
              </p></li><li class="listitem"><p>
                Perform cleanup such as deleting stale logs such as
                binary logs, or relay logs, and removing any
                time-dependent state which is no longer valid.
              </p></li></ul></div><p>
            As when upgrading, it is necessary when downgrading to
            maintain continuity of NDB replication to downgrade the
            cluster&#39;s SQL nodes in such a way that at least one
            <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is acting as the replication
            source at any given point in time during the downgrade
            process. This can be done in a manner very similar to that
            described previously for upgrading the SQL nodes. With two
            SQL nodes <em class="replaceable"><code>A</code></em> and
            <em class="replaceable"><code>B</code></em>, you can maintain binary
            logging without any gaps during the downgrade like this:
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                With SQL node <em class="replaceable"><code>B</code></em> acting as the
                replication channel, downgrade SQL node
                <em class="replaceable"><code>A</code></em> from NDB version
                <em class="replaceable"><code>Y</code></em> to version
                <em class="replaceable"><code>X</code></em>. This results in a gap in
                the binary log on <em class="replaceable"><code>A</code></em> at epoch
                <em class="replaceable"><code>F1</code></em>.
              </p></li><li class="listitem"><p>
                After all replication appliers have consumed the binary
                log from SQL node <em class="replaceable"><code>B</code></em> past
                epoch <em class="replaceable"><code>F1</code></em>, switch the
                replication channel to use SQL node
                <em class="replaceable"><code>A</code></em>.
              </p></li><li class="listitem"><p>
                Downgrade SQL node <em class="replaceable"><code>B</code></em> to NDB
                version <em class="replaceable"><code>X</code></em>. This results in a
                gap in the binary log on <em class="replaceable"><code>B</code></em> at
                epoch <em class="replaceable"><code>F2</code></em>.
              </p></li><li class="listitem"><p>
                After all replication appliers have consumed the binary
                log from SQL node <em class="replaceable"><code>A</code></em> past
                epoch <em class="replaceable"><code>F2</code></em>, redundancy of
                binary logging is restored, and you can again use either
                SQL node as the replication channel as desired.
              </p></li></ol></div><p>
            See also
            <a class="xref" href="mysql-cluster-replication-two-channels.html" title="23.7.7&nbsp;Using Two Replication Channels for NDB Cluster Replication">Section&nbsp;23.7.7, &ldquo;Using Two Replication Channels for NDB Cluster Replication&rdquo;</a>.
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><a class="dashingAutolink" name="autolink-2534"></a><a class="dashAnchor" name="//apple_ref/cpp/Section/Known%20Issues%20When%20Upgrading%20or%20Downgrading%20NDB%20Cluster"></a><h4 class="title"><a id="mysql-cluster-updowngrade-issues"></a>Known Issues When Upgrading or Downgrading NDB Cluster</h4></div></div></div><p>
        In this section, provide information about issues known to occur
        when upgrading or downgrading to, from, or between NDB 8.0
        releases.
      </p><p>
        We recommend that you not attempt any schema changes during any
        NDB Cluster software upgrade or downgrade. Some of the reasons
        for this are listed here:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            DDL statements on <code class="literal">NDB</code> tables are not
            possible during some phases of data node startup.
          </p></li><li class="listitem"><p>
            DDL statements on <code class="literal">NDB</code> tables may be
            rejected if any data nodes are stopped during execution;
            stopping each data node binary (so it can be replaced with a
            binary from the target version) is required as part of the
            upgrade or downgrade process.
          </p></li><li class="listitem"><p>
            DDL statements on <code class="literal">NDB</code> tables are not
            allowed while there are data nodes in the same cluster
            running different release versions of the NDB Cluster
            software.
          </p></li></ul></div><p>
        For additional information regarding the rolling restart
        procedure used to perform an online upgrade or downgrade of the
        data nodes, see <a class="xref" href="mysql-cluster-rolling-restart.html" title="23.6.5&nbsp;Performing a Rolling Restart of an NDB Cluster">Section&nbsp;23.6.5, &ldquo;Performing a Rolling Restart of an NDB Cluster&rdquo;</a>.
      </p><p>
        You should be aware of the issues in the following list when you
        perform an online upgrade between minor versions of NDB 8.0.
        These issues also apply when upgrading from a previous major
        version of NDB Cluster to any of the NDB 8.0 releases stated.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            NDB 8.0.22 adds support for IPv6 addressing for management
            nodes and data nodes in the <code class="filename">config.ini</code>
            file. To begin using IPv6 addresses as part of an upgrade,
            perform the following steps:
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                Perform an upgrade of the cluster to version 8.0.22 or a
                later version of the NDB Cluster software in the usual
                manner.
              </p></li><li class="listitem"><p>
                Change the addresses used in the
                <code class="filename">config.ini</code> file to IPv6 addresses.
              </p></li><li class="listitem"><p>
                Perform a system restart of the cluster.
              </p></li></ol></div><p>
            A known issue on Linux platforms when running NDB 8.0.22 and
            later is that the operating system kernel must provide IPv6
            support, even if no IPv6 addresses are in use. If you wish
            to disable support for IPv6 on the system (because you do
            not plan to use any IPv6 addresses for NDB Cluster nodes),
            do so after booting the system, like this:
          </p><pre class="programlisting">$&gt; <strong class="userinput"><code>sysctl -w net.ipv6.conf.all.disable_ipv6=1</code></strong>
$&gt; <strong class="userinput"><code>sysctl -w net.ipv6.conf.default.disable_ipv6=1</code></strong>
</pre><p>
            Alternatively, you can add the corresponding lines to
            <code class="filename">/etc/sysctl.conf</code>.
          </p></li><li class="listitem"><p>
            Due to changes in the internal
            <code class="literal">mysql.ndb_schema</code> table, if you upgrade to
            an NDB 8.0 release prior to 8.0.24, then you are advised to
            use <a class="link" href="mysql-cluster-options-variables.html#sysvar_ndb_schema_dist_upgrade_allowed"><code class="option">--ndb-schema-dist-upgrade-allowed
            = 0</code></a> to avoid unexpected outages (Bug #30876990, Bug
            #31016905).
          </p><p>
            In addition, if there is any possibility that you may revert
            to a previous version of NDB Cluster following an upgrade to
            a newer version, you must start all
            <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> processes from the newer version
            with <code class="option">--ndb-schema-dist-upgrade-allowed = 0</code>
            to prevent changes incompatible with the older version from
            being made to the <code class="literal">ndb_schema</code> table. See
            <a class="xref" href="mysql-cluster-upgrade-downgrade.html#mysql-cluster-revert-upgrade" title="Reverting an NDB Cluster 8.0 Upgrade">Reverting an NDB Cluster 8.0 Upgrade</a>, for
            information about how to do this.
          </p></li><li class="listitem"><p>
            The
            <a class="link" href="mysql-cluster-ndbd-definition.html#ndbparam-ndbd-encryptedfilesystem"><code class="literal">EncryptedFileSystem</code></a>
            configuration parameter, introduced in NDB 8.0.29, could in
            some cases cause undo log files to be encrypted, even when
            set explicitly to <code class="literal">0</code>, which could lead to
            issues when using Disk Data tables and attempting to upgrade
            or downgrade to NDB 8.0.29. In such cases, you can work
            around the problem by performing initial restarts of the
            data nodes as part of the rolling restart process.
          </p></li><li class="listitem"><p>
            If you are using multithreaded data nodes
            (<a class="link" href="mysql-cluster-programs-ndbmtd.html" title="23.5.3&nbsp;ndbmtd &mdash; The NDB Cluster Data Node Daemon (Multi-Threaded)"><span class="command"><strong>ndbmtd</strong></span></a>) and the
            <a class="link" href="mysql-cluster-ndbd-definition.html#ndbparam-ndbmtd-threadconfig"><code class="literal">ThreadConfig</code></a>
            configuration parameter, you may need to make changes in the
            value set for this in the <code class="filename">config.ini</code>
            file when upgrading from a previous release to NDB 8.0.30 or
            later. When upgrading from NDB 8.0.23 or earlier, any usage
            of <code class="literal">main</code>, <code class="literal">rep</code>,
            <code class="literal">recv</code>, or <code class="literal">ldm</code> threads
            that was implicit in the earlier version must be explicitly
            set. When upgrading from NDB 8.0.23 or later to NDB 8.0.30
            or later, any usage of <code class="literal">recv</code> threads must
            be set explicitly in the <code class="literal">ThreadConfig</code>
            string. In addition, to avoid using <code class="literal">main</code>,
            <code class="literal">rep</code>, or <code class="literal">ldm</code> threads in
            NDB 8.0.30 or later, you must set the thread count for the
            given type to <code class="literal">0</code> explicitly.
          </p><p>
            An example follows.
          </p><p>
            <span class="emphasis"><em>NDB 8.0.22 and earlier</em></span>:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="filename">config.ini</code> file contains
                <code class="literal">ThreadConfig=ldm</code>.
              </p></li><li class="listitem"><p>
                This is interpreted by these versions of
                <code class="literal">NDB</code> as
                <code class="literal">ThreadConfig=main,ldm,recv,rep</code>.
              </p></li><li class="listitem"><p>
                Required in <code class="filename">config.ini</code> to match
                effect in NDB 8.0.30 or later:
                <code class="literal">ThreadConfig=main,ldm,recv,rep</code>.
              </p></li></ul></div><p>
            <span class="emphasis"><em>NDB 8.0.23&mdash;8.0.29</em></span>:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="filename">config.ini</code> file contains
                <code class="literal">ThreadConfig=ldm</code>.
              </p></li><li class="listitem"><p>
                This is interpreted by these versions of
                <code class="literal">NDB</code> as
                <code class="literal">ThreadConfig=ldm,recv</code>.
              </p></li><li class="listitem"><p>
                Required in <code class="filename">config.ini</code> to match
                effect in NDB 8.0.30 or later:
                <code class="literal">ThreadConfig=main={count=0},ldm,recv,rep={count=0}</code>.
              </p></li></ul></div><p>
            For more information, see the description of the
            <a class="link" href="mysql-cluster-ndbd-definition.html#ndbparam-ndbmtd-threadconfig"><code class="literal">ThreadConfig</code></a>
            configuration parameter.
          </p></li></ul></div><p>
        Upgrades from previous major versions of NDB Cluster (7.4, 7.5,
        7.6) to NDB 8.0 are supported; see
        <a class="xref" href="mysql-cluster-upgrade-downgrade.html#mysql-cluster-upgrade-versions" title="Versions Supported for Upgrade to NDB 8.0">Versions Supported for Upgrade to NDB 8.0</a>, for specific
        versions. Such upgrades are subject to the issues listed here:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            In NDB 8.0, the default values changed for
            <a class="link" href="replication-options-binary-log.html#sysvar_log_bin"><code class="literal">log_bin</code></a> (from 0 to 1) and
            <a class="link" href="mysql-cluster-options-variables.html#sysvar_ndb_log_bin"><code class="literal">ndb_log_bin</code></a> (from 1 to 0).
            This means that you must now explicitly set
            <code class="literal">ndb_log_bin</code> to 1 to enable binary
            logging.
          </p></li><li class="listitem"><p>
            Distributed privileges shared between MySQL servers as
            implemented in prior release series (see
            <a class="ulink" href="https://docs.oracle.com/cd/E17952_01/mysql-5.7-en/mysql-cluster-privilege-distribution.html" target="_top">Distributed Privileges Using Shared Grant Tables</a>)
            are not supported in NDB Cluster 8.0. When started, the
            <a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> supplied with NDB 8.0 and later
            checks for the existence of any grant tables which use the
            <code class="literal">NDB</code> storage engine; if it finds any, it
            creates local copies (<span class="quote">&ldquo;<span class="quote">shadow tables</span>&rdquo;</span>) of these
            using <code class="literal">InnoDB</code>. This is true for each MySQL
            server connected to NDB Cluster. After this has been
            performed on all MySQL servers acting as NDB Cluster SQL
            nodes, the <code class="literal">NDB</code> grant tables may be safely
            removed using the <a class="link" href="mysql-cluster-programs-ndb-drop-table.html" title="23.5.11&nbsp;ndb_drop_table &mdash; Drop an NDB Table"><span class="command"><strong>ndb_drop_table</strong></span></a> utility
            supplied with the NDB Cluster distribution, like this:
          </p><pre class="programlisting">ndb_drop_table -d mysql user db columns_priv tables_priv proxies_priv procs_priv
</pre><p>
            It is safe to retain the <code class="literal">NDB</code> grant
            tables, but they are not used for access control and are
            effectively ignored.
          </p><p>
            For more information about the MySQL privileges system used
            in NDB 8.0, see
            <a class="xref" href="mysql-cluster-privilege-synchronization.html" title="23.6.13&nbsp;Privilege Synchronization and NDB_STORED_USER">Section&nbsp;23.6.13, &ldquo;Privilege Synchronization and NDB_STORED_USER&rdquo;</a>,
            as well as <a class="xref" href="grant-tables.html" title="6.2.3&nbsp;Grant Tables">Section&nbsp;6.2.3, &ldquo;Grant Tables&rdquo;</a>.
          </p></li><li class="listitem"><p>
            It is necessary to restart all data nodes with
            <a class="link" href="mysql-cluster-programs-ndbd.html#option_ndbd_initial"><code class="option">--initial</code></a> when upgrading any
            release prior to NDB 7.6 to any NDB 8.0 release. This is due
            to the addition of support for increased numbers of nodes in
            NDB 8.0.
          </p></li></ul></div><p>
        Issues encountered when trying to downgrade from NDB 8.0 to a
        previous major version can be found in the following list:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Tables created in NDB 8.0 are not backwards compatible with
            NDB 7.6 and earlier releases due to a change in usage of the
            extra metadata property implemented by
            <code class="literal">NDB</code> tables to provide full support for
            the MySQL data dictionary. This means that it is necessary
            to take extra steps to preserve any desired state
            information from the cluster&#39;s SQL nodes prior to the
            downgrade, and then to restore it afterwards.
          </p><p>
            More specifically, online downgrades of the
            <code class="literal">NDBCLUSTER</code> storage engine&mdash;that is,
            of the data nodes&mdash;are supported, but SQL nodes cannot
            be downgraded online. This is because a MySQL Server
            (<a class="link" href="mysqld.html" title="4.3.1&nbsp;mysqld &mdash; The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>) of a given MySQL 8.0 or earlier
            version cannot use system files from a (later) 8.0 version,
            and cannot open tables that were created in the later
            version. It may be possible to roll back a cluster that has
            recently been upgraded from a previous NDB release; see
            <a class="xref" href="mysql-cluster-upgrade-downgrade.html#mysql-cluster-revert-upgrade" title="Reverting an NDB Cluster 8.0 Upgrade">Reverting an NDB Cluster 8.0 Upgrade</a>, for
            information regarding when and how this can be done.
          </p><p>
            For additional information relating to these issues, see
            <a class="xref" href="mysql-cluster-what-is-new.html#mysql-cluster-what-is-new-8-0-extra-metadata" title="Changes in NDB table extra metadata">Changes in NDB table extra metadata</a>;
            see also <a class="xref" href="data-dictionary.html" title="Chapter&nbsp;14&nbsp;MySQL Data Dictionary">Chapter&nbsp;14, <em>MySQL Data Dictionary</em></a>.
          </p></li><li class="listitem"><p>
            In NDB 8.0, the binary configuration file format has been
            enhanced to provide support for greater numbers of nodes
            than in previous versions. The new format is not accessible
            to nodes running older versions of <code class="literal">NDB</code>,
            although newer management servers can detect older nodes and
            communicate with them using the appropriate format.
          </p><p>
            While upgrades to NDB 8.0 should not be problematic in this
            regard, older management servers cannot read the newer
            binary configuration file format, so that some manual
            intervention is required when downgrading from NDB 8.0 to a
            previous major version. When performing such a downgrade, it
            is necessary to remove any cached binary configuration files
            prior to starting the management using the older
            <code class="literal">NDB</code> software version, and to have the
            plaintext configuration file available for the management
            server to read. Alternatively, you can start the older
            management server using the
            <a class="link" href="mysql-cluster-programs-ndb-mgmd.html#option_ndb_mgmd_initial"><code class="option">--initial</code></a> option (again, it
            is necessary to have the <code class="filename">config.ini</code>
            available). If the cluster uses multiple management servers,
            one of these two things must be done for each management
            server binary.
          </p><p>
            Also in connection with support for increased numbers of
            nodes, and due to incompatible changes implemented in NDB
            8.0 in the data node LCP <code class="filename">Sysfile</code>, it is
            necessary, when performing an online downgrade from NDB 8.0
            to a prior major version, to restart all data nodes using
            the <a class="link" href="mysql-cluster-programs-ndbd.html#option_ndbd_initial"><code class="option">--initial</code></a> option.
          </p></li><li class="listitem"><p>
            Online downgrades of clusters running more than 48 data
            nodes, or with data nodes using node IDs greater than 48, to
            earlier NDB Cluster releases from NDB 8.0 are not supported.
            It is necessary in such cases to reduce the number of data
            nodes, to change the configurations for all data nodes such
            that they use node IDs less than or equal to 48, or both, as
            required not to exceed the old maximums.
          </p></li><li class="listitem"><p>
            If you are downgrading from NDB 8.0 to NDB 7.5 or NDB 7.4,
            you must set an explicit value for
            <a class="link" href="mysql-cluster-ndbd-definition.html#ndbparam-ndbd-indexmemory"><code class="literal">IndexMemory</code></a> in the
            cluster configuration file if none is already present. This
            is because NDB 8.0 does not use this parameter (which was
            removed in NDB 7.6) and sets it to 0 by default, whereas it
            is required in NDB 7.5 and NDB 7.4, in both of which the
            cluster refuses to start with <span class="errortext">Invalid
            configuration received from Management Server...</span>
            if <code class="literal">IndexMemory</code> is not set to a nonzero
            value.
          </p><p>
            Setting <code class="literal">IndexMemory</code> is
            <span class="emphasis"><em>not</em></span> required for downgrades from NDB
            8.0 to NDB 7.6.
          </p></li></ul></div></div></div><div class="navigation"><ul><li class="navLinkPrevious"><a title="Go To Previous Page" href="mysql-cluster-install-shutdown-restart.html">Previous <span class="navHint"> Safe Shutdown and Restart of NDB Cluster </span></a></li><li class="navLinkHome"><a title="Go To Home Page" href="performance-schema">Home <span class="navHint"> MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0 </span></a></li><li class="navLinkUp"><a title="Go Up A Level In The Navigation" href="mysql-cluster-installation.html">Up <span class="navHint"> NDB Cluster Installation </span></a></li><li class="navLinkNext"><a title="Go To Next Page" href="mysql-cluster-installer.html">Next <span class="navHint"> The NDB Cluster Auto-Installer (NO LONGER SUPPORTED) </span></a></li></ul></div><div class="dochomelink-footer"><a title="Go to MySQL Doc Library" href="https://docs.oracle.com/cd/E17952_01/index.html">
        MySQL Documentation Library
      </a></div><div class="copyright-footer"></div></body></html>