<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><a class="dashingAutolink" name="autolink-1780"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/6.4.4.15%C2%A0General-Purpose%20Keyring%20Key-Management%20Functions"></a><title>6.4.4.15&nbsp;General-Purpose Keyring Key-Management Functions</title><link rel="stylesheet" type="text/css" href="mvl-otn.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/><link rel="home" href="performance-schema" title="MySQL 8.0 Reference Manual"/><link rel="up" href="keyring.html" title="6.4.4&nbsp;The MySQL Keyring"/><link rel="prev" href="keyring-key-migration.html" title="6.4.4.14&nbsp;Migrating Keys Between Keyring Keystores"/><link rel="next" href="keyring-functions-plugin-specific.html" title="6.4.4.16&nbsp;Plugin-Specific Keyring Key-Management Functions"/><script>window.ohcglobal || document.write('<script src="../../../en/dcommon/js/global.js">\x3C/script>')</script></head><body><div class="skip-link"><a href="keyring-functions-general-purpose.html#keyring-functions-general-purpose">Skip to Main Content</a></div><div class="DocTitle"><p>MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0</p></div><div class="navigation"><ul><li class="navLinkPrevious"><a accesskey="p" title="Go To Previous Page&nbsp;[access key: p]" href="keyring-key-migration.html">Previous <span class="navHint"> Migrating Keys Between Keyring Keystores </span></a></li><li class="navLinkHome"><a accesskey="h" title="Go To Home Page&nbsp;[access key: h]" href="performance-schema">Home <span class="navHint"> MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0 </span></a></li><li class="navLinkUp"><a accesskey="u" title="Go Up A Level In The Navigation&nbsp;[access key: u]" href="keyring.html">Up <span class="navHint"> The MySQL Keyring </span></a></li><li class="navLinkNext"><a accesskey="n" title="Go To Next Page&nbsp;[access key: n]" href="keyring-functions-plugin-specific.html">Next <span class="navHint"> Plugin-Specific Keyring Key-Management Functions </span></a></li></ul></div><div class="section"><div class="titlepage"><div><div><a class="dashingAutolink" name="autolink-1781"></a><a class="dashAnchor" name="//apple_ref/cpp/Section/6.4.4.15%C2%A0General-Purpose%20Keyring%20Key-Management%20Functions"></a><h4 class="title"><a id="keyring-functions-general-purpose"></a>6.4.4.15&nbsp;General-Purpose Keyring Key-Management Functions</h4></div></div></div><a id="idm45828967221360" class="indexterm"></a><a id="idm45828967219872" class="indexterm"></a><a id="idm45828967218384" class="indexterm"></a><p>
        MySQL Server supports a keyring service that enables internal
        components and plugins to securely store sensitive information
        for later retrieval.
      </p><p>
        MySQL Server also includes an SQL interface for keyring key
        management, implemented as a set of general-purpose functions
        that access the capabilities provided by the internal keyring
        service. The keyring functions are contained in a plugin library
        file, which also contains a <code class="literal">keyring_udf</code>
        plugin that must be enabled prior to function invocation. For
        these functions to be used, a keyring plugin such as
        <code class="literal">keyring_file</code> or
        <code class="literal">keyring_okv</code> must be enabled.
      </p><p>
        The functions described here are general purpose and intended
        for use with any keyring plugin. A given keyring plugin might
        have functions of its own that are intended for use only with
        that plugin; see
        <a class="xref" href="keyring-functions-plugin-specific.html" title="6.4.4.16&nbsp;Plugin-Specific Keyring Key-Management Functions">Section&nbsp;6.4.4.16, &ldquo;Plugin-Specific Keyring Key-Management Functions&rdquo;</a>.
      </p><p>
        The following sections provide installation instructions for the
        keyring functions and demonstrate how to use them. For
        information about the keyring service functions invoked by these
        functions, see <a class="xref" href="keyring-service.html" title="5.6.9.2&nbsp;The Keyring Service">Section&nbsp;5.6.9.2, &ldquo;The Keyring Service&rdquo;</a>. For general
        keyring information, see <a class="xref" href="keyring.html" title="6.4.4&nbsp;The MySQL Keyring">Section&nbsp;6.4.4, &ldquo;The MySQL Keyring&rdquo;</a>.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="keyring-functions-general-purpose.html#keyring-function-installation" title="Installing or Uninstalling General-Purpose Keyring Functions">Installing or Uninstalling General-Purpose Keyring Functions</a></p></li><li class="listitem"><p><a class="xref" href="keyring-functions-general-purpose.html#keyring-function-usage" title="Using General-Purpose Keyring Functions">Using General-Purpose Keyring Functions</a></p></li><li class="listitem"><p><a class="xref" href="keyring-functions-general-purpose.html#keyring-function-reference" title="General-Purpose Keyring Function Reference">General-Purpose Keyring Function Reference</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="keyring-function-installation"></a>Installing or Uninstalling General-Purpose Keyring Functions</h5></div></div></div><a id="idm45828967205344" class="indexterm"></a><a id="idm45828967203856" class="indexterm"></a><a id="idm45828967202368" class="indexterm"></a><a id="idm45828967200880" class="indexterm"></a><a id="idm45828967199392" class="indexterm"></a><a id="idm45828967197904" class="indexterm"></a><p>
          This section describes how to install or uninstall the keyring
          functions, which are implemented in a plugin library file that
          also contains a <code class="literal">keyring_udf</code> plugin. For
          general information about installing or uninstalling plugins
          and loadable functions, see <a class="xref" href="plugin-loading.html" title="5.6.1&nbsp;Installing and Uninstalling Plugins">Section&nbsp;5.6.1, &ldquo;Installing and Uninstalling Plugins&rdquo;</a>,
          and <a class="xref" href="function-loading.html" title="5.7.1&nbsp;Installing and Uninstalling Loadable Functions">Section&nbsp;5.7.1, &ldquo;Installing and Uninstalling Loadable Functions&rdquo;</a>.
        </p><p>
          The keyring functions enable keyring key management
          operations, but the <code class="literal">keyring_udf</code> plugin must
          also be installed because the functions do not work correctly
          without it. Attempts to use the functions without the
          <code class="literal">keyring_udf</code> plugin result in an error.
        </p><p>
          To be usable by the server, the plugin library file must be
          located in the MySQL plugin directory (the directory named by
          the <a class="link" href="server-system-variables.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
          variable). If necessary, configure the plugin directory
          location by setting the value of
          <a class="link" href="server-system-variables.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
        </p><p>
          The plugin library file base name is
          <code class="literal">keyring_udf</code>. The file name suffix differs
          per platform (for example, <code class="filename">.so</code> for Unix
          and Unix-like systems, <code class="filename">.dll</code> for Windows).
        </p><p>
          To install the <code class="literal">keyring_udf</code> plugin and the
          keyring functions, use the <a class="link" href="install-plugin.html" title="13.7.4.4&nbsp;INSTALL PLUGIN Statement"><code class="literal">INSTALL
          PLUGIN</code></a> and <a class="link" href="create-function.html" title="13.1.14&nbsp;CREATE FUNCTION Statement"><code class="literal">CREATE
          FUNCTION</code></a> statements, adjusting the
          <code class="filename">.so</code> suffix for your platform as
          necessary:
        </p><pre class="programlisting">INSTALL PLUGIN keyring_udf SONAME &#39;keyring_udf.so&#39;;
CREATE FUNCTION keyring_key_generate RETURNS INTEGER
  SONAME &#39;keyring_udf.so&#39;;
CREATE FUNCTION keyring_key_fetch RETURNS STRING
  SONAME &#39;keyring_udf.so&#39;;
CREATE FUNCTION keyring_key_length_fetch RETURNS INTEGER
  SONAME &#39;keyring_udf.so&#39;;
CREATE FUNCTION keyring_key_type_fetch RETURNS STRING
  SONAME &#39;keyring_udf.so&#39;;
CREATE FUNCTION keyring_key_store RETURNS INTEGER
  SONAME &#39;keyring_udf.so&#39;;
CREATE FUNCTION keyring_key_remove RETURNS INTEGER
  SONAME &#39;keyring_udf.so&#39;;
</pre><p>
          If the plugin and functions are used on a source replication
          server, install them on all replicas as well to avoid
          replication issues.
        </p><p>
          Once installed as just described, the plugin and functions
          remain installed until uninstalled. To remove them, use the
          <a class="link" href="uninstall-plugin.html" title="13.7.4.6&nbsp;UNINSTALL PLUGIN Statement"><code class="literal">UNINSTALL PLUGIN</code></a> and
          <a class="link" href="drop-function.html" title="13.1.26&nbsp;DROP FUNCTION Statement"><code class="literal">DROP FUNCTION</code></a> statements:
        </p><pre class="programlisting">UNINSTALL PLUGIN keyring_udf;
DROP FUNCTION keyring_key_generate;
DROP FUNCTION keyring_key_fetch;
DROP FUNCTION keyring_key_length_fetch;
DROP FUNCTION keyring_key_type_fetch;
DROP FUNCTION keyring_key_store;
DROP FUNCTION keyring_key_remove;
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="keyring-function-usage"></a>Using General-Purpose Keyring Functions</h5></div></div></div><a id="idm45828967173904" class="indexterm"></a><p>
          Before using the keyring general-purpose functions, install
          them according to the instructions provided in
          <a class="xref" href="keyring-functions-general-purpose.html#keyring-function-installation" title="Installing or Uninstalling General-Purpose Keyring Functions">Installing or Uninstalling General-Purpose Keyring Functions</a>.
        </p><p>
          The keyring functions are subject to these constraints:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              To use any keyring function, the
              <code class="literal">keyring_udf</code> plugin must be enabled.
              Otherwise, an error occurs:
            </p><pre class="programlisting">ERROR 1123 (HY000): Can&#39;t initialize function &#39;keyring_key_generate&#39;;
This function requires keyring_udf plugin which is not installed.
Please install
</pre><p>
              To install the <code class="literal">keyring_udf</code> plugin, see
              <a class="xref" href="keyring-functions-general-purpose.html#keyring-function-installation" title="Installing or Uninstalling General-Purpose Keyring Functions">Installing or Uninstalling General-Purpose Keyring Functions</a>.
            </p></li><li class="listitem"><p>
              The keyring functions invoke keyring service functions
              (see <a class="xref" href="keyring-service.html" title="5.6.9.2&nbsp;The Keyring Service">Section&nbsp;5.6.9.2, &ldquo;The Keyring Service&rdquo;</a>). The service
              functions in turn use whatever keyring plugin is installed
              (for example, <code class="literal">keyring_file</code> or
              <code class="literal">keyring_okv</code>). Therefore, to use any
              keyring function, some underlying keyring plugin must be
              enabled. Otherwise, an error occurs:
            </p><pre class="programlisting">ERROR 3188 (HY000): Function &#39;keyring_key_generate&#39; failed because
underlying keyring service returned an error. Please check if a
keyring plugin is installed and that provided arguments are valid
for the keyring you are using.
</pre><p>
              To install a keyring plugin, see
              <a class="xref" href="keyring-plugin-installation.html" title="6.4.4.3&nbsp;Keyring Plugin Installation">Section&nbsp;6.4.4.3, &ldquo;Keyring Plugin Installation&rdquo;</a>.
            </p></li><li class="listitem"><p>
              A user must possess the global
              <a class="link" href="privileges-provided.html#priv_execute"><code class="literal">EXECUTE</code></a> privilege to use
              any keyring function. Otherwise, an error occurs:
            </p><pre class="programlisting">ERROR 1123 (HY000): Can&#39;t initialize function &#39;keyring_key_generate&#39;;
The user is not privileged to execute this function. User needs to
have EXECUTE
</pre><p>
              To grant the global <a class="link" href="privileges-provided.html#priv_execute"><code class="literal">EXECUTE</code></a>
              privilege to a user, use this statement:
            </p><pre class="programlisting">GRANT EXECUTE ON *.* TO <em class="replaceable"><code>user</code></em>;
</pre><p>
              Alternatively, should you prefer to avoid granting the
              global <a class="link" href="privileges-provided.html#priv_execute"><code class="literal">EXECUTE</code></a> privilege
              while still permitting users to access specific
              key-management operations, <span class="quote">&ldquo;<span class="quote">wrapper</span>&rdquo;</span> stored
              programs can be defined (a technique described later in
              this section).
            </p></li><li class="listitem"><p>
              A key stored in the keyring by a given user can be
              manipulated later only by the same user. That is, the
              value of the <a class="link" href="information-functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a>
              function at the time of key manipulation must have the
              same value as when the key was stored in the keyring.
              (This constraint rules out the use of the keyring
              functions for manipulation of instance-wide keys, such as
              those created by <code class="literal">InnoDB</code> to support
              tablespace encryption.)
            </p><p>
              To enable multiple users to perform operations on the same
              key, <span class="quote">&ldquo;<span class="quote">wrapper</span>&rdquo;</span> stored programs can be defined
              (a technique described later in this section).
            </p></li><li class="listitem"><p>
              Keyring functions support the key types and lengths
              supported by the underlying keyring plugin. For
              information about keys specific to a particular keyring
              plugin, see <a class="xref" href="keyring-key-types.html" title="6.4.4.13&nbsp;Supported Keyring Key Types and Lengths">Section&nbsp;6.4.4.13, &ldquo;Supported Keyring Key Types and Lengths&rdquo;</a>.
            </p></li></ul></div><p>
          To create a new random key and store it in the keyring, call
          <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-generate"><code class="literal">keyring_key_generate()</code></a>, passing
          to it an ID for the key, along with the key type (encryption
          method) and its length in bytes. The following call creates a
          2,048-bit DSA-encrypted key named <code class="literal">MyKey</code>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate(&#39;MyKey&#39;, &#39;DSA&#39;, 256);</code></strong>
+-------------------------------------------+
| keyring_key_generate(&#39;MyKey&#39;, &#39;DSA&#39;, 256) |
+-------------------------------------------+
|                                         1 |
+-------------------------------------------+
</pre><p>
          A return value of 1 indicates success. If the key cannot be
          created, the return value is <code class="literal">NULL</code> and an
          error occurs. One reason this might be is that the underlying
          keyring plugin does not support the specified combination of
          key type and key length; see
          <a class="xref" href="keyring-key-types.html" title="6.4.4.13&nbsp;Supported Keyring Key Types and Lengths">Section&nbsp;6.4.4.13, &ldquo;Supported Keyring Key Types and Lengths&rdquo;</a>.
        </p><p>
          To be able to check the return type regardless of whether an
          error occurs, use <code class="literal">SELECT ... INTO
          @<em class="replaceable"><code>var_name</code></em></code> and test the
          variable value:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate(&#39;&#39;, &#39;&#39;, -1) INTO @x;</code></strong>
ERROR 3188 (HY000): Function &#39;keyring_key_generate&#39; failed because
underlying keyring service returned an error. Please check if a
keyring plugin is installed and that provided arguments are valid
for the keyring you are using.
mysql&gt; <strong class="userinput"><code>SELECT @x;</code></strong>
+------+
| @x   |
+------+
| NULL |
+------+
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate(&#39;x&#39;, &#39;AES&#39;, 16) INTO @x;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT @x;</code></strong>
+------+
| @x   |
+------+
|    1 |
+------+
</pre><p>
          This technique also applies to other keyring functions that
          for failure return a value and an error.
        </p><p>
          The ID passed to
          <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-generate"><code class="literal">keyring_key_generate()</code></a> provides
          a means by which to refer to the key in subsequent functions
          calls. For example, use the key ID to retrieve its type as a
          string or its length in bytes as an integer:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_type_fetch(&#39;MyKey&#39;);</code></strong>
+---------------------------------+
| keyring_key_type_fetch(&#39;MyKey&#39;) |
+---------------------------------+
| DSA                             |
+---------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_length_fetch(&#39;MyKey&#39;);</code></strong>
+-----------------------------------+
| keyring_key_length_fetch(&#39;MyKey&#39;) |
+-----------------------------------+
|                               256 |
+-----------------------------------+
</pre><p>
          To retrieve a key value, pass the key ID to
          <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-fetch"><code class="literal">keyring_key_fetch()</code></a>. The
          following example uses <a class="link" href="string-functions.html#function_hex"><code class="literal">HEX()</code></a> to
          display the key value because it may contain nonprintable
          characters. The example also uses a short key for brevity, but
          be aware that longer keys provide better security:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate(&#39;MyShortKey&#39;, &#39;DSA&#39;, 8);</code></strong>
+----------------------------------------------+
| keyring_key_generate(&#39;MyShortKey&#39;, &#39;DSA&#39;, 8) |
+----------------------------------------------+
|                                            1 |
+----------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT HEX(keyring_key_fetch(&#39;MyShortKey&#39;));</code></strong>
+--------------------------------------+
| HEX(keyring_key_fetch(&#39;MyShortKey&#39;)) |
+--------------------------------------+
| 1DB3B0FC3328A24C                     |
+--------------------------------------+
</pre><p>
          Keyring functions treat key IDs, types, and values as binary
          strings, so comparisons are case-sensitive. For example, IDs
          of <code class="literal">MyKey</code> and <code class="literal">mykey</code> refer
          to different keys.
        </p><p>
          To remove a key, pass the key ID to
          <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-remove"><code class="literal">keyring_key_remove()</code></a>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_remove(&#39;MyKey&#39;);</code></strong>
+-----------------------------+
| keyring_key_remove(&#39;MyKey&#39;) |
+-----------------------------+
|                           1 |
+-----------------------------+
</pre><p>
          To obfuscate and store a key that you provide, pass the key
          ID, type, and value to
          <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-store"><code class="literal">keyring_key_store()</code></a>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_store(&#39;AES_key&#39;, &#39;AES&#39;, &#39;Secret string&#39;);</code></strong>
+------------------------------------------------------+
| keyring_key_store(&#39;AES_key&#39;, &#39;AES&#39;, &#39;Secret string&#39;) |
+------------------------------------------------------+
|                                                    1 |
+------------------------------------------------------+
</pre><p>
          As indicated previously, a user must have the global
          <a class="link" href="privileges-provided.html#priv_execute"><code class="literal">EXECUTE</code></a> privilege to call
          keyring functions, and the user who stores a key in the
          keyring initially must be the same user who performs
          subsequent operations on the key later, as determined from the
          <a class="link" href="information-functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> value in effect
          for each function call. To permit key operations to users who
          do not have the global <a class="link" href="privileges-provided.html#priv_execute"><code class="literal">EXECUTE</code></a>
          privilege or who may not be the key <span class="quote">&ldquo;<span class="quote">owner,</span>&rdquo;</span> use
          this technique:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              Define <span class="quote">&ldquo;<span class="quote">wrapper</span>&rdquo;</span> stored programs that
              encapsulate the required key operations and have a
              <code class="literal">DEFINER</code> value equal to the key owner.
            </p></li><li class="listitem"><p>
              Grant the <a class="link" href="privileges-provided.html#priv_execute"><code class="literal">EXECUTE</code></a> privilege
              for specific stored programs to the individual users who
              should be able to invoke them.
            </p></li><li class="listitem"><p>
              If the operations implemented by the wrapper stored
              programs do not include key creation, create any necessary
              keys in advance, using the account named as the
              <code class="literal">DEFINER</code> in the stored program
              definitions.
            </p></li></ol></div><p>
          This technique enables keys to be shared among users and
          provides to DBAs more fine-grained control over who can do
          what with keys, without having to grant global privileges.
        </p><p>
          The following example shows how to set up a shared key named
          <code class="literal">SharedKey</code> that is owned by the DBA, and a
          <code class="literal">get_shared_key()</code> stored function that
          provides access to the current key value. The value can be
          retrieved by any user with the
          <a class="link" href="privileges-provided.html#priv_execute"><code class="literal">EXECUTE</code></a> privilege for that
          function, which is created in the
          <code class="literal">key_schema</code> schema.
        </p><p>
          From a MySQL administrative account
          (<code class="literal">&#39;root&#39;@&#39;localhost&#39;</code> in this example),
          create the administrative schema and the stored function to
          access the key:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE SCHEMA key_schema;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE DEFINER = &#39;root&#39;@&#39;localhost&#39;</code></strong>
       <strong class="userinput"><code>FUNCTION key_schema.get_shared_key()</code></strong>
       <strong class="userinput"><code>RETURNS BLOB READS SQL DATA</code></strong>
       <strong class="userinput"><code>RETURN keyring_key_fetch(&#39;SharedKey&#39;);</code></strong>
</pre><p>
          From the administrative account, ensure that the shared key
          exists:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate(&#39;SharedKey&#39;, &#39;DSA&#39;, 8);</code></strong>
+---------------------------------------------+
| keyring_key_generate(&#39;SharedKey&#39;, &#39;DSA&#39;, 8) |
+---------------------------------------------+
|                                           1 |
+---------------------------------------------+
</pre><p>
          From the administrative account, create an ordinary user
          account to which key access is to be granted:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE USER &#39;key_user&#39;@&#39;localhost&#39;</code></strong>
       <strong class="userinput"><code>IDENTIFIED BY &#39;key_user_pwd&#39;;</code></strong>
</pre><p>
          From the <code class="literal">key_user</code> account, verify that,
          without the proper <a class="link" href="privileges-provided.html#priv_execute"><code class="literal">EXECUTE</code></a>
          privilege, the new account cannot access the shared key:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT HEX(key_schema.get_shared_key());</code></strong>
ERROR 1370 (42000): execute command denied to user &#39;key_user&#39;@&#39;localhost&#39;
for routine &#39;key_schema.get_shared_key&#39;
</pre><p>
          From the administrative account, grant
          <a class="link" href="privileges-provided.html#priv_execute"><code class="literal">EXECUTE</code></a> to
          <code class="literal">key_user</code> for the stored function:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>GRANT EXECUTE ON FUNCTION key_schema.get_shared_key</code></strong>
       <strong class="userinput"><code>TO &#39;key_user&#39;@&#39;localhost&#39;;</code></strong>
</pre><p>
          From the <code class="literal">key_user</code> account, verify that the
          key is now accessible:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT HEX(key_schema.get_shared_key());</code></strong>
+----------------------------------+
| HEX(key_schema.get_shared_key()) |
+----------------------------------+
| 9BAFB9E75CEEB013                 |
+----------------------------------+
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="keyring-function-reference"></a>General-Purpose Keyring Function Reference</h5></div></div></div><p>
          For each general-purpose keyring function, this section
          describes its purpose, calling sequence, and return value. For
          information about the conditions under which these functions
          can be invoked, see <a class="xref" href="keyring-functions-general-purpose.html#keyring-function-usage" title="Using General-Purpose Keyring Functions">Using General-Purpose Keyring Functions</a>.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a id="function_keyring-key-fetch"></a>
              <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-fetch"><code class="literal">keyring_key_fetch(<em class="replaceable"><code>key_id</code></em>)</code></a>
            </p><a id="idm45828967065776" class="indexterm"></a><a id="idm45828967064736" class="indexterm"></a><p>
              Given a key ID, deobfuscates and returns the key value.
            </p><p>
              Arguments:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: A string that
                  specifies the key ID.
                </p></li></ul></div><p>
              Return value:
            </p><p>
              Returns the key value as a string for success,
              <code class="literal">NULL</code> if the key does not exist, or
              <code class="literal">NULL</code> and an error for failure.
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p>
                Key values retrieved using
                <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-fetch"><code class="literal">keyring_key_fetch()</code></a> are
                subject to the general keyring function limits described
                in <a class="xref" href="keyring-key-types.html" title="6.4.4.13&nbsp;Supported Keyring Key Types and Lengths">Section&nbsp;6.4.4.13, &ldquo;Supported Keyring Key Types and Lengths&rdquo;</a>. A key value
                longer than that length can be stored using a keyring
                service function (see
                <a class="xref" href="keyring-service.html" title="5.6.9.2&nbsp;The Keyring Service">Section&nbsp;5.6.9.2, &ldquo;The Keyring Service&rdquo;</a>), but if retrieved
                using <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-fetch"><code class="literal">keyring_key_fetch()</code></a>
                is truncated to the general keyring function limit.
              </p></div><p>
              Example:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate(&#39;RSA_key&#39;, &#39;RSA&#39;, 16);</code></strong>
+--------------------------------------------+
| keyring_key_generate(&#39;RSA_key&#39;, &#39;RSA&#39;, 16) |
+--------------------------------------------+
|                                          1 |
+--------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT HEX(keyring_key_fetch(&#39;RSA_key&#39;));</code></strong>
+-----------------------------------+
| HEX(keyring_key_fetch(&#39;RSA_key&#39;)) |
+-----------------------------------+
| 91C2253B696064D3556984B6630F891A  |
+-----------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_type_fetch(&#39;RSA_key&#39;);</code></strong>
+-----------------------------------+
| keyring_key_type_fetch(&#39;RSA_key&#39;) |
+-----------------------------------+
| RSA                               |
+-----------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_length_fetch(&#39;RSA_key&#39;);</code></strong>
+-------------------------------------+
| keyring_key_length_fetch(&#39;RSA_key&#39;) |
+-------------------------------------+
|                                  16 |
+-------------------------------------+
</pre><p>
              The example uses <a class="link" href="string-functions.html#function_hex"><code class="literal">HEX()</code></a> to
              display the key value because it may contain nonprintable
              characters. The example also uses a short key for brevity,
              but be aware that longer keys provide better security.
            </p></li><li class="listitem"><p><a id="function_keyring-key-generate"></a>
              <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-generate"><code class="literal">keyring_key_generate(<em class="replaceable"><code>key_id</code></em>,
              <em class="replaceable"><code>key_type</code></em>,
              <em class="replaceable"><code>key_length</code></em>)</code></a>
            </p><a id="idm45828967041744" class="indexterm"></a><a id="idm45828967040704" class="indexterm"></a><p>
              Generates a new random key with a given ID, type, and
              length, and stores it in the keyring. The type and length
              values must be consistent with the values supported by the
              underlying keyring plugin. See
              <a class="xref" href="keyring-key-types.html" title="6.4.4.13&nbsp;Supported Keyring Key Types and Lengths">Section&nbsp;6.4.4.13, &ldquo;Supported Keyring Key Types and Lengths&rdquo;</a>.
            </p><p>
              Arguments:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: A string that
                  specifies the key ID.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>key_type</code></em>: A string that
                  specifies the key type.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>key_length</code></em>: An integer that
                  specifies the key length in bytes.
                </p></li></ul></div><p>
              Return value:
            </p><p>
              Returns 1 for success, or <code class="literal">NULL</code> and an
              error for failure.
            </p><p>
              Example:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate(&#39;RSA_key&#39;, &#39;RSA&#39;, 384);</code></strong>
+---------------------------------------------+
| keyring_key_generate(&#39;RSA_key&#39;, &#39;RSA&#39;, 384) |
+---------------------------------------------+
|                                           1 |
+---------------------------------------------+
</pre></li><li class="listitem"><p><a id="function_keyring-key-length-fetch"></a>
              <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-length-fetch"><code class="literal">keyring_key_length_fetch(<em class="replaceable"><code>key_id</code></em>)</code></a>
            </p><a id="idm45828967026208" class="indexterm"></a><a id="idm45828967025104" class="indexterm"></a><p>
              Given a key ID, returns the key length.
            </p><p>
              Arguments:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: A string that
                  specifies the key ID.
                </p></li></ul></div><p>
              Return value:
            </p><p>
              Returns the key length in bytes as an integer for success,
              <code class="literal">NULL</code> if the key does not exist, or
              <code class="literal">NULL</code> and an error for failure.
            </p><p>
              Example:
            </p><p>
              See the description of
              <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-fetch"><code class="literal">keyring_key_fetch()</code></a>.
            </p></li><li class="listitem"><p><a id="function_keyring-key-remove"></a>
              <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-remove"><code class="literal">keyring_key_remove(<em class="replaceable"><code>key_id</code></em>)</code></a>
            </p><a id="idm45828967013536" class="indexterm"></a><a id="idm45828967012496" class="indexterm"></a><p>
              Removes the key with a given ID from the keyring.
            </p><p>
              Arguments:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: A string that
                  specifies the key ID.
                </p></li></ul></div><p>
              Return value:
            </p><p>
              Returns 1 for success, or <code class="literal">NULL</code> for
              failure.
            </p><p>
              Example:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_remove(&#39;AES_key&#39;);</code></strong>
+-------------------------------+
| keyring_key_remove(&#39;AES_key&#39;) |
+-------------------------------+
|                             1 |
+-------------------------------+
</pre></li><li class="listitem"><p><a id="function_keyring-key-store"></a>
              <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-store"><code class="literal">keyring_key_store(<em class="replaceable"><code>key_id</code></em>,
              <em class="replaceable"><code>key_type</code></em>,
              <em class="replaceable"><code>key</code></em>)</code></a>
            </p><a id="idm45828967000736" class="indexterm"></a><a id="idm45828966999696" class="indexterm"></a><p>
              Obfuscates and stores a key in the keyring.
            </p><p>
              Arguments:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: A string that
                  specifies the key ID.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>key_type</code></em>: A string that
                  specifies the key type.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>key</code></em>: A string that
                  specifies the key value.
                </p></li></ul></div><p>
              Return value:
            </p><p>
              Returns 1 for success, or <code class="literal">NULL</code> and an
              error for failure.
            </p><p>
              Example:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_store(&#39;new key&#39;, &#39;DSA&#39;, &#39;My key value&#39;);</code></strong>
+-----------------------------------------------------+
| keyring_key_store(&#39;new key&#39;, &#39;DSA&#39;, &#39;My key value&#39;) |
+-----------------------------------------------------+
|                                                   1 |
+-----------------------------------------------------+
</pre></li><li class="listitem"><p><a id="function_keyring-key-type-fetch"></a>
              <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-type-fetch"><code class="literal">keyring_key_type_fetch(<em class="replaceable"><code>key_id</code></em>)</code></a>
            </p><a id="idm45828966986032" class="indexterm"></a><a id="idm45828966984928" class="indexterm"></a><p>
              Given a key ID, returns the key type.
            </p><p>
              Arguments:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: A string that
                  specifies the key ID.
                </p></li></ul></div><p>
              Return value:
            </p><p>
              Returns the key type as a string for success,
              <code class="literal">NULL</code> if the key does not exist, or
              <code class="literal">NULL</code> and an error for failure.
            </p><p>
              Example:
            </p><p>
              See the description of
              <a class="link" href="keyring-functions-general-purpose.html#function_keyring-key-fetch"><code class="literal">keyring_key_fetch()</code></a>.
            </p></li></ul></div></div></div><div class="navigation"><ul><li class="navLinkPrevious"><a title="Go To Previous Page" href="keyring-key-migration.html">Previous <span class="navHint"> Migrating Keys Between Keyring Keystores </span></a></li><li class="navLinkHome"><a title="Go To Home Page" href="performance-schema">Home <span class="navHint"> MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0 </span></a></li><li class="navLinkUp"><a title="Go Up A Level In The Navigation" href="keyring.html">Up <span class="navHint"> The MySQL Keyring </span></a></li><li class="navLinkNext"><a title="Go To Next Page" href="keyring-functions-plugin-specific.html">Next <span class="navHint"> Plugin-Specific Keyring Key-Management Functions </span></a></li></ul></div><div class="dochomelink-footer"><a title="Go to MySQL Doc Library" href="https://docs.oracle.com/cd/E17952_01/index.html">
        MySQL Documentation Library
      </a></div><div class="copyright-footer"></div></body></html>