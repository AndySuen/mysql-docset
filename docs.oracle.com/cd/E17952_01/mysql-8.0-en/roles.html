<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>6.2.10 Using Roles</title><link rel="stylesheet" type="text/css" href="mvl-otn.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="performance-schema" title="MySQL 8.0 Reference Manual" /><link rel="up" href="access-control.html" title="6.2 Access Control and Account Management" /><link rel="prev" href="reserved-accounts.html" title="6.2.9 Reserved Accounts" /><link rel="next" href="account-categories.html" title="6.2.11 Account Categories" /><script>window.ohcglobal || document.write('<script src="../../../en/dcommon/js/global.js">\x3C/script>')</script></head><body><div class="skip-link"><a href="roles.html#roles">Skip to Main Content</a></div><div class="DocTitle"><p>MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0</p></div><div class="navigation"><ul><li class="navLinkPrevious"><a accesskey="p" title="Go To Previous Page [access key: p]" href="reserved-accounts.html">Previous <span class="navHint"> Reserved Accounts </span></a></li><li class="navLinkHome"><a accesskey="h" title="Go To Home Page [access key: h]" href="performance-schema">Home <span class="navHint"> MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0 </span></a></li><li class="navLinkUp"><a accesskey="u" title="Go Up A Level In The Navigation [access key: u]" href="access-control.html">Up <span class="navHint"> Access Control and Account Management </span></a></li><li class="navLinkNext"><a accesskey="n" title="Go To Next Page [access key: n]" href="account-categories.html">Next <span class="navHint"> Account Categories </span></a></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="roles"></a>6.2.10 Using Roles</h3></div></div></div><a id="idm45828977117120" class="indexterm"></a><p>
      A MySQL role is a named collection of privileges. Like user
      accounts, roles can have privileges granted to and revoked from
      them.
    </p><p>
      A user account can be granted roles, which grants to the account
      the privileges associated with each role. This enables assignment
      of sets of privileges to accounts and provides a convenient
      alternative to granting individual privileges, both for
      conceptualizing desired privilege assignments and implementing
      them.
    </p><p>
      The following list summarizes role-management capabilities
      provided by MySQL:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="create-role.html" title="13.7.1.2 CREATE ROLE Statement"><code class="literal">CREATE ROLE</code></a> and
          <a class="link" href="drop-role.html" title="13.7.1.4 DROP ROLE Statement"><code class="literal">DROP ROLE</code></a> create and remove
          roles.
        </p></li><li class="listitem"><p>
          <a class="link" href="grant.html" title="13.7.1.6 GRANT Statement"><code class="literal">GRANT</code></a> and
          <a class="link" href="revoke.html" title="13.7.1.8 REVOKE Statement"><code class="literal">REVOKE</code></a> assign privileges to
          revoke privileges from user accounts and roles.
        </p></li><li class="listitem"><p>
          <a class="link" href="show-grants.html" title="13.7.7.21 SHOW GRANTS Statement"><code class="literal">SHOW GRANTS</code></a> displays privilege
          and role assignments for user accounts and roles.
        </p></li><li class="listitem"><p>
          <a class="link" href="set-default-role.html" title="13.7.1.9 SET DEFAULT ROLE Statement"><code class="literal">SET DEFAULT ROLE</code></a> specifies
          which account roles are active by default.
        </p></li><li class="listitem"><p>
          <a class="link" href="set-role.html" title="13.7.1.11 SET ROLE Statement"><code class="literal">SET ROLE</code></a> changes the active
          roles within the current session.
        </p></li><li class="listitem"><p>
          The <a class="link" href="information-functions.html#function_current-role"><code class="literal">CURRENT_ROLE()</code></a> function
          displays the active roles within the current session.
        </p></li><li class="listitem"><p>
          The <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> and
          <a class="link" href="server-system-variables.html#sysvar_activate_all_roles_on_login"><code class="literal">activate_all_roles_on_login</code></a>
          system variables enable defining mandatory roles and automatic
          activation of granted roles when users log in to the server.
        </p></li></ul></div><p>
      For descriptions of individual role-manipulation statements
      (including the privileges required to use them), see
      <a class="xref" href="account-management-statements.html" title="13.7.1 Account Management Statements">Section 13.7.1, “Account Management Statements”</a>. The following
      discussion provides examples of role usage. Unless otherwise
      specified, SQL statements shown here should be executed using a
      MySQL account with sufficient administrative privileges, such as
      the <code class="literal">root</code> account.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="roles.html#roles-creating-granting" title="Creating Roles and Granting Privileges to Them">Creating Roles and Granting Privileges to Them</a></p></li><li class="listitem"><p><a class="xref" href="roles.html#mandatory-roles" title="Defining Mandatory Roles">Defining Mandatory Roles</a></p></li><li class="listitem"><p><a class="xref" href="roles.html#roles-checking" title="Checking Role Privileges">Checking Role Privileges</a></p></li><li class="listitem"><p><a class="xref" href="roles.html#roles-activating" title="Activating Roles">Activating Roles</a></p></li><li class="listitem"><p><a class="xref" href="roles.html#roles-revoking" title="Revoking Roles or Role Privileges">Revoking Roles or Role Privileges</a></p></li><li class="listitem"><p><a class="xref" href="roles.html#roles-dropping" title="Dropping Roles">Dropping Roles</a></p></li><li class="listitem"><p><a class="xref" href="roles.html#role-user-interchangeability" title="User and Role Interchangeability">User and Role Interchangeability</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a id="roles-creating-granting"></a>Creating Roles and Granting Privileges to Them</h4></div></div></div><p>
        Consider this scenario:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            An application uses a database named
            <code class="literal">app_db</code>.
          </p></li><li class="listitem"><p>
            Associated with the application, there can be accounts for
            developers who create and maintain the application, and for
            users who interact with it.
          </p></li><li class="listitem"><p>
            Developers need full access to the database. Some users need
            only read access, others need read/write access.
          </p></li></ul></div><p>
        To avoid granting privileges individually to possibly many user
        accounts, create roles as names for the required privilege sets.
        This makes it easy to grant the required privileges to user
        accounts, by granting the appropriate roles.
      </p><p>
        To create the roles, use the <a class="link" href="create-role.html" title="13.7.1.2 CREATE ROLE Statement"><code class="literal">CREATE
        ROLE</code></a> statement:
      </p><pre class="programlisting">CREATE ROLE 'app_developer', 'app_read', 'app_write';
</pre><p>
        Role names are much like user account names and consist of a
        user part and host part in
        <code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>
        format. The host part, if omitted, defaults to
        <code class="literal">'%'</code>. The user and host parts can be unquoted
        unless they contain special characters such as
        <code class="literal">-</code> or <code class="literal">%</code>. Unlike account
        names, the user part of role names cannot be blank. For
        additional information, see <a class="xref" href="role-names.html" title="6.2.5 Specifying Role Names">Section 6.2.5, “Specifying Role Names”</a>.
      </p><p>
        To assign privileges to the roles, execute
        <a class="link" href="grant.html" title="13.7.1.6 GRANT Statement"><code class="literal">GRANT</code></a> statements using the same
        syntax as for assigning privileges to user accounts:
      </p><pre class="programlisting">GRANT ALL ON app_db.* TO 'app_developer';
GRANT SELECT ON app_db.* TO 'app_read';
GRANT INSERT, UPDATE, DELETE ON app_db.* TO 'app_write';
</pre><p>
        Now suppose that initially you require one developer account,
        two user accounts that need read-only access, and one user
        account that needs read/write access. Use
        <a class="link" href="create-user.html" title="13.7.1.3 CREATE USER Statement"><code class="literal">CREATE USER</code></a> to create the
        accounts:
      </p><pre class="programlisting">CREATE USER 'dev1'@'localhost' IDENTIFIED BY 'dev1pass';
CREATE USER 'read_user1'@'localhost' IDENTIFIED BY 'read_user1pass';
CREATE USER 'read_user2'@'localhost' IDENTIFIED BY 'read_user2pass';
CREATE USER 'rw_user1'@'localhost' IDENTIFIED BY 'rw_user1pass';
</pre><p>
        To assign each user account its required privileges, you could
        use <a class="link" href="grant.html" title="13.7.1.6 GRANT Statement"><code class="literal">GRANT</code></a> statements of the same
        form as just shown, but that requires enumerating individual
        privileges for each user. Instead, use an alternative
        <a class="link" href="grant.html" title="13.7.1.6 GRANT Statement"><code class="literal">GRANT</code></a> syntax that permits
        granting roles rather than privileges:
      </p><pre class="programlisting">GRANT 'app_developer' TO 'dev1'@'localhost';
GRANT 'app_read' TO 'read_user1'@'localhost', 'read_user2'@'localhost';
GRANT 'app_read', 'app_write' TO 'rw_user1'@'localhost';
</pre><p>
        The <a class="link" href="grant.html" title="13.7.1.6 GRANT Statement"><code class="literal">GRANT</code></a> statement for the
        <code class="literal">rw_user1</code> account grants the read and write
        roles, which combine to provide the required read and write
        privileges.
      </p><p>
        The <a class="link" href="grant.html" title="13.7.1.6 GRANT Statement"><code class="literal">GRANT</code></a> syntax for granting
        roles to an account differs from the syntax for granting
        privileges: There is an <code class="literal">ON</code> clause to assign
        privileges, whereas there is no <code class="literal">ON</code> clause to
        assign roles. Because the syntaxes are distinct, you cannot mix
        assigning privileges and roles in the same statement. (It is
        permitted to assign both privileges and roles to an account, but
        you must use separate <a class="link" href="grant.html" title="13.7.1.6 GRANT Statement"><code class="literal">GRANT</code></a>
        statements, each with syntax appropriate to what is to be
        granted.) As of MySQL 8.0.16, roles cannot be granted to
        anonymous users.
      </p><p>
        A role when created is locked, has no password, and is assigned
        the default authentication plugin. (These role attributes can be
        changed later with the <a class="link" href="alter-user.html" title="13.7.1.1 ALTER USER Statement"><code class="literal">ALTER USER</code></a>
        statement, by users who have the global
        <a class="link" href="privileges-provided.html#priv_create-user"><code class="literal">CREATE USER</code></a> privilege.)
      </p><p>
        While locked, a role cannot be used to authenticate to the
        server. If unlocked, a role can be used to authenticate. This is
        because roles and users are both authorization identifiers with
        much in common and little to distinguish them. See also
        <a class="xref" href="roles.html#role-user-interchangeability" title="User and Role Interchangeability">User and Role Interchangeability</a>.
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a id="mandatory-roles"></a>Defining Mandatory Roles</h4></div></div></div><p>
        It is possible to specify roles as mandatory by naming them in
        the value of the
        <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> system
        variable. The server treats a mandatory role as granted to all
        users, so that it need not be granted explicitly to any account.
      </p><p>
        To specify mandatory roles at server startup, define
        <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> in your server
        <code class="filename">my.cnf</code> file:
      </p><pre class="programlisting">[mysqld]
mandatory_roles='role1,role2@localhost,r3@%.example.com'
</pre><p>
        To set and persist
        <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> at runtime, use
        a statement like this:
      </p><pre class="programlisting">SET PERSIST mandatory_roles = 'role1,role2@localhost,r3@%.example.com';
</pre><p>
        <a class="link" href="set-variable.html" title="13.7.6.1 SET Syntax for Variable Assignment"><code class="literal">SET
        PERSIST</code></a> sets a value for the running MySQL instance.
        It also saves the value, causing it to carry over to subsequent
        server restarts. To change the value for the running MySQL
        instance without having it carry over to subsequent restarts,
        use the <code class="literal">GLOBAL</code> keyword rather than
        <code class="literal">PERSIST</code>. See <a class="xref" href="set-variable.html" title="13.7.6.1 SET Syntax for Variable Assignment">Section 13.7.6.1, “SET Syntax for Variable Assignment”</a>.
      </p><p>
        Setting <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a>
        requires the <a class="link" href="privileges-provided.html#priv_role-admin"><code class="literal">ROLE_ADMIN</code></a>
        privilege, in addition to the
        <a class="link" href="privileges-provided.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a> privilege
        (or the deprecated <a class="link" href="privileges-provided.html#priv_super"><code class="literal">SUPER</code></a>
        privilege) normally required to set a global system variable.
      </p><p>
        Mandatory roles, like explicitly granted roles, do not take
        effect until activated (see <a class="xref" href="roles.html#roles-activating" title="Activating Roles">Activating Roles</a>).
        At login time, role activation occurs for all granted roles if
        the <a class="link" href="server-system-variables.html#sysvar_activate_all_roles_on_login"><code class="literal">activate_all_roles_on_login</code></a>
        system variable is enabled, or for roles that are set as default
        roles otherwise. At runtime, <a class="link" href="set-role.html" title="13.7.1.11 SET ROLE Statement"><code class="literal">SET
        ROLE</code></a> activates roles.
      </p><p>
        Roles named in the value of
        <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> cannot be
        revoked with <a class="link" href="revoke.html" title="13.7.1.8 REVOKE Statement"><code class="literal">REVOKE</code></a> or dropped
        with <a class="link" href="drop-role.html" title="13.7.1.4 DROP ROLE Statement"><code class="literal">DROP ROLE</code></a> or
        <a class="link" href="drop-user.html" title="13.7.1.5 DROP USER Statement"><code class="literal">DROP USER</code></a>.
      </p><p>
        To prevent sessions from being made system sessions by default,
        a role that has the <a class="link" href="privileges-provided.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a>
        privilege cannot be listed in the value of the
        <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> system
        variable:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> is
            assigned a role at startup that has the
            <a class="link" href="privileges-provided.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege, the
            server writes a message to the error log and exits.
          </p></li><li class="listitem"><p>
            If <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> is
            assigned a role at runtime that has the
            <a class="link" href="privileges-provided.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege, an
            error occurs and the
            <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> value
            remains unchanged.
          </p></li></ul></div><p>
        Even with this safeguard, it is better to avoid granting the
        <a class="link" href="privileges-provided.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege through a
        role in order to guard against the possibility of privilege
        escalation.
      </p><p>
        If a role named in
        <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> is not present
        in the <code class="literal">mysql.user</code> system table, the role is
        not granted to users. When the server attempts role activation
        for a user, it does not treat the nonexistent role as mandatory
        and writes a warning to the error log. If the role is created
        later and thus becomes valid, <a class="link" href="flush.html#flush-privileges"><code class="literal">FLUSH
        PRIVILEGES</code></a> may be necessary to cause the server to
        treat it as mandatory.
      </p><p>
        <a class="link" href="show-grants.html" title="13.7.7.21 SHOW GRANTS Statement"><code class="literal">SHOW GRANTS</code></a> displays mandatory
        roles according to the rules described in
        <a class="xref" href="show-grants.html" title="13.7.7.21 SHOW GRANTS Statement">Section 13.7.7.21, “SHOW GRANTS Statement”</a>.
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a id="roles-checking"></a>Checking Role Privileges</h4></div></div></div><p>
        To verify the privileges assigned to an account, use
        <a class="link" href="show-grants.html" title="13.7.7.21 SHOW GRANTS Statement"><code class="literal">SHOW GRANTS</code></a>. For example:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'dev1'@'localhost';</code></strong>
+-------------------------------------------------+
| Grants for dev1@localhost                       |
+-------------------------------------------------+
| GRANT USAGE ON *.* TO `dev1`@`localhost`        |
| GRANT `app_developer`@`%` TO `dev1`@`localhost` |
+-------------------------------------------------+
</pre><p>
        However, that shows each granted role without
        <span class="quote">“<span class="quote">expanding</span>”</span> it to the privileges the role
        represents. To show role privileges as well, add a
        <code class="literal">USING</code> clause naming the granted roles for
        which to display privileges:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'dev1'@'localhost' USING 'app_developer';</code></strong>
+----------------------------------------------------------+
| Grants for dev1@localhost                                |
+----------------------------------------------------------+
| GRANT USAGE ON *.* TO `dev1`@`localhost`                 |
| GRANT ALL PRIVILEGES ON `app_db`.* TO `dev1`@`localhost` |
| GRANT `app_developer`@`%` TO `dev1`@`localhost`          |
+----------------------------------------------------------+
</pre><p>
        Verify each other type of user similarly:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'read_user1'@'localhost' USING 'app_read';</code></strong>
+--------------------------------------------------------+
| Grants for read_user1@localhost                        |
+--------------------------------------------------------+
| GRANT USAGE ON *.* TO `read_user1`@`localhost`         |
| GRANT SELECT ON `app_db`.* TO `read_user1`@`localhost` |
| GRANT `app_read`@`%` TO `read_user1`@`localhost`       |
+--------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'rw_user1'@'localhost' USING 'app_read', 'app_write';</code></strong>
+------------------------------------------------------------------------------+
| Grants for rw_user1@localhost                                                |
+------------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO `rw_user1`@`localhost`                                 |
| GRANT SELECT, INSERT, UPDATE, DELETE ON `app_db`.* TO `rw_user1`@`localhost` |
| GRANT `app_read`@`%`,`app_write`@`%` TO `rw_user1`@`localhost`               |
+------------------------------------------------------------------------------+
</pre><p>
        <a class="link" href="show-grants.html" title="13.7.7.21 SHOW GRANTS Statement"><code class="literal">SHOW GRANTS</code></a> displays mandatory
        roles according to the rules described in
        <a class="xref" href="show-grants.html" title="13.7.7.21 SHOW GRANTS Statement">Section 13.7.7.21, “SHOW GRANTS Statement”</a>.
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a id="roles-activating"></a>Activating Roles</h4></div></div></div><p>
        Roles granted to a user account can be active or inactive within
        account sessions. If a granted role is active within a session,
        its privileges apply; otherwise, they do not. To determine which
        roles are active within the current session, use the
        <a class="link" href="information-functions.html#function_current-role"><code class="literal">CURRENT_ROLE()</code></a> function.
      </p><p>
        By default, granting a role to an account or naming it in the
        <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> system variable
        value does not automatically cause the role to become active
        within account sessions. For example, because thus far in the
        preceding discussion no <code class="literal">rw_user1</code> roles have
        been activated, if you connect to the server as
        <code class="literal">rw_user1</code> and invoke the
        <a class="link" href="information-functions.html#function_current-role"><code class="literal">CURRENT_ROLE()</code></a> function, the
        result is <code class="literal">NONE</code> (no active roles):
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT CURRENT_ROLE();</code></strong>
+----------------+
| CURRENT_ROLE() |
+----------------+
| NONE           |
+----------------+
</pre><p>
        To specify which roles should become active each time a user
        connects to the server and authenticates, use
        <a class="link" href="set-default-role.html" title="13.7.1.9 SET DEFAULT ROLE Statement"><code class="literal">SET DEFAULT ROLE</code></a>. To set the
        default to all assigned roles for each account created earlier,
        use this statement:
      </p><pre class="programlisting">SET DEFAULT ROLE ALL TO
  'dev1'@'localhost',
  'read_user1'@'localhost',
  'read_user2'@'localhost',
  'rw_user1'@'localhost';
</pre><p>
        Now if you connect as <code class="literal">rw_user1</code>, the initial
        value of <a class="link" href="information-functions.html#function_current-role"><code class="literal">CURRENT_ROLE()</code></a> reflects
        the new default role assignments:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT CURRENT_ROLE();</code></strong>
+--------------------------------+
| CURRENT_ROLE()                 |
+--------------------------------+
| `app_read`@`%`,`app_write`@`%` |
+--------------------------------+
</pre><p>
        To cause all explicitly granted and mandatory roles to be
        automatically activated when users connect to the server, enable
        the <a class="link" href="server-system-variables.html#sysvar_activate_all_roles_on_login"><code class="literal">activate_all_roles_on_login</code></a>
        system variable. By default, automatic role activation is
        disabled.
      </p><p>
        Within a session, a user can execute <a class="link" href="set-role.html" title="13.7.1.11 SET ROLE Statement"><code class="literal">SET
        ROLE</code></a> to change the set of active roles. For example,
        for <code class="literal">rw_user1</code>:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET ROLE NONE; SELECT CURRENT_ROLE();</code></strong>
+----------------+
| CURRENT_ROLE() |
+----------------+
| NONE           |
+----------------+
mysql&gt; <strong class="userinput"><code>SET ROLE ALL EXCEPT 'app_write'; SELECT CURRENT_ROLE();</code></strong>
+----------------+
| CURRENT_ROLE() |
+----------------+
| `app_read`@`%` |
+----------------+
mysql&gt; <strong class="userinput"><code>SET ROLE DEFAULT; SELECT CURRENT_ROLE();</code></strong>
+--------------------------------+
| CURRENT_ROLE()                 |
+--------------------------------+
| `app_read`@`%`,`app_write`@`%` |
+--------------------------------+
</pre><p>
        The first <a class="link" href="set-role.html" title="13.7.1.11 SET ROLE Statement"><code class="literal">SET ROLE</code></a> statement
        deactivates all roles. The second makes
        <code class="literal">rw_user1</code> effectively read only. The third
        restores the default roles.
      </p><a id="idm45828976959376" class="indexterm"></a><a id="idm45828976957888" class="indexterm"></a><a id="idm45828976956400" class="indexterm"></a><a id="idm45828976954912" class="indexterm"></a><p>
        The effective user for stored program and view objects is
        subject to the <code class="literal">DEFINER</code> and <code class="literal">SQL
        SECURITY</code> attributes, which determine whether execution
        occurs in invoker or definer context (see
        <a class="xref" href="stored-objects-security.html" title="25.6 Stored Object Access Control">Section 25.6, “Stored Object Access Control”</a>):
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Stored program and view objects that execute in invoker
            context execute with the roles that are active within the
            current session.
          </p></li><li class="listitem"><p>
            Stored program and view objects that execute in definer
            context execute with the default roles of the user named in
            their <code class="literal">DEFINER</code> attribute. If
            <a class="link" href="server-system-variables.html#sysvar_activate_all_roles_on_login"><code class="literal">activate_all_roles_on_login</code></a>
            is enabled, such objects execute with all roles granted to
            the <code class="literal">DEFINER</code> user, including mandatory
            roles. For stored programs, if execution should occur with
            roles different from the default, the program body can
            execute <a class="link" href="set-role.html" title="13.7.1.11 SET ROLE Statement"><code class="literal">SET
            ROLE</code></a> to activate the required roles. This must be
            done with caution since the privileges assigned to roles can
            be changed.
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a id="roles-revoking"></a>Revoking Roles or Role Privileges</h4></div></div></div><p>
        Just as roles can be granted to an account, they can be revoked
        from an account:
      </p><pre class="programlisting">REVOKE <em class="replaceable"><code>role</code></em> FROM <em class="replaceable"><code>user</code></em>;
</pre><p>
        Roles named in the
        <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> system variable
        value cannot be revoked.
      </p><p>
        <a class="link" href="revoke.html" title="13.7.1.8 REVOKE Statement"><code class="literal">REVOKE</code></a> can also be applied to a
        role to modify the privileges granted to it. This affects not
        only the role itself, but any account granted that role. Suppose
        that you want to temporarily make all application users read
        only. To do this, use <a class="link" href="revoke.html" title="13.7.1.8 REVOKE Statement"><code class="literal">REVOKE</code></a> to
        revoke the modification privileges from the
        <code class="literal">app_write</code> role:
      </p><pre class="programlisting">REVOKE INSERT, UPDATE, DELETE ON app_db.* FROM 'app_write';
</pre><p>
        As it happens, that leaves the role with no privileges at all,
        as can be seen using <a class="link" href="show-grants.html" title="13.7.7.21 SHOW GRANTS Statement"><code class="literal">SHOW GRANTS</code></a>
        (which demonstrates that this statement can be used with roles,
        not just users):
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'app_write';</code></strong>
+---------------------------------------+
| Grants for app_write@%                |
+---------------------------------------+
| GRANT USAGE ON *.* TO `app_write`@`%` |
+---------------------------------------+
</pre><p>
        Because revoking privileges from a role affects the privileges
        for any user who is assigned the modified role,
        <code class="literal">rw_user1</code> now has no table modification
        privileges (<a class="link" href="privileges-provided.html#priv_insert"><code class="literal">INSERT</code></a>,
        <a class="link" href="privileges-provided.html#priv_update"><code class="literal">UPDATE</code></a>, and
        <a class="link" href="privileges-provided.html#priv_delete"><code class="literal">DELETE</code></a> are no longer present):
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'rw_user1'@'localhost'</code></strong>
       <strong class="userinput"><code>USING 'app_read', 'app_write';</code></strong>
+----------------------------------------------------------------+
| Grants for rw_user1@localhost                                  |
+----------------------------------------------------------------+
| GRANT USAGE ON *.* TO `rw_user1`@`localhost`                   |
| GRANT SELECT ON `app_db`.* TO `rw_user1`@`localhost`           |
| GRANT `app_read`@`%`,`app_write`@`%` TO `rw_user1`@`localhost` |
+----------------------------------------------------------------+
</pre><p>
        In effect, the <code class="literal">rw_user1</code> read/write user has
        become a read-only user. This also occurs for any other accounts
        that are granted the <code class="literal">app_write</code> role,
        illustrating how use of roles makes it unnecessary to modify
        privileges for individual accounts.
      </p><p>
        To restore modification privileges to the role, simply re-grant
        them:
      </p><pre class="programlisting">GRANT INSERT, UPDATE, DELETE ON app_db.* TO 'app_write';
</pre><p>
        Now <code class="literal">rw_user1</code> again has modification
        privileges, as do any other accounts granted the
        <code class="literal">app_write</code> role.
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a id="roles-dropping"></a>Dropping Roles</h4></div></div></div><p>
        To drop roles, use <a class="link" href="drop-role.html" title="13.7.1.4 DROP ROLE Statement"><code class="literal">DROP ROLE</code></a>:
      </p><pre class="programlisting">DROP ROLE 'app_read', 'app_write';
</pre><p>
        Dropping a role revokes it from every account to which it was
        granted.
      </p><p>
        Roles named in the
        <a class="link" href="server-system-variables.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> system variable
        value cannot be dropped.
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a id="role-user-interchangeability"></a>User and Role Interchangeability</h4></div></div></div><p>
        As has been hinted at earlier for <a class="link" href="show-grants.html" title="13.7.7.21 SHOW GRANTS Statement"><code class="literal">SHOW
        GRANTS</code></a>, which displays grants for user accounts or
        roles, accounts and roles can be used interchangeably.
      </p><p>
        One difference between roles and users is that
        <a class="link" href="create-role.html" title="13.7.1.2 CREATE ROLE Statement"><code class="literal">CREATE ROLE</code></a> creates an
        authorization identifier that is locked by default, whereas
        <a class="link" href="create-user.html" title="13.7.1.3 CREATE USER Statement"><code class="literal">CREATE USER</code></a> creates an
        authorization identifier that is unlocked by default. You should
        keep in mind that this distinction is not immutable; a user with
        appropriate privileges can lock or unlock roles or (other) users
        after they have been created.
      </p><p>
        If a database administrator has a preference that a specific
        authorization identifier must be a role, a name scheme can be
        used to communicate this intention. For example, you could use a
        <code class="literal">r_</code> prefix for all authorization identifiers
        that you intend to be roles and nothing else.
      </p><p>
        Another difference between roles and users lies in the
        privileges available for administering them:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <a class="link" href="privileges-provided.html#priv_create-role"><code class="literal">CREATE ROLE</code></a> and
            <a class="link" href="privileges-provided.html#priv_drop-role"><code class="literal">DROP ROLE</code></a> privileges enable
            only use of the <a class="link" href="create-role.html" title="13.7.1.2 CREATE ROLE Statement"><code class="literal">CREATE ROLE</code></a>
            and <a class="link" href="drop-role.html" title="13.7.1.4 DROP ROLE Statement"><code class="literal">DROP ROLE</code></a> statements,
            respectively.
          </p></li><li class="listitem"><p>
            The <a class="link" href="privileges-provided.html#priv_create-user"><code class="literal">CREATE USER</code></a> privilege
            enables use of the <a class="link" href="alter-user.html" title="13.7.1.1 ALTER USER Statement"><code class="literal">ALTER
            USER</code></a>, <a class="link" href="create-role.html" title="13.7.1.2 CREATE ROLE Statement"><code class="literal">CREATE ROLE</code></a>,
            <a class="link" href="create-user.html" title="13.7.1.3 CREATE USER Statement"><code class="literal">CREATE USER</code></a>,
            <a class="link" href="drop-role.html" title="13.7.1.4 DROP ROLE Statement"><code class="literal">DROP ROLE</code></a>,
            <a class="link" href="drop-user.html" title="13.7.1.5 DROP USER Statement"><code class="literal">DROP USER</code></a>,
            <a class="link" href="rename-user.html" title="13.7.1.7 RENAME USER Statement"><code class="literal">RENAME USER</code></a>, and
            <a class="link" href="revoke.html" title="13.7.1.8 REVOKE Statement"><code class="literal">REVOKE ALL
            PRIVILEGES</code></a> statements.
          </p></li></ul></div><p>
        Thus, the <a class="link" href="privileges-provided.html#priv_create-role"><code class="literal">CREATE ROLE</code></a> and
        <a class="link" href="privileges-provided.html#priv_drop-role"><code class="literal">DROP ROLE</code></a> privileges are not as
        powerful as <a class="link" href="privileges-provided.html#priv_create-user"><code class="literal">CREATE USER</code></a> and may
        be granted to users who should only be permitted to create and
        drop roles, and not perform more general account manipulation.
      </p><p>
        With regard to privileges and interchangeability of users and
        roles, you can treat a user account like a role and grant that
        account to another user or a role. The effect is to grant the
        account's privileges and roles to the other user or role.
      </p><p>
        This set of statements demonstrates that you can grant a user to
        a user, a role to a user, a user to a role, or a role to a role:
      </p><pre class="programlisting">CREATE USER 'u1';
CREATE ROLE 'r1';
GRANT SELECT ON db1.* TO 'u1';
GRANT SELECT ON db2.* TO 'r1';
CREATE USER 'u2';
CREATE ROLE 'r2';
GRANT 'u1', 'r1' TO 'u2';
GRANT 'u1', 'r1' TO 'r2';
</pre><p>
        The result in each case is to grant to the grantee object the
        privileges associated with the granted object. After executing
        those statements, each of <code class="literal">u2</code> and
        <code class="literal">r2</code> have been granted privileges from a user
        (<code class="literal">u1</code>) and a role (<code class="literal">r1</code>):
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'u2' USING 'u1', 'r1';</code></strong>
+-------------------------------------+
| Grants for u2@%                     |
+-------------------------------------+
| GRANT USAGE ON *.* TO `u2`@`%`      |
| GRANT SELECT ON `db1`.* TO `u2`@`%` |
| GRANT SELECT ON `db2`.* TO `u2`@`%` |
| GRANT `u1`@`%`,`r1`@`%` TO `u2`@`%` |
+-------------------------------------+
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'r2' USING 'u1', 'r1';</code></strong>
+-------------------------------------+
| Grants for r2@%                     |
+-------------------------------------+
| GRANT USAGE ON *.* TO `r2`@`%`      |
| GRANT SELECT ON `db1`.* TO `r2`@`%` |
| GRANT SELECT ON `db2`.* TO `r2`@`%` |
| GRANT `u1`@`%`,`r1`@`%` TO `r2`@`%` |
+-------------------------------------+
</pre><p>
        The preceding example is illustrative only, but
        interchangeability of user accounts and roles has practical
        application, such as in the following situation: Suppose that a
        legacy application development project began before the advent
        of roles in MySQL, so all user accounts associated with the
        project are granted privileges directly (rather than granted
        privileges by virtue of being granted roles). One of these
        accounts is a developer account that was originally granted
        privileges as follows:
      </p><pre class="programlisting">CREATE USER 'old_app_dev'@'localhost' IDENTIFIED BY 'old_app_devpass';
GRANT ALL ON old_app.* TO 'old_app_dev'@'localhost';
</pre><p>
        If this developer leaves the project, it becomes necessary to
        assign the privileges to another user, or perhaps multiple users
        if development activities have expanded. Here are some ways to
        deal with the issue:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Without using roles: Change the account password so the
            original developer cannot use it, and have a new developer
            use the account instead:
          </p><pre class="programlisting">ALTER USER 'old_app_dev'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>new_password</code></em>';
</pre></li><li class="listitem"><p>
            Using roles: Lock the account to prevent anyone from using
            it to connect to the server:
          </p><pre class="programlisting">ALTER USER 'old_app_dev'@'localhost' ACCOUNT LOCK;
</pre><p>
            Then treat the account as a role. For each developer new to
            the project, create a new account and grant to it the
            original developer account:
          </p><pre class="programlisting">CREATE USER 'new_app_dev1'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>new_password</code></em>';
GRANT 'old_app_dev'@'localhost' TO 'new_app_dev1'@'localhost';
</pre><p>
            The effect is to assign the original developer account
            privileges to the new account.
          </p></li></ul></div></div></div><div class="navigation"><ul><li class="navLinkPrevious"><a title="Go To Previous Page" href="reserved-accounts.html">Previous <span class="navHint"> Reserved Accounts </span></a></li><li class="navLinkHome"><a title="Go To Home Page" href="performance-schema">Home <span class="navHint"> MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0 </span></a></li><li class="navLinkUp"><a title="Go Up A Level In The Navigation" href="access-control.html">Up <span class="navHint"> Access Control and Account Management </span></a></li><li class="navLinkNext"><a title="Go To Next Page" href="account-categories.html">Next <span class="navHint"> Account Categories </span></a></li></ul></div><div class="dochomelink-footer"><a title="Go to MySQL Doc Library" href="https://docs.oracle.com/cd/E17952_01/index.html">
        MySQL Documentation Library
      </a></div><div class="copyright-footer"></div></body></html>