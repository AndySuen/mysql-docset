<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>6.4.7.3 Using MySQL Enterprise Firewall</title><link rel="stylesheet" type="text/css" href="mvl-otn.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="performance-schema" title="MySQL 8.0 Reference Manual" /><link rel="up" href="firewall.html" title="6.4.7 MySQL Enterprise Firewall" /><link rel="prev" href="firewall-installation.html" title="6.4.7.2 Installing or Uninstalling MySQL Enterprise Firewall" /><link rel="next" href="firewall-reference.html" title="6.4.7.4 MySQL Enterprise Firewall Reference" /><script>window.ohcglobal || document.write('<script src="../../../en/dcommon/js/global.js">\x3C/script>')</script></head><body><div class="skip-link"><a href="firewall-usage.html#firewall-usage">Skip to Main Content</a></div><div class="DocTitle"><p>MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0</p></div><div class="navigation"><ul><li class="navLinkPrevious"><a accesskey="p" title="Go To Previous Page [access key: p]" href="firewall-installation.html">Previous <span class="navHint"> Installing or Uninstalling MySQL Enterprise Firewall </span></a></li><li class="navLinkHome"><a accesskey="h" title="Go To Home Page [access key: h]" href="performance-schema">Home <span class="navHint"> MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0 </span></a></li><li class="navLinkUp"><a accesskey="u" title="Go Up A Level In The Navigation [access key: u]" href="firewall.html">Up <span class="navHint"> MySQL Enterprise Firewall </span></a></li><li class="navLinkNext"><a accesskey="n" title="Go To Next Page [access key: n]" href="firewall-reference.html">Next <span class="navHint"> MySQL Enterprise Firewall Reference </span></a></li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="firewall-usage"></a>6.4.7.3 Using MySQL Enterprise Firewall</h4></div></div></div><a id="idm45828961500032" class="indexterm"></a><p>
        Before using MySQL Enterprise Firewall, install it according to the instructions
        provided in <a class="xref" href="firewall-installation.html" title="6.4.7.2 Installing or Uninstalling MySQL Enterprise Firewall">Section 6.4.7.2, “Installing or Uninstalling MySQL Enterprise Firewall”</a>.
      </p><p>
        This section describes how to configure MySQL Enterprise Firewall using SQL
        statements. Alternatively, MySQL Workbench 6.3.4 or higher provides
        a graphical interface for firewall control. See
        <a class="ulink" href="https://docs.oracle.com/cd/E17952_01/workbench-en/wb-mysql-firewall.html" target="_top">MySQL Enterprise Firewall Interface</a>.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="firewall-usage.html#firewall-enabling-disabling" title="Enabling or Disabling the Firewall">Enabling or Disabling the Firewall</a></p></li><li class="listitem"><p><a class="xref" href="firewall-usage.html#firewall-privileges" title="Assigning Firewall Privileges">Assigning Firewall Privileges</a></p></li><li class="listitem"><p><a class="xref" href="firewall-usage.html#firewall-concepts" title="Firewall Concepts">Firewall Concepts</a></p></li><li class="listitem"><p><a class="xref" href="firewall-usage.html#firewall-group-profiles" title="Registering Firewall Group Profiles">Registering Firewall Group Profiles</a></p></li><li class="listitem"><p><a class="xref" href="firewall-usage.html#firewall-account-profiles" title="Registering Firewall Account Profiles">Registering Firewall Account Profiles</a></p></li><li class="listitem"><p><a class="xref" href="firewall-usage.html#firewall-monitoring" title="Monitoring the Firewall">Monitoring the Firewall</a></p></li><li class="listitem"><p><a class="xref" href="firewall-usage.html#firewall-account-profile-migration" title="Migrating Account Profiles to Group Profiles">Migrating Account Profiles to Group Profiles</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="firewall-enabling-disabling"></a>Enabling or Disabling the Firewall</h5></div></div></div><p>
          To enable or disable the firewall, set the
          <a class="link" href="firewall-reference.html#sysvar_mysql_firewall_mode"><code class="literal">mysql_firewall_mode</code></a> system
          variable. By default, this variable is enabled when the
          firewall is installed. To control the initial firewall state
          explicitly, you can set the variable at server startup. For
          example, to enable the firewall in an option file, use these
          lines:
        </p><pre class="programlisting">[mysqld]
mysql_firewall_mode=ON
</pre><p>
          After modifying <code class="filename">my.cnf</code>, restart the
          server to cause the new setting to take effect.
        </p><p>
          Alternatively, to set and persist the firewall setting at
          runtime:
        </p><pre class="programlisting">SET PERSIST mysql_firewall_mode = OFF;
SET PERSIST mysql_firewall_mode = ON;
</pre><p>
          <a class="link" href="set-variable.html" title="13.7.6.1 SET Syntax for Variable Assignment"><code class="literal">SET
          PERSIST</code></a> sets a value for the running MySQL instance.
          It also saves the value, causing it to carry over to
          subsequent server restarts. To change a value for the running
          MySQL instance without having it carry over to subsequent
          restarts, use the <code class="literal">GLOBAL</code> keyword rather
          than <code class="literal">PERSIST</code>. See
          <a class="xref" href="set-variable.html" title="13.7.6.1 SET Syntax for Variable Assignment">Section 13.7.6.1, “SET Syntax for Variable Assignment”</a>.
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="firewall-privileges"></a>Assigning Firewall Privileges</h5></div></div></div><p>
          With the firewall installed, grant the appropriate privileges
          to the MySQL account or accounts to be used for administering
          it. The privileges depend on which firewall operations an
          account should be permitted to perform:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Grant the <a class="link" href="privileges-provided.html#priv_firewall-exempt"><code class="literal">FIREWALL_EXEMPT</code></a>
              privilege (available as of MySQL 8.0.27) to any account
              that should be exempt from firewall restrictions. This is
              useful, for example, for a database administrator who
              configures the firewall, to avoid the possibility of a
              misconfiguration causing even the administrator to be
              locked out and unable to execute statements.
            </p></li><li class="listitem"><p>
              Grant the <a class="link" href="privileges-provided.html#priv_firewall-admin"><code class="literal">FIREWALL_ADMIN</code></a>
              privilege to any account that should have full
              administrative firewall access. (Some administrative
              firewall functions can be invoked by accounts that have
              <a class="link" href="privileges-provided.html#priv_firewall-admin"><code class="literal">FIREWALL_ADMIN</code></a>
              <span class="emphasis"><em>or</em></span> the deprecated
              <a class="link" href="privileges-provided.html#priv_super"><code class="literal">SUPER</code></a> privilege, as
              indicated in the individual function descriptions.)
            </p></li><li class="listitem"><p>
              Grant the <a class="link" href="privileges-provided.html#priv_firewall-user"><code class="literal">FIREWALL_USER</code></a>
              privilege to any account that should have administrative
              access only for its own firewall rules.
            </p></li><li class="listitem"><p>
              Grant the <a class="link" href="privileges-provided.html#priv_execute"><code class="literal">EXECUTE</code></a> privilege
              for the firewall stored procedures in the
              <code class="literal">mysql</code> system database. These may invoke
              administrative functions, so stored procedure access also
              requires the privileges indicated earlier that are needed
              for those functions.
            </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p>
            The <a class="link" href="privileges-provided.html#priv_firewall-exempt"><code class="literal">FIREWALL_EXEMPT</code></a>,
            <a class="link" href="privileges-provided.html#priv_firewall-admin"><code class="literal">FIREWALL_ADMIN</code></a>, and
            <a class="link" href="privileges-provided.html#priv_firewall-user"><code class="literal">FIREWALL_USER</code></a> privileges can
            be granted only while the firewall is installed because the
            <code class="literal">MYSQL_FIREWALL</code> plugin defines those
            privileges.
          </p></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="firewall-concepts"></a>Firewall Concepts</h5></div></div></div><p>
          The MySQL server permits clients to connect and receives from
          them SQL statements to be executed. If the firewall is
          enabled, the server passes to it each incoming statement that
          does not immediately fail with a syntax error. Based on
          whether the firewall accepts the statement, the server
          executes it or returns an error to the client. This section
          describes how the firewall accomplishes the task of accepting
          or rejecting statements.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="firewall-usage.html#firewall-profiles" title="Firewall Profiles">Firewall Profiles</a></p></li><li class="listitem"><p><a class="xref" href="firewall-usage.html#firewall-statement-matching" title="Firewall Statement Matching">Firewall Statement Matching</a></p></li><li class="listitem"><p><a class="xref" href="firewall-usage.html#firewall-profile-modes" title="Profile Operational Modes">Profile Operational Modes</a></p></li><li class="listitem"><p><a class="xref" href="firewall-usage.html#firewall-multiple-profiles" title="Firewall Statement Handling When Multiple Profiles Apply">Firewall Statement Handling When Multiple Profiles Apply</a></p></li></ul></div><h6><a id="firewall-profiles"></a>Firewall Profiles</h6><p>
          The firewall uses a registry of profiles that determine
          whether to permit statement execution. Profiles have these
          attributes:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              An allowlist. The allowlist is the set of rules that
              defines which statements are acceptable to the profile.
            </p></li><li class="listitem"><p>
              A current operational mode. The mode enables the profile
              to be used in different ways. For example: the profile can
              be placed in training mode to establish the allowlist; the
              allowlist can be used for restricting statement execution
              or intrusion detection; the profile can be disabled
              entirely.
            </p></li><li class="listitem"><p>
              A scope of applicability. The scope indicates which client
              connections the profile applies to:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  The firewall supports account-based profiles such that
                  each profile matches a particular client account
                  (client user name and host name combination). For
                  example, you can register one account profile for
                  which the allowlist applies to connections originating
                  from <code class="literal">admin@localhost</code> and another
                  account profile for which the allowlist applies to
                  connections originating from
                  <code class="literal">myapp@apphost.example.com</code>.
                </p></li><li class="listitem"><p>
                  As of MySQL 8.0.23, the firewall supports group
                  profiles that can have multiple accounts as members,
                  with the profile allowlist applying equally to all
                  members. Group profiles enable easier administration
                  and greater flexibility for deployments that require
                  applying a given set of allowlist rules to multiple
                  accounts.
                </p></li></ul></div></li></ul></div><p>
          Initially, no profiles exist, so by default, the firewall
          accepts all statements and has no effect on which statements
          MySQL accounts can execute. To apply firewall protective
          capabilities, explicit action is required:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Register one or more profiles with the firewall.
            </p></li><li class="listitem"><p>
              Train the firewall by establishing the allowlist for each
              profile; that is, the types of statements the profile
              permits clients to execute.
            </p></li><li class="listitem"><p>
              Place the trained profiles in protecting mode to harden
              MySQL against unauthorized statement execution:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  MySQL associates each client session with a specific
                  user name and host name combination. This combination
                  is the <span class="emphasis"><em>session account</em></span>.
                </p></li><li class="listitem"><p>
                  For each client connection, the firewall uses the
                  session account to determine which profiles apply to
                  handling incoming statements from the client.
                </p><p>
                  The firewall accepts only statements permitted by the
                  applicable profile allowlists.
                </p></li></ul></div></li></ul></div><p>
          Most firewall principles apply identically to group profiles
          and account profiles. The two types of profiles differ in
          these respects:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              An account profile allowlist applies only to a single
              account. A group profile allowlist applies when the
              session account matches any account that is a member of
              the group.
            </p></li><li class="listitem"><p>
              To apply an allowlist to multiple accounts using account
              profiles, it is necessary to register one profile per
              account and duplicate the allowlist across each profile.
              This entails training each account profile individually
              because each one must be trained using the single account
              to which it applies.
            </p><p>
              A group profile allowlist applies to multiple accounts,
              with no need to duplicate it for each account. A group
              profile can be trained using any or all of the group
              member accounts, or training can be limited to any single
              member. Either way, the allowlist applies to all members.
            </p></li><li class="listitem"><p>
              Account profile names are based on specific user name and
              host name combinations that depend on which clients
              connect to the MySQL server. Group profile names are
              chosen by the firewall administrator with no constraints
              other than that their length must be from 1 to 288
              characters.
            </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p>
            Due to the advantages of group profiles over account
            profiles, and because a group profile with a single member
            account is logically equivalent to an account profile for
            that account, it is recommended that all new firewall
            profiles be created as group profiles. Account profiles are
            deprecated as of MySQL 8.0.26 and subject to removal in a
            future MySQL version. For assistance converting existing
            account profiles, see
            <a class="xref" href="firewall-usage.html#firewall-account-profile-migration" title="Migrating Account Profiles to Group Profiles">Migrating Account Profiles to Group Profiles</a>.
          </p></div><p>
          The profile-based protection afforded by the firewall enables
          implementation of strategies such as these:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If an application has unique protection requirements,
              configure it to use an account not used for any other
              purpose and set up a group profile or account profile for
              that account.
            </p></li><li class="listitem"><p>
              If related applications share protection requirements,
              associate each application with its own account, then add
              these application accounts as members of the same group
              profile. Alternatively, configure all the applications to
              use the same account and associate them with an account
              profile for that account.
            </p></li></ul></div><h6><a id="firewall-statement-matching"></a>Firewall Statement Matching</h6><p>
          Statement matching performed by the firewall does not use SQL
          statements as received from clients. Instead, the server
          converts incoming statements to normalized digest form and
          firewall operation uses these digests. The benefit of
          statement normalization is that it enables similar statements
          to be grouped and recognized using a single pattern. For
          example, these statements are distinct from each other:
        </p><pre class="programlisting">SELECT first_name, last_name FROM customer WHERE customer_id = 1;
select first_name, last_name from customer where customer_id = 99;
SELECT first_name, last_name FROM customer WHERE customer_id = 143;
</pre><p>
          But all of them have the same normalized digest form:
        </p><pre class="programlisting">SELECT `first_name` , `last_name` FROM `customer` WHERE `customer_id` = ?
</pre><p>
          By using normalization, firewall allowlists can store digests
          that each match many different statements received from
          clients. For more information about normalization and digests,
          see <a class="xref" href="performance-schema-statement-digests.html" title="27.10 Performance Schema Statement Digests and Sampling">Section 27.10, “Performance Schema Statement Digests and Sampling”</a>.
        </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Warning</div><p>
            Setting the
            <a class="link" href="server-system-variables.html#sysvar_max_digest_length"><code class="literal">max_digest_length</code></a> system
            variable to zero disables digest production, which also
            disables server functionality that requires digests, such as
            MySQL Enterprise Firewall.
          </p></div><h6><a id="firewall-profile-modes"></a>Profile Operational Modes</h6><p>
          Each profile registered with the firewall has its own
          operational mode, chosen from these values:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">OFF</code>: This mode disables the profile.
              The firewall considers it inactive and ignores it.
            </p></li><li class="listitem"><p>
              <code class="literal">RECORDING</code>: This is the firewall
              training mode. Incoming statements received from a client
              that matches the profile are considered acceptable for the
              profile and become part of its <span class="quote">“<span class="quote">fingerprint.</span>”</span>
              The firewall records the normalized digest form of each
              statement to learn the acceptable statement patterns for
              the profile. Each pattern is a rule, and the union of the
              rules is the profile allowlist.
            </p><p>
              A difference between group and account profiles is that
              statement recording for a group profile can be limited to
              statements received from a single group member (the
              training member).
            </p></li><li class="listitem"><p>
              <code class="literal">PROTECTING</code>: In this mode, the profile
              allows or prevents statement execution. The firewall
              matches incoming statements against the profile allowlist,
              accepting only statements that match and rejecting those
              that do not. After training a profile in
              <code class="literal">RECORDING</code> mode, switch it to
              <code class="literal">PROTECTING</code> mode to harden MySQL against
              access by statements that deviate from the allowlist. If
              the <a class="link" href="firewall-reference.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a>
              system variable is enabled, the firewall also writes
              rejected statements to the error log.
            </p></li><li class="listitem"><p>
              <code class="literal">DETECTING</code>: This mode detects but not
              does not block intrusions (statements that are suspicious
              because they match nothing in the profile allowlist). In
              <code class="literal">DETECTING</code> mode, the firewall writes
              suspicious statements to the error log but accepts them
              without denying access.
            </p></li></ul></div><p>
          When a profile is assigned any of the preceding mode values,
          the firewall stores the mode in the profile. Firewall
          mode-setting operations also permit a mode value of
          <code class="literal">RESET</code>, but this value is not stored:
          setting a profile to <code class="literal">RESET</code> mode causes the
          firewall to delete all rules for the profile and set its mode
          to <code class="literal">OFF</code>.
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p>
            Messages written to the error log in
            <code class="literal">DETECTING</code> mode or because
            <a class="link" href="firewall-reference.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a> is
            enabled are written as Notes, which are information
            messages. To ensure that such messages appear in the error
            log and are not discarded, make sure that error-logging
            verbosity is sufficient to include information messages. For
            example, if you are using priority-based log filtering, as
            described in
            <a class="xref" href="error-log-priority-based-filtering.html" title="5.4.2.5 Priority-Based Error Log Filtering (log_filter_internal)">Section 5.4.2.5, “Priority-Based Error Log Filtering (log_filter_internal)”</a>, set
            the <a class="link" href="server-system-variables.html#sysvar_log_error_verbosity"><code class="literal">log_error_verbosity</code></a>
            system variable to a value of 3.
          </p></div><h6><a id="firewall-multiple-profiles"></a>Firewall Statement Handling When Multiple Profiles Apply</h6><p>
          For simplicity, later sections that describe how to set up
          profiles take the perspective that the firewall matches
          incoming statements from a client against only a single
          profile, either a group profile or account profile. But
          firewall operation can be more complex:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              A group profile can include multiple accounts as members.
            </p></li><li class="listitem"><p>
              An account can be a member of multiple group profiles.
            </p></li><li class="listitem"><p>
              Multiple profiles can match a given client.
            </p></li></ul></div><p>
          The following description covers the general case of how the
          firewall operates, when potentially multiple profiles apply to
          incoming statements.
        </p><p>
          As previously mentioned, MySQL associates each client session
          with a specific user name and host name combination known as
          the <span class="emphasis"><em>session account</em></span>. The firewall matches
          the session account against registered profiles to determine
          which profiles apply to handling incoming statements from the
          session:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The firewall ignores inactive profiles (profiles with a
              mode of <code class="literal">OFF</code>).
            </p></li><li class="listitem"><p>
              The session account matches every active group profile
              that includes a member having the same user and host.
              There can be more than one such group profile.
            </p></li><li class="listitem"><p>
              The session account matches an active account profile
              having the same user and host, if there is one. There is
              at most one such account profile.
            </p></li></ul></div><p>
          In other words, the session account can match 0 or more active
          group profiles, and 0 or 1 active account profiles. This means
          that 0, 1, or multiple firewall profiles are applicable to a
          given session, for which the firewall handles each incoming
          statement as follows:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If there is no applicable profile, the firewall imposes no
              restrictions and accepts the statement.
            </p></li><li class="listitem"><p>
              If there are applicable profiles, their modes determine
              statement handling:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  The firewall records the statement in the allowlist of
                  each applicable profile that is in
                  <code class="literal">RECORDING</code> mode.
                </p></li><li class="listitem"><p>
                  The firewall writes the statement to the error log for
                  each applicable profile in
                  <code class="literal">DETECTING</code> mode for which the
                  statement is suspicious (does not match the profile
                  allowlist).
                </p></li><li class="listitem"><p>
                  The firewall accepts the statement if at least one
                  applicable profile is in <code class="literal">RECORDING</code>
                  or <code class="literal">DETECTING</code> mode (those modes
                  accept all statements), or if the statement matches
                  the allowlist of at least one applicable profile in
                  <code class="literal">PROTECTING</code> mode. Otherwise, the
                  firewall rejects the statement (and writes it to the
                  error log if the
                  <a class="link" href="firewall-reference.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a>
                  system variable is enabled).
                </p></li></ul></div></li></ul></div><p>
          With that description in mind, the next sections revert to the
          simplicity of the situations when a single group profile or a
          single account profile apply, and cover how to set up each
          type of profile.
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="firewall-group-profiles"></a>Registering Firewall Group Profiles</h5></div></div></div><p>
          MySQL Enterprise Firewall supports registration of group profiles as of MySQL
          8.0.23. A group profile can have multiple accounts as its
          members. To use a firewall group profile to protect MySQL
          against incoming statements from a given account, follow these
          steps:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              Register the group profile and put it in
              <code class="literal">RECORDING</code> mode.
            </p></li><li class="listitem"><p>
              Add a member account to the group profile.
            </p></li><li class="listitem"><p>
              Connect to the MySQL server using the member account and
              execute statements to be learned. This trains the group
              profile and establishes the rules that form the profile
              allowlist.
            </p></li><li class="listitem"><p>
              Add to the group profile any other accounts that are to be
              group members.
            </p></li><li class="listitem"><p>
              Switch the group profile to <code class="literal">PROTECTING</code>
              mode. When a client connects to the server using any
              account that is a member of the group profile, the profile
              allowlist restricts statement execution.
            </p></li><li class="listitem"><p>
              Should additional training be necessary, switch the group
              profile to <code class="literal">RECORDING</code> mode again, update
              its allowlist with new statement patterns, then switch it
              back to <code class="literal">PROTECTING</code> mode.
            </p></li></ol></div><p>
          Observe these guidelines for firewall-related account
          references:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Take note of the context in which account references
              occur. To name an account for firewall operations, specify
              it as a single quoted string
              (<code class="literal">'<em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em>'</code>).
              This differs from the usual MySQL convention for
              statements such as <a class="link" href="create-user.html" title="13.7.1.3 CREATE USER Statement"><code class="literal">CREATE
              USER</code></a> and <a class="link" href="grant.html" title="13.7.1.6 GRANT Statement"><code class="literal">GRANT</code></a>,
              for which you quote the user and host parts of an account
              name separately
              (<code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>).
            </p><p>
              The requirement for naming accounts as a single quoted
              string for firewall operations means that you cannot use
              accounts that have embedded <code class="literal">@</code>
              characters in the user name.
            </p></li><li class="listitem"><p>
              The firewall assesses statements against accounts
              represented by actual user and host names as authenticated
              by the server. When registering accounts in profiles, do
              not use wildcard characters or netmasks:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  Suppose that an account named
                  <code class="literal">me@%.example.org</code> exists and a
                  client uses it to connect to the server from the host
                  <code class="literal">abc.example.org</code>.
                </p></li><li class="listitem"><p>
                  The account name contains a <code class="literal">%</code>
                  wildcard character, but the server authenticates the
                  client as having a user name of <code class="literal">me</code>
                  and host name of <code class="literal">abc.example.com</code>,
                  and that is what the firewall sees.
                </p></li><li class="listitem"><p>
                  Consequently, the account name to use for firewall
                  operations is <code class="literal">me@abc.example.org</code>
                  rather than <code class="literal">me@%.example.org</code>.
                </p></li></ul></div></li></ul></div><p>
          The following procedure shows how to register a group profile
          with the firewall, train the firewall to know the acceptable
          statements for that profile (its allowlist), use the profile
          to protect MySQL against execution of unacceptable statements,
          and add and remove group members. The example uses a group
          profile name of <code class="literal">fwgrp</code>. The example profile
          is presumed for use by clients of an application that accesses
          tables in the <code class="literal">sakila</code> database (available at
          <a class="ulink" href="https://dev.mysql.com/doc/index-other.html" target="_top">https://dev.mysql.com/doc/index-other.html</a>).
        </p><p>
          Use an administrative MySQL account to perform the steps in
          this procedure, except those steps designated for execution by
          member accounts of the firewall group profile. For statements
          executed by member accounts, the default database should be
          <code class="literal">sakila</code>. (You can use a different database
          by adjusting the instructions accordingly.)
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              If necessary, create the accounts that are to be members
              of the <code class="literal">fwgrp</code> group profile and grant
              them appropriate access privileges. Statements for one
              member are shown here (choose an appropriate password):
            </p><pre class="programlisting">CREATE USER 'member1'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT ALL ON sakila.* TO 'member1'@'localhost';
</pre></li><li class="listitem"><p>
              Use the <code class="literal">sp_set_firewall_group_mode()</code>
              stored procedure to register the group profile with the
              firewall and place the profile in
              <code class="literal">RECORDING</code> (training) mode:
            </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode('fwgrp', 'RECORDING');
</pre></li><li class="listitem"><p>
              Use the <code class="literal">sp_firewall_group_enlist()</code>
              stored procedure to add an initial member account for use
              in training the group profile allowlist:
            </p><pre class="programlisting">CALL mysql.sp_firewall_group_enlist('fwgrp', 'member1@localhost');
</pre></li><li class="listitem"><p>
              To train the group profile using the initial member
              account, connect to the server as
              <code class="literal">member1</code> from the server host so that
              the firewall sees a session account of
              <code class="literal">member1@localhost</code>. Then execute some
              statements to be considered legitimate for the profile.
              For example:
            </p><pre class="programlisting">SELECT title, release_year FROM film WHERE film_id = 1;
UPDATE actor SET last_update = NOW() WHERE actor_id = 1;
SELECT store_id, COUNT(*) FROM inventory GROUP BY store_id;
</pre><p>
              The firewall receives the statements from the
              <code class="literal">member1@localhost</code> account. Because that
              account is a member of the <code class="literal">fwgrp</code>
              profile, which is in <code class="literal">RECORDING</code> mode,
              the firewall interprets the statements as applicable to
              <code class="literal">fwgrp</code> and records the normalized digest
              form of the statements as rules in the
              <code class="literal">fwgrp</code> allowlist. Those rules then apply
              to all accounts that are members of
              <code class="literal">fwgrp</code>.
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p>
                Until the <code class="literal">fwgrp</code> group profile
                receives statements in <code class="literal">RECORDING</code>
                mode, its allowlist is empty, which is equivalent to
                <span class="quote">“<span class="quote">deny all.</span>”</span> No statement can match an empty
                allowlist, which has these implications:
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    The group profile cannot be switched to
                    <code class="literal">PROTECTING</code> mode. It would reject
                    every statement, effectively prohibiting the
                    accounts that are group members from executing any
                    statement.
                  </p></li><li class="listitem"><p>
                    The group profile can be switched to
                    <code class="literal">DETECTING</code> mode. In this case, the
                    profile accepts every statement but logs it as
                    suspicious.
                  </p></li></ul></div></div></li><li class="listitem"><p>
              At this point, the group profile information is cached,
              including its name, membership, and allowlist. To see this
              information, query the Performance Schema firewall tables:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT MODE FROM performance_schema.firewall_groups</code></strong>
       <strong class="userinput"><code>WHERE NAME = 'fwgrp';</code></strong>
+-----------+
| MODE      |
+-----------+
| RECORDING |
+-----------+
mysql&gt; <strong class="userinput"><code>SELECT * FROM performance_schema.firewall_membership</code></strong>
       <strong class="userinput"><code>WHERE GROUP_ID = 'fwgrp' ORDER BY MEMBER_ID;</code></strong>
+----------+-------------------+
| GROUP_ID | MEMBER_ID         |
+----------+-------------------+
| fwgrp    | member1@localhost |
+----------+-------------------+
mysql&gt; <strong class="userinput"><code>SELECT RULE FROM performance_schema.firewall_group_allowlist</code></strong>
       <strong class="userinput"><code>WHERE NAME = 'fwgrp';</code></strong>
+----------------------------------------------------------------------+
| RULE                                                                 |
+----------------------------------------------------------------------+
| SELECT @@`version_comment` LIMIT ?                                   |
| UPDATE `actor` SET `last_update` = NOW ( ) WHERE `actor_id` = ?      |
| SELECT `title` , `release_year` FROM `film` WHERE `film_id` = ?      |
| SELECT `store_id` , COUNT ( * ) FROM `inventory` GROUP BY `store_id` |
+----------------------------------------------------------------------+
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p>
                The <code class="literal">@@version_comment</code> rule comes from
                a statement sent automatically by the
                <a class="link" href="mysql.html" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client when you connect to the
                server.
              </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Important</div><p>
                Train the firewall under conditions matching application
                use. For example, to determine server characteristics
                and capabilities, a given MySQL connector might send
                statements to the server at the beginning of each
                session. If an application normally is used through that
                connector, train the firewall using the connector, too.
                That enables those initial statements to become part of
                the allowlist for the group profile associated with the
                application.
              </p></div></li><li class="listitem"><p>
              Invoke <code class="literal">sp_set_firewall_group_mode()</code>
              again to switch the group profile to
              <code class="literal">PROTECTING</code> mode:
            </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode('fwgrp', 'PROTECTING');
</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Important</div><p>
                Switching the group profile out of
                <code class="literal">RECORDING</code> mode synchronizes its
                cached data to the <code class="literal">mysql</code> system
                database tables that provide persistent underlying
                storage. If you do not switch the mode for a profile
                that is being recorded, the cached data is not written
                to persistent storage and is lost when the server is
                restarted.
              </p></div></li><li class="listitem"><p>
              Add to the group profile any other accounts that should be
              members:
            </p><pre class="programlisting">CALL mysql.sp_firewall_group_enlist('fwgrp', 'member2@localhost');
CALL mysql.sp_firewall_group_enlist('fwgrp', 'member3@localhost');
CALL mysql.sp_firewall_group_enlist('fwgrp', 'member4@localhost');
</pre><p>
              The profile allowlist trained using the
              <code class="literal">member1@localhost</code> account now also
              applies to the additional accounts.
            </p></li><li class="listitem"><p>
              To verify the updated group membership, query the
              <code class="literal">firewall_membership</code> table again:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM performance_schema.firewall_membership</code></strong>
       <strong class="userinput"><code>WHERE GROUP_ID = 'fwgrp' ORDER BY MEMBER_ID;</code></strong>
+----------+-------------------+
| GROUP_ID | MEMBER_ID         |
+----------+-------------------+
| fwgrp    | member1@localhost |
| fwgrp    | member2@localhost |
| fwgrp    | member3@localhost |
| fwgrp    | member4@localhost |
+----------+-------------------+
</pre></li><li class="listitem"><p>
              Test the group profile against the firewall by using any
              account in the group to execute some acceptable and
              unacceptable statements. The firewall matches each
              statement from the account against the profile allowlist
              and accepts or rejects it:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  This statement is not identical to a training
                  statement but produces the same normalized statement
                  as one of them, so the firewall accepts it:
                </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT title, release_year FROM film WHERE film_id = 98;</code></strong>
+-------------------+--------------+
| title             | release_year |
+-------------------+--------------+
| BRIGHT ENCOUNTERS |         2006 |
+-------------------+--------------+
</pre></li><li class="listitem"><p>
                  These statements match nothing in the allowlist, so
                  the firewall rejects each with an error:
                </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT title, release_year FROM film WHERE film_id = 98 OR TRUE;</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
mysql&gt; <strong class="userinput"><code>SHOW TABLES LIKE 'customer%';</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
mysql&gt; <strong class="userinput"><code>TRUNCATE TABLE mysql.slow_log;</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
</pre></li><li class="listitem"><p>
                  If the
                  <a class="link" href="firewall-reference.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a>
                  system variable is enabled, the firewall also writes
                  rejected statements to the error log. For example:
                </p><pre class="programlisting">[Note] Plugin MYSQL_FIREWALL reported:
'ACCESS DENIED for 'member1@localhost'. Reason: No match in allowlist.
Statement: TRUNCATE TABLE `mysql` . `slow_log`'
</pre><p>
                  These log messages may be helpful in identifying the
                  source of attacks, should that be necessary.
                </p></li></ul></div></li><li class="listitem"><p>
              Should members need to be removed from the group profile,
              use the <code class="literal">sp_firewall_group_delist()</code>
              stored procedure rather than
              <code class="literal">sp_firewall_group_enlist()</code>:
            </p><pre class="programlisting">CALL mysql.sp_firewall_group_delist('fwgrp', 'member3@localhost');
</pre></li></ol></div><p>
          The firewall group profile now is trained for member accounts.
          When clients connect using any account in the group and
          attempt to execute statements, the profile protects MySQL
          against statements not matched by the profile allowlist.
        </p><p>
          The procedure just shown added only one member to the group
          profile before training its allowlist. Doing so provides
          better control over the training period by limiting which
          accounts can add new acceptable statements to the allowlist.
          Should additional training be necessary, you can switch the
          profile back to <code class="literal">RECORDING</code> mode:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode('fwgrp', 'RECORDING');
</pre><p>
          However, that enables any member of the group to execute
          statements and add them to the allowlist. To limit the
          additional training to a single group member, call
          <code class="literal">sp_set_firewall_group_mode_and_user()</code>,
          which is like <code class="literal">sp_set_firewall_group_mode()</code>
          but takes one more argument specifying which account is
          permitted to train the profile in <code class="literal">RECORDING</code>
          mode. For example, to enable training only by
          <code class="literal">member4@localhost</code>, do this:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode_and_user('fwgrp', 'RECORDING', 'member4@localhost');
</pre><p>
          That enables additional training by the specified account
          without having to remove the other group members. They can
          execute statements, but the statements are not added to the
          allowlist. (Remember, however, that in
          <code class="literal">RECORDING</code> mode the other members can
          execute <span class="emphasis"><em>any</em></span> statement.)
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p>
            To avoid unexpected behavior when a particular account is
            specified as the training account for a group profile,
            always ensure that account is a member of the group.
          </p></div><p>
          After the additional training, set the group profile back to
          <code class="literal">PROTECTING</code> mode:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode('fwgrp', 'PROTECTING');
</pre><p>
          The training account established by
          <code class="literal">sp_set_firewall_group_mode_and_user()</code> is
          saved in the group profile, so the firewall remembers it in
          case more training is needed later. Thus, if you call
          <code class="literal">sp_set_firewall_group_mode()</code> (which takes
          no training account argument), the current profile training
          account, <code class="literal">member4@localhost</code>, remains
          unchanged.
        </p><p>
          To clear the training account if it actually is desired to
          enable all group members to perform training in
          <code class="literal">RECORDING</code> mode, call
          <code class="literal">sp_set_firewall_group_mode_and_user()</code> and
          pass a <code class="literal">NULL</code> value for the account argument:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode_and_user('fwgrp', 'RECORDING', NULL);
</pre><p>
          It is possible to detect intrusions by logging nonmatching
          statements as suspicious without denying access. First, put
          the group profile in <code class="literal">DETECTING</code> mode:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode('fwgrp', 'DETECTING');
</pre><p>
          Then, using a member account, execute a statement that does
          not match the group profile allowlist. In
          <code class="literal">DETECTING</code> mode, the firewall permits the
          nonmatching statement to execute:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW TABLES LIKE 'customer%';</code></strong>
+------------------------------+
| Tables_in_sakila (customer%) |
+------------------------------+
| customer                     |
| customer_list                |
+------------------------------+
</pre><p>
          In addition, the firewall writes a message to the error log:
        </p><pre class="programlisting">[Note] Plugin MYSQL_FIREWALL reported:
'SUSPICIOUS STATEMENT from 'member1@localhost'. Reason: No match in allowlist.
Statement: SHOW TABLES LIKE ?'
</pre><p>
          To disable a group profile, change its mode to
          <code class="literal">OFF</code>:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode(<em class="replaceable"><code>group</code></em>, 'OFF');
</pre><p>
          To forget all training for a profile and disable it, reset it:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode(<em class="replaceable"><code>group</code></em>, 'RESET');
</pre><p>
          The reset operation causes the firewall to delete all rules
          for the profile and set its mode to <code class="literal">OFF</code>.
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="firewall-account-profiles"></a>Registering Firewall Account Profiles</h5></div></div></div><p>
          MySQL Enterprise Firewall enables profiles to be registered that correspond to
          individual accounts. To use a firewall account profile to
          protect MySQL against incoming statements from a given
          account, follow these steps:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              Register the account profile and put it in
              <code class="literal">RECORDING</code> mode.
            </p></li><li class="listitem"><p>
              Connect to the MySQL server using the account and execute
              statements to be learned. This trains the account profile
              and establishes the rules that form the profile allowlist.
            </p></li><li class="listitem"><p>
              Switch the account profile to
              <code class="literal">PROTECTING</code> mode. When a client connects
              to the server using the account, the account profile
              allowlist restricts statement execution.
            </p></li><li class="listitem"><p>
              Should additional training be necessary, switch the
              account profile to <code class="literal">RECORDING</code> mode
              again, update its allowlist with new statement patterns,
              then switch it back to <code class="literal">PROTECTING</code> mode.
            </p></li></ol></div><p>
          Observe these guidelines for firewall-related account
          references:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Take note of the context in which account references
              occur. To name an account for firewall operations, specify
              it as a single quoted string
              (<code class="literal">'<em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em>'</code>).
              This differs from the usual MySQL convention for
              statements such as <a class="link" href="create-user.html" title="13.7.1.3 CREATE USER Statement"><code class="literal">CREATE
              USER</code></a> and <a class="link" href="grant.html" title="13.7.1.6 GRANT Statement"><code class="literal">GRANT</code></a>,
              for which you quote the user and host parts of an account
              name separately
              (<code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>).
            </p><p>
              The requirement for naming accounts as a single quoted
              string for firewall operations means that you cannot use
              accounts that have embedded <code class="literal">@</code>
              characters in the user name.
            </p></li><li class="listitem"><p>
              The firewall assesses statements against accounts
              represented by actual user and host names as authenticated
              by the server. When registering accounts in profiles, do
              not use wildcard characters or netmasks:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  Suppose that an account named
                  <code class="literal">me@%.example.org</code> exists and a
                  client uses it to connect to the server from the host
                  <code class="literal">abc.example.org</code>.
                </p></li><li class="listitem"><p>
                  The account name contains a <code class="literal">%</code>
                  wildcard character, but the server authenticates the
                  client as having a user name of <code class="literal">me</code>
                  and host name of <code class="literal">abc.example.com</code>,
                  and that is what the firewall sees.
                </p></li><li class="listitem"><p>
                  Consequently, the account name to use for firewall
                  operations is <code class="literal">me@abc.example.org</code>
                  rather than <code class="literal">me@%.example.org</code>.
                </p></li></ul></div></li></ul></div><p>
          The following procedure shows how to register an account
          profile with the firewall, train the firewall to know the
          acceptable statements for that profile (its allowlist), and
          use the profile to protect MySQL against execution of
          unacceptable statements by the account. The example account,
          <code class="literal">fwuser@localhost</code>, is presumed for use by an
          application that accesses tables in the
          <code class="literal">sakila</code> database (available at
          <a class="ulink" href="https://dev.mysql.com/doc/index-other.html" target="_top">https://dev.mysql.com/doc/index-other.html</a>).
        </p><p>
          Use an administrative MySQL account to perform the steps in
          this procedure, except those steps designated for execution by
          the <code class="literal">fwuser@localhost</code> account that
          corresponds to the account profile registered with the
          firewall. For statements executed using this account, the
          default database should be <code class="literal">sakila</code>. (You can
          use a different database by adjusting the instructions
          accordingly.)
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              If necessary, create the account to use for executing
              statements (choose an appropriate password) and grant it
              privileges for the <code class="literal">sakila</code> database:
            </p><pre class="programlisting">CREATE USER 'fwuser'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT ALL ON sakila.* TO 'fwuser'@'localhost';
</pre></li><li class="listitem"><p>
              Use the <code class="literal">sp_set_firewall_mode()</code> stored
              procedure to register the account profile with the
              firewall and place the profile in
              <code class="literal">RECORDING</code> (training) mode:
            </p><pre class="programlisting">CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'RECORDING');
</pre></li><li class="listitem"><p>
              To train the registered account profile, connect to the
              server as <code class="literal">fwuser</code> from the server host
              so that the firewall sees a session account of
              <code class="literal">fwuser@localhost</code>. Then use the account
              to execute some statements to be considered legitimate for
              the profile. For example:
            </p><pre class="programlisting">SELECT first_name, last_name FROM customer WHERE customer_id = 1;
UPDATE rental SET return_date = NOW() WHERE rental_id = 1;
SELECT get_customer_balance(1, NOW());
</pre><p>
              Because the profile is in <code class="literal">RECORDING</code>
              mode, the firewall records the normalized digest form of
              the statements as rules in the profile allowlist.
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p>
                Until the <code class="literal">fwuser@localhost</code> account
                profile receives statements in
                <code class="literal">RECORDING</code> mode, its allowlist is
                empty, which is equivalent to <span class="quote">“<span class="quote">deny all.</span>”</span>
                No statement can match an empty allowlist, which has
                these implications:
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    The account profile cannot be switched to
                    <code class="literal">PROTECTING</code> mode. It would reject
                    every statement, effectively prohibiting the account
                    from executing any statement.
                  </p></li><li class="listitem"><p>
                    The account profile can be switched to
                    <code class="literal">DETECTING</code> mode. In this case, the
                    profile accepts every statement but logs it as
                    suspicious.
                  </p></li></ul></div></div></li><li class="listitem"><p>
              At this point, the account profile information is cached.
              To see this information, query the
              <code class="literal">INFORMATION_SCHEMA</code> firewall tables:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT MODE FROM INFORMATION_SCHEMA.MYSQL_FIREWALL_USERS</code></strong>
       <strong class="userinput"><code>WHERE USERHOST = 'fwuser@localhost';</code></strong>
+-----------+
| MODE      |
+-----------+
| RECORDING |
+-----------+
mysql&gt; <strong class="userinput"><code>SELECT RULE FROM INFORMATION_SCHEMA.MYSQL_FIREWALL_WHITELIST</code></strong>
       <strong class="userinput"><code>WHERE USERHOST = 'fwuser@localhost';</code></strong>
+----------------------------------------------------------------------------+
| RULE                                                                       |
+----------------------------------------------------------------------------+
| SELECT `first_name` , `last_name` FROM `customer` WHERE `customer_id` = ?  |
| SELECT `get_customer_balance` ( ? , NOW ( ) )                              |
| UPDATE `rental` SET `return_date` = NOW ( ) WHERE `rental_id` = ?          |
| SELECT @@`version_comment` LIMIT ?                                         |
+----------------------------------------------------------------------------+
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p>
                The <code class="literal">@@version_comment</code> rule comes from
                a statement sent automatically by the
                <a class="link" href="mysql.html" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client when you connect to the
                server.
              </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Important</div><p>
                Train the firewall under conditions matching application
                use. For example, to determine server characteristics
                and capabilities, a given MySQL connector might send
                statements to the server at the beginning of each
                session. If an application normally is used through that
                connector, train the firewall using the connector, too.
                That enables those initial statements to become part of
                the allowlist for the account profile associated with
                the application.
              </p></div></li><li class="listitem"><p>
              Invoke <code class="literal">sp_set_firewall_mode()</code> again,
              this time switching the account profile to
              <code class="literal">PROTECTING</code> mode:
            </p><pre class="programlisting">CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'PROTECTING');
</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Important</div><p>
                Switching the account profile out of
                <code class="literal">RECORDING</code> mode synchronizes its
                cached data to the <code class="literal">mysql</code> system
                database tables that provide persistent underlying
                storage. If you do not switch the mode for a profile
                that is being recorded, the cached data is not written
                to persistent storage and is lost when the server is
                restarted.
              </p></div></li><li class="listitem"><p>
              Test the account profile by using the account to execute
              some acceptable and unacceptable statements. The firewall
              matches each statement from the account against the
              profile allowlist and accepts or rejects it:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  This statement is not identical to a training
                  statement but produces the same normalized statement
                  as one of them, so the firewall accepts it:
                </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = '48';</code></strong>
+------------+-----------+
| first_name | last_name |
+------------+-----------+
| ANN        | EVANS     |
+------------+-----------+
</pre></li><li class="listitem"><p>
                  These statements match nothing in the allowlist, so
                  the firewall rejects each with an error:
                </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = 1 OR TRUE;</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
mysql&gt; <strong class="userinput"><code>SHOW TABLES LIKE 'customer%';</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
mysql&gt; <strong class="userinput"><code>TRUNCATE TABLE mysql.slow_log;</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
</pre></li><li class="listitem"><p>
                  If the
                  <a class="link" href="firewall-reference.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a>
                  system variable is enabled, the firewall also writes
                  rejected statements to the error log. For example:
                </p><pre class="programlisting">[Note] Plugin MYSQL_FIREWALL reported:
'ACCESS DENIED for fwuser@localhost. Reason: No match in allowlist.
Statement: TRUNCATE TABLE `mysql` . `slow_log`'
</pre><p>
                  These log messages may be helpful in identifying the
                  source of attacks, should that be necessary.
                </p></li></ul></div></li></ol></div><p>
          The firewall account profile now is trained for the
          <code class="literal">fwuser@localhost</code> account. When clients
          connect using that account and attempt to execute statements,
          the profile protects MySQL against statements not matched by
          the profile allowlist.
        </p><p>
          It is possible to detect intrusions by logging nonmatching
          statements as suspicious without denying access. First, put
          the account profile in <code class="literal">DETECTING</code> mode:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'DETECTING');
</pre><p>
          Then, using the account, execute a statement that does not
          match the account profile allowlist. In
          <code class="literal">DETECTING</code> mode, the firewall permits the
          nonmatching statement to execute:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW TABLES LIKE 'customer%';</code></strong>
+------------------------------+
| Tables_in_sakila (customer%) |
+------------------------------+
| customer                     |
| customer_list                |
+------------------------------+
</pre><p>
          In addition, the firewall writes a message to the error log:
        </p><pre class="programlisting">[Note] Plugin MYSQL_FIREWALL reported:
'SUSPICIOUS STATEMENT from 'fwuser@localhost'. Reason: No match in allowlist.
Statement: SHOW TABLES LIKE ?'
</pre><p>
          To disable an account profile, change its mode to
          <code class="literal">OFF</code>:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_mode(<em class="replaceable"><code>user</code></em>, 'OFF');
</pre><p>
          To forget all training for a profile and disable it, reset it:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_mode(<em class="replaceable"><code>user</code></em>, 'RESET');
</pre><p>
          The reset operation causes the firewall to delete all rules
          for the profile and set its mode to <code class="literal">OFF</code>.
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="firewall-monitoring"></a>Monitoring the Firewall</h5></div></div></div><p>
          To assess firewall activity, examine its status variables. For
          example, after performing the procedure shown earlier to train
          and protect the <code class="literal">fwgrp</code> group profile, the
          variables look like this:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GLOBAL STATUS LIKE 'Firewall%';</code></strong>
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
| Firewall_access_denied     | 3     |
| Firewall_access_granted    | 4     |
| Firewall_access_suspicious | 1     |
| Firewall_cached_entries    | 4     |
+----------------------------+-------+
</pre><p>
          The variables indicate the number of statements rejected,
          accepted, logged as suspicious, and added to the cache,
          respectively. The
          <a class="link" href="firewall-reference.html#statvar_Firewall_access_granted"><code class="literal">Firewall_access_granted</code></a>
          count is 4 because of the <code class="literal">@@version_comment</code>
          statement sent by the <a class="link" href="mysql.html" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client each of
          the three times you connected using the registered account,
          plus the <a class="link" href="show-tables.html" title="13.7.7.39 SHOW TABLES Statement"><code class="literal">SHOW TABLES</code></a> statement
          that was not blocked in <code class="literal">DETECTING</code> mode.
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a id="firewall-account-profile-migration"></a>Migrating Account Profiles to Group Profiles</h5></div></div></div><p>
          Prior to MySQL 8.0.23, MySQL Enterprise Firewall supports only account profiles
          that each apply to a single account. As of MySQL 8.0.23, the
          firewall also supports group profiles that each can apply to
          multiple accounts. A group profile enables easier
          administration when the same allowlist is to be applied to
          multiple accounts: instead of creating one account profile per
          account and duplicating the allowlist across all those
          profiles, create a single group profile and make the accounts
          members of it. The group allowlist then applies to all the
          accounts.
        </p><p>
          A group profile with a single member account is logically
          equivalent to an account profile for that account, so it is
          possible to administer the firewall using group profiles
          exclusively, rather than a mix of account and group profiles.
          For new firewall installations, that is accomplished by
          uniformly creating new profiles as group profiles and avoiding
          account profiles.
        </p><p>
          Due to the greater flexibility offered by group profiles, it
          is recommended that all new firewall profiles be created as
          group profiles. Account profiles are deprecated as of MySQL
          8.0.26 and subject to removal in a future MySQL version. For
          upgrades from firewall installations that already contain
          account profiles, MySQL Enterprise Firewall in MySQL 8.0.26 and higher includes a
          stored procedure named
          <code class="literal">sp_migrate_firewall_user_to_group()</code> to help
          you convert account profiles to group profiles. To use it,
          perform the following procedure as a user who has the
          <a class="link" href="privileges-provided.html#priv_firewall-admin"><code class="literal">FIREWALL_ADMIN</code></a> privilege:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              Identify which account profiles exist by querying the
              Information Schema
              <a class="link" href="information-schema-mysql-firewall-users-table.html" title="26.7.2 The INFORMATION_SCHEMA MYSQL_FIREWALL_USERS Table"><code class="literal">MYSQL_FIREWALL_USERS</code></a> table.
              For example:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USERHOST FROM INFORMATION_SCHEMA.MYSQL_FIREWALL_USERS;</code></strong>
+-------------------------------+
| USERHOST                      |
+-------------------------------+
| admin@localhost               |
| local_client@localhost        |
| remote_client@abc.example.com |
+-------------------------------+
</pre></li><li class="listitem"><p>
              For each account profile identified by the previous step,
              convert it to a group profile:
            </p><pre class="programlisting">CALL mysql.sp_migrate_firewall_user_to_group('admin@localhost', 'admins');
CALL mysql.sp_migrate_firewall_user_to_group('local_client@localhost', 'local_clients');
CALL mysql.sp_migrate_firewall_user_to_group('remote_client@localhost', 'remote_clients');
</pre><p>
              In each case, the account profile must exist and must not
              currently be in <code class="literal">RECORDING</code> mode, and the
              group profile must not already exist. The resulting group
              profile has the named account as its single enlisted
              member, which is also set as the group training account.
              The group profile operational mode is taken from the
              account profile operational mode.
            </p></li></ol></div><p>
          For additional details about
          <code class="literal">sp_migrate_firewall_user_to_group()</code>, see
          <a class="xref" href="firewall-reference.html#firewall-stored-routines-miscellaneous" title="Firewall Miscellaneous Stored Procedures">Firewall Miscellaneous Stored Procedures</a>.
        </p></div></div><div class="navigation"><ul><li class="navLinkPrevious"><a title="Go To Previous Page" href="firewall-installation.html">Previous <span class="navHint"> Installing or Uninstalling MySQL Enterprise Firewall </span></a></li><li class="navLinkHome"><a title="Go To Home Page" href="performance-schema">Home <span class="navHint"> MySQL 8.0 Reference Manual Including MySQL NDB Cluster 8.0 </span></a></li><li class="navLinkUp"><a title="Go Up A Level In The Navigation" href="firewall.html">Up <span class="navHint"> MySQL Enterprise Firewall </span></a></li><li class="navLinkNext"><a title="Go To Next Page" href="firewall-reference.html">Next <span class="navHint"> MySQL Enterprise Firewall Reference </span></a></li></ul></div><div class="dochomelink-footer"><a title="Go to MySQL Doc Library" href="https://docs.oracle.com/cd/E17952_01/index.html">
        MySQL Documentation Library
      </a></div><div class="copyright-footer"></div></body></html>